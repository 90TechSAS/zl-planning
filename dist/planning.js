!function(){"use strict";window.angular.module("90Tech.planning",["pikaday","zlContextMenu"])}(),angular.module("90Tech.planning").run(["$templateCache",function(e){e.put("/templates/planning-context-menu.html",'<ul class="dropdown-menu context-menu" ng-click=$event.stopPropagation(); style="z-index: 10"><li ng-if="!event.eventList.length && !ev.eventList.length"><a ng-click="planning.action({$element: event || ev})"><i class="mdi mdi-chevron-down"></i> Ouvrir dans un nouvel onglet {{event.eventList.length}}</a></li><li ng-if="!event.eventList.length && !ev.eventList.length"><a ng-click="planning.duplicateAction({$element: event || ev})"><i class="mdi mdi-chevron-down"></i> Dupliquer l\'intervention {{event.eventList.length}}</a></li></ul>'),e.put("/templates/planning-line-context-menu.html",'<ul class="dropdown-menu context-menu" ng-click=$event.stopPropagation(); style="z-index: 10"><li ng-if="!event.eventList.length && !ev.eventList.length"><a ng-click="planning.dayEvent(line._events, false)"><i class="mdi mdi-chevron-down"></i> Dupliquer la journée {{event.eventList.length}}</a></li><li ng-if="!event.eventList.length && !ev.eventList.length"><a ng-click="planning.dayEvent(line._events, true)"><i class="mdi mdi-chevron-down"></i> Déplacer la journée {{event.eventList.length}}</a></li></ul>'),e.put("/directives/planning/planning.html",'<div ng-if="planning.mode ===\'day\' || planning.mode === \'week\'" style="height: 100%;"><zl-planning-left-column mode=planning.mode position=planning.position day-field=planning.dayField entities-name=planning.entitiesName , usable-days=planning.allowedDays day-event=planning.dayEvent move-action=planning.moveAction show-absences-callback="planning.showAbsencesCallBackWrapper({absences: absences, day: day})" events=planning.sortedEvents absences=planning.absences is-ferie=planning.isFerie(planning.position)></zl-planning-left-column><div class style=height:100%><div zl-horizontal-scroll scroll-left=planning.currentTimeToPixels() style=height:100%><div ng-style="{width: planning.width}" class=planning-body><zl-planning-top-row mode=planning.mode zoom=planning.zoom position=planning.position holidays=planning.holidays day-start=planning._dayStart day-end=planning._dayEnd></zl-planning-top-row><div class=hour-cursor ng-style="{left: planning.currentTimeToPixels()+\'px\'}" ng-if="planning.isCurrent() && planning.isInDayRange()"><div class=hour-caret></div></div><div ng-if=planning.isFerie(planning.position)></div><div class=planning-2pc ng-class="{ isFerie: (planning.mode === \'day\' && planning.isFerie(planning.position)), isSolidarityDay: (planning.mode === \'day\' && planning.isSolidarityDay(planning.position))}"></div><zl-planning-line ng-if="planning.mode === \'day\'" zoom=planning.zoom absences=planning.absences[i] position=planning.position day-start=planning._dayStart day-end=planning._dayEnd ng-repeat="i in planning.keys(planning.sortedEvents)" class="day b-b" ng-class="{today: planning.isToday(i)}" events=planning.getEvents(i) pauses=planning.entitiesPauses[i][0] holidays=planning.holidays drop-callback="planning.dropEvent({h: $hour, m: $minutes, d: i, entity: i, $data: $data, $event: $event})" click-callback="planning.clickCallbackWrapper({h: $hour, m: $minutes, d: i, entity: i})"></zl-planning-line><zl-planning-line ng-if="planning.mode === \'week\'" zoom=planning.zoom ng-repeat="day in planning.usableDays" position=planning.position entities=planning.entities day-of-week=planning.daysList[day] mode=planning.mode holidays=planning.holidays day-start=planning._dayStart day-end=planning._dayEnd class="day b-b" ng-class="{today: planning.isToday(planning.keys(planning.sortedEvents)[day])}" events=planning.getEvents(planning.keys(planning.sortedEvents)[day]) drop-callback="planning.dropEvent({h: $hour, m: $minutes, d: planning.keys(planning.sortedEvents)[day], entity: planning.keys(planning.sortedEvents)[day], $data: $data, $event: $event})" click-callback="planning.clickCallbackWrapper({h: $hour, m: $minutes, d: planning.keys(planning.sortedEvents)[day], entity: planning.keys(planning.sortedEvents)[day]})"></zl-planning-line></div></div></div></div><div ng-if="planning.mode === \'3day\'" style="height: 100%;"><zl-planning-left-column mode="\'day\'" three-days=true position=planning.position entities-name=planning.entitiesName day-field=planning.dayField usable-days=planning.allowedDays events=planning.sortedEvents></zl-planning-left-column><div style="height: 100%; display: flex; flex-flow: row nowrap;" zl-horizontal-scroll><div style=height:100%; ng-repeat="day in planning.groupedEvents track by $index"><div style="height:100%; display: inline-block;"><div ng-style="{width: planning.width}" class=planning-body><zl-planning-top-row mode="\'day\'" zoom=planning.zoom position=planning.position day-start=planning._dayStart day-end=planning._dayEnd></zl-planning-top-row><p style="position: absolute; top: 27px; font-size: 1.4em; font-weight: bold; width: 100%; padding-left: 5px;" ng-class="{isFerie: planning.isFerie(day.date), isSolidarityDay: planning.isSolidarityDay(day.date)}">{{day.day}} <span class=holidays ng-if=planning.isFerie(day.date)>férié</span> <span class=solidarityDay ng-if=planning.isSolidarityDay(day.date)>Journée de solidarité</span></p><div class=hour-cursor ng-style="{left: planning.currentTimeToPixels()+\'px\'}" ng-if="planning.isCurrent() && planning.isInDayRange()"><div class=hour-caret></div></div><div class=planning-2pc></div><zl-planning-line zoom=planning.zoom position=day.date absences=day.absences[i] day-start=planning._dayStart day-end=planning._dayEnd ng-repeat="i in planning.keys(day.value) track by $index" class="day b-b" events=day.value[i] pauses=planning.entitiesPauses[i][$parent.$index] holidays=planning.holidays drop-callback="planning.dropEvent({h: $hour, m: $minutes, d: i, entity: i, $data: $data, $event: $event, day: day.key})" click-callback="planning.clickCallbackWrapper({h: $hour, m: $minutes, d: i, entity: i})" is-solidarity-day=planning.isSolidarityDay></zl-planning-line></div></div></div></div></div><div ng-if="planning.mode ===\'week-advanced\'" class=advanced-week><div class=days-list><div class=day-advanced>&nbsp;</div><div class=day-advanced ng-repeat="day in planning.daysList" ng-click=planning.dayCallback({$day:day}) ng-class="{isFerie: planning.isFerie(day), isSolidarityDay: planning.isSolidarityDay(day)}"><span class=day-text>{{day | format:\'dddd\' | capitalize}}<br><small>{{day | format:\'ll\'}}</small> <span class=holidays ng-if=planning.isFerie(day)>férié</span> <span class=solidarityDay ng-if=planning.isSolidarityDay(day)>Journée de solidarité</span></span></div></div><div class=advanced-week-container ng-repeat="name in planning.keys(planning.sortedEvents)"><div class=left-column-advanced><span style=margin:auto>{{planning.getName(name)}}</span></div><div ng-repeat="day in planning.allowedDays" style="overflow: hidden;" class=day-advanced><zl-planning-vertical-line day=planning.daysList[$index] zoom=planning.zoom drop-callback="planning.dropEvent({h: $hour, m: $minutes, d:day, entity: name, $data: $data, $event: $event})" day-start=planning._dayStart day-end=planning._dayEnd is-in-range=planning.isInRange(planning.daysList[$index]) events=planning.getEvents(name)[day] pauses=planning.entitiesPauses[name][$index] absences=planning.absences[name] holidays=planning.holidays click-callback="planning.clickCallbackWrapper({h: $hour, m: $minutes, d: day, entity: name})" is-solidarity-day-scoped=planning.isSolidarityDay></zl-planning-vertical-line></div></div></div><div ng-if="planning.mode === \'month\'" style="height: 100%; z-index: 1000;"><div class=month-header><span class=month-text>{{planning.month | capitalize}}</span></div><div class=day-header><div class=day ng-repeat="day in []|range:7"><span class=day-text>{{day | day}}</span></div></div><div class=month-container><zl-planning-day ng-repeat="day in planning.days" day=day events=planning._events absences=planning.absences drop-callback="planning.dropEvent({$data: $data, $event: $event, moment: day.date})" entities=planning.entitiesName ng-dblclick="planning.clickWeekEvent(day, $event)" holidays=planning.holidays></zl-planning-day><zl-planning-week-line ng-repeat="(week, events) in planning.multipleDaysEvents" events=events week=week one-day-events=planning.oneDayEvents[week] style="height: 20%; pointer-events: none"></zl-planning-week-line></div></div>'),e.put("/directives/planning-day-block/planning-day.html",'<div class=day-block ng-class="{\'empty-day\': dayCtrl.isDefined }" ng-click=planning.dayCallback({$day:dayCtrl.day.date})><div style=position:absolute;left:5px;top:5px; ng-if="dayCtrl.day.date.day() === 1">{{dayCtrl.day.date.week()}}</div><div class=day-number>{{ dayCtrl.day.date.date() }}</div><span ng-if=dayCtrl.isFerie class=holidays>férié</span> <span class=solidarityDay ng-if=dayCtrl.isSolidarityDay(day.date)>Journée de solidarité</span><div class=events-container><div ng-style="{\'background-color\': event.color}" class=month-event ng-repeat="event in dayCtrl.day.events |limitTo:5">{{event.title}}</div></div><div class=absents-container tooltip-append-to-body=true ng-if=dayCtrl.absents.length uib-tooltip-html=dayCtrl.absentsString>{{dayCtrl.absents.length}} absent(s)</div></div>'),e.put("/directives/planning-left-column/planning-left-column.html",'<div class="left-column planning-left-column" ng-switch=planningLeftColumn.mode><div class=planning-head></div><div class=left-body><div class=planning-2pc><span class=holidays ng-if="planningLeftColumn.isFerie && !planningLeftColumn.isSolidarityDay(planningLeftColumn.position) && (planningLeftColumn.mode === \'day\' || planningLeftColumn.mode === \'3days\')">Férié</span> <span class=solidarityDay style=margin-top:1px!important; ng-if="planningLeftColumn.isSolidarityDay(planningLeftColumn.position) && (planningLeftColumn.mode === \'day\' || planningLeftColumn.mode === \'3days\')">Journée de solidarité</span></div><div class=days-body ng-switch-when=week><div class="dayName row8 b-b animate" ng-repeat="day in planningLeftColumn.days track by $index" ng-class="{today: (planning.isToday(day.dayOfYear())), isFerie: planning.isFerie(day)}" ng-click=planning.dayCallback({$day:day})><h4>{{day | format:\'dddd\' | capitalize}}<br><small>{{day | format:\'ll\'}}<span class=holidays ng-if=planning.isFerie(day)>férié</span></small></h4><div ng-click=$event.stopPropagation() class=day-absence ng-if=planningLeftColumn._absences[$index].length><div class=absents-container ng-click="planning.showAbsencesCallBackWrapper(planningLeftColumn._absences, $index)">{{ planningLeftColumn._absences[$index].length }} absent(s)</div></div></div></div><div class=days-body ng-switch-when=day><div class="dayName dayNameDuplication row8 b-b animate" ng-if=planningLeftColumn.activateDuplicationButtons uib-popover-template="\'planningDayPopOver.html\'" popover-placement=right ng-repeat="tech in planningLeftColumn.column"><h4 class=techname>{{tech.fullname || \'\'}}</h4></div><div class="dayName row8 b-b animate" ng-if=!planningLeftColumn.activateDuplicationButtons uib-popover-template="\'planningDayPopOver.html\'" popover-placement=right ng-repeat="tech in planningLeftColumn.column"><h4 class=techname>{{tech.fullname || \'\'}}</h4></div></div></div><script type=text/ng-template id=planningDayPopOver.html><button ng-if="planningLeftColumn.activateDuplicationButtons" class="btn btn-primary" style="width: 100%; margin-bottom: 5px;" ng-click=\'planningLeftColumn.triggerDayEvent(tech)\'>Dupliquer la journée</button> <button ng-if="planningLeftColumn.activateDuplicationButtons" class="btn btn-primary" style="width: 100%;" ng-click=\'planningLeftColumn.triggerDayEvent(tech, true)\'>Déplacer la journée</button><\/script><div style=height:10px></div></div>'),e.put("/directives/planning-line/planning-line.html",'<div ng-style="{height: line.containerHeight}"><div style="position: absolute; height: 100%; width: 100%; z-index: 1" zl-planning-drag-drop zl-drop="line.dropEvent($data, $event, line)"><div class="b-b b-r all-day day-hour" ng-dblclick="line.clickEvent(n, $event, line)" ng-mouseleave=line.leaveAbsence() uib-tooltip={{line.tooltip}} tooltip-append-to-body=true tooltip-placement=top ng-style="{width: line.calcWidth(line.zoom)}" ng-repeat="n in [] | range:line.range" hour={{n}}><span class=half-hour></span></div></div><div ng-repeat="absence in line._absences track by $index" ng-mouseenter=line.hoverAbsence(absence) id={{absence._id}} class="{{absence.class}} absence {{absence._id}}" tooltip-append-to-body=true tooltip-placement=top uib-tooltip={{absence.tooltip}} data-html=true style="height: 100%" ng-style=absence.style></div><div ng-repeat="event in line._events" zl-planning-drag-drop ng-click="planning.eventCallback({\'event\':event})" zl-drag=event ng-style="{ height: event.style.height, top: event.style.top, width: event.style.totalWidth, left: event.pre > 0 ? line.preEvent[event.id].style.left : event.style.left }" style="position: absolute; z-index: 3; display: flex; flex-flow: row nowrap"><div ng-if="event.pre > 0" ng-style="{width: line.preEvent[event.id].style.width, \'background\': line.preEvent[event.id].style[\'background\']}" style="display: inline-block; position: relative; height: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.preEvent[event.id].tooltip}}><div class=title-container><span><i style="height: 100%; font-size: 1.2em;" class="mdi mdi-car"></i></span></div></div><div class=event style="display: inline-block; position: relative; height: 100%;" data-context-menu=/templates/planning-context-menu.html tooltip-append-to-body=true tooltip-placement="{{event.tooltipTemplate? \'auto\': \'top\'}}" ng-attr-uib-tooltip="{{!event.tooltipTemplate ? event.tooltip : undefined}}" ng-attr-uib-tooltip-template="{{\'\' + event.tooltipTemplate}}" tooltip-class=planning-event-tooltip ng-style="{ width: event.style.width, background: event.style[\'background-color\'], \'background-image\': event.style[\'background-image\'], color: event.style.color, \'border-left\': event.pre > 0 ? \'none\': \'\' }"><div class=event-line-container style><div class=event-line ng-style="{\'background-color\': event.color}" ng-if=!event.continuedBefore></div></div><div class=title-container><span>{{event.title}}</span></div></div><div ng-if="event.post > 0" ng-style="{width: line.postEvent[event.id].style.width, \'background\': line.postEvent[event.id].style[\'background\']}" style="display: inline-block; position: relative; height: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.postEvent[event.id].tooltip}}><div class=title-container><span><i style="height: 100%; font-size: 1.2em;" class="mdi mdi-car"></i></span></div></div></div><div ng-repeat="pause in line.breaks track by $index" class=planning-pause-element style="height: 100%;" ng-style=pause.style></div></div>'),e.put("/directives/planning-top-row/planning-top-row.html",'<div class=planning-top-row><div ng-repeat="hour in planningTopRow.hours" class=day-hour ng-style="{width: planningTopRow.calcWidth(planningTopRow.zoom), margin: planningTopRow.calcMargin(planningTopRow.zoom, $index)}"><h4>{{hour | format:\'HH:mm\'}}</h4></div></div>'),e.put("/directives/planning-vertical-line/planning-vertical-line.html",'<div ng-style="{height: line.containerHeight}" data-context-menu=/templates/planning-line-context-menu.html><div ng-if=!line._absences style="position: absolute; height: 100%; width: 100%; z-index: 1" ng-mouseleave=line.leaveLine()><div ng-repeat="n in [] | range: line.range" style="display: flex; z-index: 1"><div style="display: flex; align-items: flex-end;"><span class=hour-text>{{n + 1 + line.dayStart.h}}</span></div><div style="width: 100%;" class="b-b b-r all-day" ng-style="{height: line.calcWidth(line.zoom)}" ng-dblclick="line.clickEvent(n, $event, line.day)" hour="{{n + line.dayStart.h}}" zl-planning-drag-drop zl-drop="line.dropEvent($data, $event, line.day)"></div></div></div><div ng-if=line._absences tooltip-append-to-body=true tooltip-placement=top tooltip-classes=absence-tooltip uib-tooltip={{line._absences[0].tooltip}} ng-class="{\'no-notification\': !line.isInRange}" style="position: absolute; height: 100%; width: 100%; z-index: 1" ng-mouseleave=line.leaveLine()><div ng-repeat="n in [] | range: line.range" style="display: flex; z-index: 1"><div style="display: flex; align-items: flex-end;"><span class=hour-text>{{n + 1 + line.dayStart.h}}</span></div><div style="width: 100%;" class="b-b b-r all-day" ng-style="{height: line.calcWidth(line.zoom)}" ng-dblclick="line.clickEvent(n, $event, line.day)" hour="{{n + line.dayStart.h}}" zl-planning-drag-drop zl-drop="line.dropEvent($data, $event, line.day)"></div></div></div><div ng-repeat="event in line._events" zl-planning-drag-drop ng-click="planning.eventCallback({\'event\':event})" zl-drag=event ng-style="{ width: event.style.height, right: event.style.top, height: event.pre > 0 ? line.preEvent[event.id].style.totalWidth : event.style.width, top: event.pre > 0 ? line.preEvent[event.id].style.left : event.style.left }" style="position: absolute; z-index: 2;"><div ng-if="event.pre > 0" ng-style="{height: line.preEvent[event.id].style.width, \'background\': line.preEvent[event.id].style[\'background\']}" style="display: flex; position: relative; width: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.preEvent[event.id].tooltip}}><div class=title-container><span><i style="width: 100%; font-size: 1.2em;" class="mdi mdi-car"></i></span></div></div><div class=event style="display: flex; position: relative; width: 100%;" tooltip-append-to-body=true tooltip-placement="{{event.tooltipTemplate? \'auto\': \'top\'}}" ng-attr-uib-tooltip="{{!event.tooltipTemplate ? event.tooltip : undefined}}" ng-attr-uib-tooltip-template="{{\'\' + event.tooltipTemplate}}" tooltip-class=planning-event-tooltip data-context-menu=/templates/planning-context-menu.html ng-style="{ height: event.style.width, overflow: \'hidden\', \'background-image\': event.style[\'background-image\'], background: event.style[\'background-color\'], color: event.style.color, \'border-left\': event.pre > 0 ? \'none\': \'\' }"><div class=event-line-container style><div class=event-line ng-style="{\'background-color\': event.color}"></div></div><div class=title-container><span>{{event.title}}</span></div></div><div ng-if="event.post > 0" ng-style="{height: line.postEvent[event.id].style.width, \'background\': line.postEvent[event.id].style[\'background\']}" style="display: inline-block; position: relative; width: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.postEvent[event.id].tooltip}}><div class=title-container><span><i style="width: 100%; font-size: 1.2em;" class="mdi mdi-car"></i></span></div></div></div><div ng-repeat="pause in line.breaks track by $index" class=planning-pause-element style="width: 95%; left: 5%;" ng-style=pause.style></div><div ng-repeat="absence in line._absences track by $index" id={{absence._id}} class="{{absence.class}} absence {{absence._id}}" style="width: 95%; left: 5%;" ng-style=absence.style></div></div>'),e.put("/directives/planning-week-line/planning-week-line.html","<div class=week-line ng-class=\"'week-' + line.week\" style=padding-top:20px;><div class=single-day-events style=\"height:40%; position:relative;\"><div zl-planning-drag-drop zl-drag=ev ng-repeat=\"ev in line.oneDayEvents\" ng-style=\"{'top': ev.style.top, 'height': ev.style.height, 'background-color': ev.style['background-color'], 'color' : ev.style.color, 'width': ev.style.width, 'left': ev.style.left}\" style=\"position:absolute;border: 1px solid black;pointer-events: auto; overflow: hidden;\" ng-click=\"planning.weekEventCallback({event: ev})\" tooltip-append-to-body=true tooltip-placement=\"{{ev.tooltipTemplate? 'auto': 'top'}}\" ng-attr-uib-tooltip=\"{{!ev.tooltipTemplate ? ev.tooltip : undefined}}\" ng-attr-uib-tooltip-template=\"{{'' + ev.tooltipTemplate}}\" tooltip-class=planning-event-tooltip class=single-day-event><div class=event-line-container><div class=event-line ng-style=\"{'background-color': ev.color}\" ng-if=!ev.continuedBefore></div></div><div class=single-day-event-title data-context-menu=/templates/planning-context-menu.html><span>{{ev.title}}</span></div></div></div><div class=multiple-days-events style=\"height:40%; position: relative;\"><div class=multiple-day-event ng-repeat=\"event in line.displayedEvents\" style=\"position: absolute; border: 1px solid black;pointer-events: auto; overflow: hidden;\" zl-planning-drag-drop zl-drag=event ng-click=\"planning.weekEventCallback({event: event})\" tooltip-append-to-body=true tooltip-placement=\"{{event.tooltipTemplate? 'auto': 'top'}}\" ng-attr-uib-tooltip=\"{{!event.tooltipTemplate ? event.tooltip : undefined}}\" ng-attr-uib-tooltip-template=\"{{'' + event.tooltipTemplate}}\" tooltip-class=planning-event-tooltip ng-style=\"{'top': event.style.top, 'height': event.style.height, 'background-color': event.style['background-color'], 'color' : event.style.color, 'width': event.style.width, 'left': event.style.left}\"><div class=event-line-container><div class=event-line ng-style=\"{'background-color': event.color}\" ng-if=!event.continuedBefore></div></div><div class=multiple-day-event-title data-context-menu=/templates/planning-context-menu.html><span>{{event.title}}</span></div></div></div></div>")}]),function(){"use strict";window.angular.module("90Tech.planning").filter("day",[function(){return function(e){return null==e||isNaN(e)||6<parseInt(e)?"":["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"][e]}}])}(),function(){"use strict";window.angular.module("90Tech.planning").filter("format",function(){return function(e,n){return e.format(n)}}).filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}})}(),function(){"use strict";window.angular.module("90Tech.planning").filter("range",function(){return function(e,n){n=parseInt(n);for(var t=0;t<n;t++)e.push(t);return e}})}(),function(){"use strict";window.angular.module("90Tech.planning").filter("strPlanning",["planningConfiguration",function(n){return function(e){return n.strings[e]}}])}(),function(i,a,o){"use strict";i.module("90Tech.planning").service("AbsenceService",function(){a.extend(this,{parseAbsences:function(e,n){if(Array.isArray(n))return function e(n){var t=n.map(function(e,n){return e.index=n,Object.assign({},e,{index:n})});if(!a.any(t,function(n){return a.any(t,function(e){return n.index!==e.index&&o.range(n.start,n.end).overlaps(o.range(e.start,e.end))})}))return n;n=n.reduce(function(e,n,t,a){a=a[t+1];return a&&n&&o.range(n.start,n.end).overlaps(o.range(a.start,a.end))&&e.push({start:o.min(o(i.copy(n.start)),o(i.copy(a.start))),end:o.max(o(i.copy(n.end)),o(i.copy(a.end)))}),e},[]);return e(n)}(e.filter(function(e){return o.range(e.start,e.end).overlaps(o.range(n[0],n[1]))}).map(function(e){return e.style={},o(e.start).isSame(o(i.copy(n[0])))&&(e.style.top="0px",e.start=n[0]),o(e.start).isBefore(o(i.copy(n[0])))&&(e.start=n[0],e.style.top="0px"),o(e.end).isAfter(o(i.copy(n[1])))&&(e.end=n[1]),e}));throw new Error("Invalid interval")}})})}(window.angular,window._,window.moment),function(e,n){"use strict";function t(){n.extend(this,{getLuminance:function(e){e=e||"#ffffff";var n,t,a=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;a=a.test(e)?(a=a.exec(e),n=parseInt(a[1]),t=parseInt(a[2]),parseInt(a[3])):(a=e.substring(1),e=parseInt(a,16),n=e>>16&255,t=e>>8&255,e>>0&255);return.2126*n+.7152*t+.0722*a}})}e.module("90Tech.planning").service("ColorService",t),t.$inject=[]}(window.angular,window._,window.moment),function(){"use strict";window.angular.module("90Tech.planning").provider("planningConfiguration",function(){var t=this;t.BASE_SIZE=10,t.MAX_PARALLEL=3,t.strings={nothing_to_show:"Rien à afficher"},t.DAYS=[0,1,2,3,4,5,6],t.parallelText="parallel items",this.setParallelText=function(e){t.parallelText=""+e},this.setBaseSize=function(e){t.BASE_SIZE=e},this.setMaxParallel=function(e){t.MAX_PARALLEL=e},this.setString=function(e,n){t.strings[e]=n},this.setDays=function(e){t.DAYS=e},this.$get=[function(){return{strings:t.strings,BASE_SIZE:t.BASE_SIZE,MAX_PARALLEL:t.MAX_PARALLEL,parallelText:t.parallelText,DAYS:t.DAYS,absentTechnicianCallback:function(e){e()},isFerieCallback:function(e){e()},warningCallback:function(e){e()}}}]})}(),function(e,o,s){"use strict";e.module("90Tech.planning").service("HolidaysServicePlanning",function(){var i=this;o.extend(i,{solidarityDays:[],masterDayRange:[],aliaCompanySettings:{showSolidarityDay:!1},isSolidarityDay:function(e){let t=!1;if(e&&o.get(i.aliaCompanySettings,"showSolidarityDay",!1)){const a=s(e);i.solidarityDays.forEach(e=>{var n;e.master&&(i.masterDay=e),a.get("year")>=o.get(i.masterDay,"year")&&(n=i.masterDayRange.filter(e=>s(e.date).get("year")===s(a).get("year")&&e.rule===i.masterDay.rule)).length&&(e=n[0]),s(e.start).unix()<=s(a).endOf("day").unix()&&s(e.end).unix()>=s(a).endOf("day").unix()&&(t=!0)})}return t}})})}(window.angular,window._,window.moment),function(e,d,c){"use strict";function n(e){function r(e,n){return n=n||2,(new Array(n).join("0")+e).slice(-n)}d.extend(this,{generateGradient:function(a,e){var t=a.style["background-color"],i=function(e){0===e.indexOf("#")&&(e=e.slice(1));3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);if(6!==e.length)throw new Error("Invalid HEX color.");var n=(255-parseInt(e.slice(0,2),16)).toString(16),t=(255-parseInt(e.slice(2,4),16)).toString(16),e=(255-parseInt(e.slice(4,6),16)).toString(16);return"#"+r(n)+r(t)+r(e)}(t),n=a.start,o=a.end,s=c.range(n,o),l=s.diff("milliseconds");n=function(e){return d.map(e,function(e){var n=(a.start.isAfter(e.start)?a:e).start,e=(a.end.isBefore(e.end)?a:e).end,n=c.range(n,e),e=n.diff("milliseconds")/l*100,t=s.clone();return t.subtract(n),t.length?{range:n,endPercentage:e+(e=(t[0].diff("milliseconds")||l)/l*100),startPercentage:e}:{range:n,endPercentage:100,startPercentage:0}})}(a.pauses),o=d.reduce(n,function(e,n){return e+", "+t+" "+n.startPercentage+"%, "+i+" "+n.startPercentage+"%, "+i+" "+n.endPercentage+"%, "+t+" "+n.endPercentage+"%"},"linear-gradient("+e+", "+t);return o+=", "+t+" 100%)"}})}e.module("90Tech.planning").service("PauseService",n),n.$inject=["ColorService"]}(window.angular,window._,window.moment),function(e,d,c){"use strict";function n(){d.extend(this,{overlap:function(e,t,a,n,i){for(var o=0<t.pre?c.range(c(t.start).subtract(t.pre,"minutes"),c(t.end)):t.range,s=0;s<e.length;s++){if(t.depth>a){var l,r=!1;if(d.each(e[a],function(e){var n=0<e.pre?c.range(c(e.start).subtract(e.pre,"minutes"),c(e.end)):e.range;(r=!(r=o.overlaps(n))&&i?t.start.day()===e.start.day()||t.start.day()===e.end.day()||t.end.day()===e.start.day()||t.end.day()===e.end.day():r)&&(e.start=c.min(t.start,e.start),e.end=c.max(t.end,e.end),e.range=c.range(e.start,e.end),e.line=a,e.eventList.push(t),e.technician!==t.technician)&&(e.technician="",t.technician="")}),r){n.push(t);break}t.depth=a,t.line=a,t.eventList||(l=d.cloneDeep(t),t.eventList=[l]),e[a].push(t);break}if(!e[s].length){e[s].push(t),t.line=s;break}if(!d.filter(e[s],function(e){var n=0<e.pre?c.range(c(e.start).subtract(e.pre,"minutes"),c(e.end)):e.range;if(r=!(r=o.overlaps(n))&&i?t.start.day()===e.start.day()||t.start.day()===e.end.day()||t.end.day()===e.start.day()||t.end.day()===e.end.day():r)return e.depth+=1,!0}).length){e[s].push(t),t.line=s;break}t.depth+=1,e[s+1]||(e[s+1]=[])}}})}e.module("90Tech.planning").service("PositionService",n),n.$inject=[]}(window.angular,window._,window.moment),function(e,d){"use strict";e.module("90Tech.planning").directive("zlPlanningDragDrop",function(){return{controller:function(){},scope:{},controllerAs:"dragDropCtrl",bindToController:{zlDrag:"=",zlDrop:"&"},link:function(n,e){let t=!1;var a=document.createElement("div"),i=e[0];function o(e){return a.style.height=i.clientHeight+"px",a.style.zIndex="1000",a.style.position="relative",a.style.left="-10000px",a.style.bottom="-10000px;",a.innerHTML=i.innerHTML,1<i.children.length?(a.children[0].style.float="left",a.style.backgroundColor=i.children[1].style.backgroundColor,a.style.width=i.clientWidth+"px"):(a.style.width=Math.min(i.clientWidth,200)+"px",a.style.backgroundColor=i.children[0].style.backgroundColor),e.dataTransfer.effectAllowed="move",document.body.appendChild(a),e.dataTransfer.setDragImage&&e.dataTransfer.setDragImage(a,0,0),d.each(document.querySelectorAll(".planning-event-tooltip"),function(e){e.remove()}),e.dataTransfer.setData("Text",JSON.stringify(n.dragDropCtrl.zlDrag)),this.classList.add("drag"),!1}function s(e){return n.$apply(function(){n.dragDropCtrl.zlDrop({$data:JSON.parse(e.dataTransfer.getData("Text")),$event:e})}),e.target.classList.remove("over"),this.classList.remove("over"),e.stopPropagation(),!1}function l(e){return e.target.classList.add("over"),!1}function r(e){return e.target.classList.remove("over"),!1}new IntersectionObserver((e,n)=>{e[0].isIntersecting&&!t?(t=!0,i.attributes["zl-drag"]&&(i.draggable=!0,i.addEventListener("dragstart",o,!1)),i.attributes["zl-drop"]&&(i.addEventListener("drop",s,!1),i.addEventListener("dragenter",l,!1),i.addEventListener("dragleave",r,!1))):!e[0].isIntersecting&&t&&(i.removeEventListener("dragstart",o,!1),i.removeEventListener("drop",s,!1),i.removeEventListener("dragenter",l,!1),i.removeEventListener("dragleave",r,!1),t=!1)},{threshold:.5}).observe(e[0])}}})}(window.angular,_),function(){"use strict";function e(a){return{restrict:"A",scope:{scrollLeft:"="},link:function(e,n,t){n.bind("mousewheel",function(e){n[0].scrollLeft-=e.wheelDelta/3}),n.addClass("slider"),e.scrollLeft,a(function(){n[0].scrollLeft=e.scrollLeft-n[0].offsetWidth/2},100)}}}window.angular.module("90Tech.planning").directive("zlHorizontalScroll",e),e.$inject=["$timeout"]}(),function($,C,z){"use strict";function e(e,y,g){var v=y.BASE_SIZE,h=this;function n(){switch(h.solidarityDays.length&&(g.solidarityDays=h.solidarityDays),h.masterDayRange.length&&(g.masterDayRange=h.masterDayRange),g.aliaCompanySettings=h.aliaCompanySettings,h.zoom=parseInt(h.zoom),h.allowedDays=h.usableDays.sort()||y.DAYS,h.daysList=h.allowedDays.map(function(e){var n=C(h.position);return n.weekday(e),n}),(!h.zoom||h.zoom<1)&&(h.zoom=1),h._dayStart=h.dayStart?k(h.dayStart):k(0),h._dayEnd=h.dayEnd?k(h.dayEnd):k(24),h.width=h.zoom*(parseInt(h._dayEnd.h)-parseInt(h._dayStart.h)+1)*v+"px",h.sortedEvents=void 0,h.mode){case"week":h._events=z.flatten(z.map(h.events,f)),h._events=b(h._events),h.sortedEvents=z.groupBy(h._events,function(e){return e.start.format("DD/MM/YYYY")}),p=(p=h.sortedEvents)||{},u=C(h.position).weekday(0),z.times(7,function(e){e=C($.copy(u)).add(e,"days").format("DD/MM/YYYY");p[e]||(p[e]=[])});break;case"day":case"week-advanced":h._events=z.flatten(z.map(h.events,f)),h._events=b(h._events),h.sortedEvents=z.groupBy(h._events,function(e){return e[h.dayField]}),"week-advanced"===h.mode&&(h.sortedEvents=z.mapValues(h.sortedEvents,function(e){return z.groupBy(e,function(e){return e.start.weekday()})})),c=(c=h.sortedEvents)||{},z.each(h.entities,function(e){c[e]||(c[e]=[])});break;case"3day":h._events=z.flatten(z.map(h.events,f)),h._events=b(h._events),h.sortedEvents=z.reduce(h.entities,function(e,n){return e[n]=[],e},{});z.keys(h.sortedEvents);h.groupedEvents=z.map(z.groupBy(h._events,function(e){return C(e.start).startOf("day").unix()}),function(e,n){var t={key:n,date:C.unix(n).startOf("day").toDate(),day:C.unix(n).startOf("day").format("dddd DD MMMM"),value:z.groupBy(e,function(e){return e.technician}),absences:$.copy(h.absences)};return z.each(h.entities,function(e){t.value[e]||(t.value[e]=[])}),t});for(var e=C(h.position).hour(h._dayStart.h).minute(h._dayStart.m).second(0),n=C(h.position).hour(h._dayEnd.h).minute(h._dayEnd.m).second(59),t=[{start:$.copy(e),end:$.copy(n)}],a=0;a<2;){n.add(1,"day");var i=n.day()-1;i<0&&(i=6),(z.isEmpty(h.allowedDays)||z.includes(h.allowedDays,i))&&(t.push({start:$.copy(n).hour(h._dayStart.h).minute(h._dayStart.m).second(0),end:$.copy(n).hour(h._dayEnd.h).minute(h._dayEnd.m).second(59)}),a++)}z.each(t,function(e){var n,t=""+C(e.start).startOf("day").unix();z.find(h.groupedEvents,function(e){return e.key===t})||(n={key:t,date:C($.copy(e.start)).startOf("day").toDate(),day:C($.copy(e.start)).startOf("day").format("dddd DD MMMM"),value:{},absences:$.copy(h.absences)},z.each(z.keys(h.sortedEvents),function(e){n.value[e]=[]}),h.groupedEvents.push(n))}),h.groupedEvents=z.sortBy(h.groupedEvents,function(e){return e.key});break;case"month":for(var o=C(h.position).date(1).hours(0).minutes(0).seconds(0),e=(h.month=C(h.position).date(1).hours(0).minutes(0).seconds(0).format("MMMM"),h.decallage=o.isoWeekday()-1,h.decallage<0&&(h.decallage=0),h.oneDayEvents=z(h.events).filter(function(e){return e.start.dayOfYear()===e.end.dayOfYear()&&e.start.month()===C(h.position).month()}).groupBy(function(e){return Math.floor((e.start.date()+h.decallage)/7.01)}).value(),h.multipleDaysEvents=z(h.events).filter(function(e){return e.start.dayOfYear()!==e.end.dayOfYear()}).map(m).flatten().groupBy(function(e){return Math.floor((e.start.date()+h.decallage)/7.01)}).value(),C(h.position).endOf("month").isoWeek()),s=C(h.position).startOf("month").isoWeek(),l=(e=(e=1===e?C(h.position).isoWeeksInYear()+1:e)<s?s+e:e)-s+1,r=0;r<l;r++)void 0===h.multipleDaysEvents[r]&&(h.multipleDaysEvents[r]=[]);if(h.days=[],0<o.isoWeekday()-1)for(r=0;r<o.isoWeekday()-1;r++)h.days.unshift({});z.times(o.daysInMonth(),function(e){e=C(o).add(e,"days");h.days.push({date:e,events:[]})});for(var d=35<h.days.length?42:35;h.days.length<d;)h.days.push({})}var c,p,u}function t(n){return h.entitiesName.find(e=>e._id===n).fullname}function f(e){e=$.copy(e);var n=C(e.start).hour(h._dayStart.h).minute(h._dayStart.m).second(0),t=C(e.end).hour(h._dayEnd.h).minute(h._dayEnd.m).second(59);if(e.start.dayOfYear()===e.end.dayOfYear()){if(e.start.isBefore(n)){if(e.end.isBefore(n))return[];e.start=n}if(e.end.isAfter(t)){if(e.start.isAfter(t))return[];e.end=t}return[e]}var t=$.copy(e),n=(t.end=C(e.start).hour(h._dayEnd.h).minute(h._dayEnd.m).second(59),e.start.isBefore(n)&&(t.start=n),C(e.start).add(1,"day").hour(h._dayStart.h).minute(h._dayStart.m)),a=C(e.start).hour(h._dayEnd.h).minute(h._dayEnd.m);if(e.end.isBefore(n))return t.start.isAfter(a)?[]:[t];t.continuedAfter=!0;n=$.copy(e);return n.start=C(e.start).add(1,"day").hour(h._dayStart.h).minute(h._dayStart.m),n.continuedBefore=!0,e.start.isAfter(a)?f(n):[t].concat(f(n))}function m(e){var n;if(e.start.isAfter(e.end)&&(n=e.start,e.start=e.end,e.end=n),e.start.year()<h.position.year()||e.start.month()<h.position.month()){if(e.end.year()<h.position.year()||e.end.month()<h.position.month())return[];e.start=C(h.position).startOf("month")}if(e.end.month()>h.position.month()||e.end.year()!==h.position.year()){if(e.start.month()>h.position.month())return[];e.end=C(h.position).endOf("month")}return e.start.isoWeek()===e.end.isoWeek()?[e]:(n=$.copy(e),e=$.copy(e),n.continuedAfter=!0,e.continuedBefore=!0,n.end=C(n.start).endOf("week"),e.start.add(1,"week").startOf("week"),[n].concat(m(e)))}function b(e){return z.filter(e,function(n){switch(h.mode){case"week":case"week-advanced":e=C(h.position).weekday(0).hour(h._dayStart.h).minute(h._dayStart.m).second(0),t=C(h.position).weekday(6).hour(h._dayEnd.h).minute(h._dayEnd.m).second(59);break;case"day":e=C(h.position).startOf("day").hour(h._dayStart.h).minute(h._dayStart.m),t=C(h.position).endOf("day").hour(h._dayEnd.h).minute(h._dayEnd.m);break;case"3day":for(var e=C(h.position).hour(h._dayStart.h).minute(h._dayStart.m).second(0),t=C(h.position).hour(h._dayEnd.h).minute(h._dayEnd.m).second(59),a=[{start:$.copy(e),end:$.copy(t)}],i=0;i<2;){t.add(1,"day");var o=t.day()-1;o<0&&(o=6),(z.isEmpty(h.allowedDays)||z.includes(h.allowedDays,o))&&(a.push({start:$.copy(t).hour(h._dayStart.h).minute(h._dayStart.m).second(0),end:$.copy(t).hour(h._dayEnd.h).minute(h._dayEnd.m).second(59)}),i++)}return z.some(a,function(e){return n.start.isBetween(e.start,e.end)||n.end.isBetween(e.start,e.end)});case"month":e=C(h.position).date(1).hour(h._dayStart.h).minute(h._dayStart.m).second(0),t=C(h.position).weekday(C(h.position).daysInMonth()).hour(h._dayEnd.h).minute(h._dayEnd.m).second(59)}return n.start.isBetween(e,t)||n.end.isBetween(e,t)})}function k(e){return 24<=e?{h:23,m:59}:{h:e,m:0}}function a(e){switch(h.mode){case"week":return Object.keys(e).sort(function(e,n){return D(e)-D(n)});case"week-advanced":case"day":case"3day":return h.entitiesName?h.entitiesName.map(e=>e._id):[]}}function i(e){return h.sortedEvents[e]}function o(e){return h.position.week()===C().week()&&e===C().dayOfYear()}function s(n){if(h.holidays)return h.holidays.find(e=>C(e.date).format("L")===C(n).format("L"))}function l(e){return g.isSolidarityDay(e)}function r(e){var n=C($.copy(e));return z.any(h._absences,function(e){return e.range.contains(n)})}function d(){return C().hour()>parseInt(h._dayStart.h)&&C().hour()<parseInt(h._dayEnd.h)}function c(){var e=60*(C().hour()-parseInt(h._dayStart?h._dayStart.h:0))+C().minutes();return Math.floor(h.zoom*(v*e)/60)}function p(){return h.position.isSame(C(),h.mode)}function u(e){var n;switch(h.mode){case"week":var t=e.d.split("/"),a=C(new Date(t[2],t[1]-1,t[0],e.h,e.m));break;case"3day":case"day":a=C(h.position).hour(e.h).minute(e.m),n=e.entity;break;case"week-advanced":n=e.entity,a=C(h.position).hour(e.h).minute(e.m).second(0).weekday(e.d)}h.clickCallback({$moment:a,$entity:n})}function w(e,n){e.date&&h.clickCallback({$moment:e.date})}function E(e,n){h.showAbsencesCallback({$absences:e,$day:n})}function S(e){if(!(t=e.moment))switch(h.mode){case"week":var n=C(D(e.d)).dayOfYear(),t=C(h.position).hour(e.h).minute(e.m).second(0).dayOfYear(n);break;case"week-advanced":t=C(h.position).hour(e.h).minute(e.m).second(0).weekday(e.d);break;case"day":t=C(h.position).hour(e.h).minute(e.m);break;case"3day":t=C.unix(e.day).hour(e.h).minute(e.m)}var a=z.includes(["week-advanced","day","3day"],h.mode)?e.entity:void 0;"month"!==h.mode||!s(t)||h.isSolidarityDay(t)?h.dropCallback({$moment:t,$data:e.$data,$event:e.$event,$entity:a}):y.isFerieCallback(function(){h.dropCallback({$moment:t,$data:e.$data,$event:e.$event,$entity:a})})}function D(e){e=e.split("/");return new Date(e[2],e[1]-1,e[0])}function _(e,n){return n?h.moveAction({$element:$.copy(e)}):h.duplicateAction({$element:$.copy(e)})}function x(e){var n;return!h.interventionShowInterval?.showInterval||"number"!=typeof h.interventionShowInterval.interval||(n=C().add("days",h.interventionShowInterval.interval),C(e).startOf("day").unix()<n.unix())}h.$onInit=function(){z.extend(h,{isToday:o,currentTimeToPixels:c,isCurrent:p,clickCallbackWrapper:u,showAbsencesCallBackWrapper:E,isInDayRange:d,keys:a,getEvents:i,clickWeekEvent:w,dropEvent:S,isFerie:s,isSolidarityDay:l,hasAbsence:r,getName:t,dayEvent:_,isInRange:x}),n()},e.$watchCollection(function(){return[h.events,h.entities,h.position,h.mode,h.dayStart,h.dayEnd,h.zoom,h.usableDays]},n)}$.module("90Tech.planning").directive("zlPlanning",function(){return{restrict:"E",templateUrl:"/directives/planning/planning.html",controller:e,controllerAs:"planning",bindToController:{zoom:"=",events:"=",entities:"=",entitiesName:"=",entitiesPauses:"=?",absences:"=?",position:"=",mode:"=",dayStart:"=",dayEnd:"=",dayField:"=",eventCallback:"&",dayCallback:"&",clickCallback:"&",weekEventCallback:"&",dropCallback:"&",usableDays:"=?",action:"&?",duplicateAction:"&?",moveAction:"&?",holidays:"=",solidarityDays:"=",showAbsencesCallback:"&",aliaCompanySettings:"=",interventionShowInterval:"=",masterDayRange:"="},scope:{}}}),e.$inject=["$scope","planningConfiguration","HolidaysServicePlanning"]}(window.angular,window.moment,window._),function(e,s,l){"use strict";function n(e,n){var a=this;function t(e,n){a.dropCallback({$data:e,$event:n})}function i(e){return n.isSolidarityDay(e)}function o(e){const t=[];return e.forEach(n=>{t.push(a.entities.find(e=>e._id===n).fullname)}),t}a.$onInit=function(){s.extend(a,{dropEvent:t,getName:o,isSolidarityDay:i,absents:[]}),a.isDefined=void 0===a.day.events,a.holidays&&a.day.date&&(a.isFerie=a.holidays.find(e=>l(e.date).format("L")===l(a.day.date).format("L"))),e.$watchCollection([a.day,a.absences],function(){a.day&&a.day.date&&a.absences&&Object.keys(a.absences).length?(a.absents=Object.keys(a.absences).reduce(function(e,n){var t=a.absences[n];return s.any(t,function(e){var n=l.range(e.start,e.end);return 0!==l(e.start).diff(e.end,"minutes")&&(12===l(e.start).hours()&&l(e.start).isSame(a.day.date,"day")?!!l(e.start).isBetween(a.day.date,l(a.day.date).endOf("day")):!!a.day.date.within(n)||void 0)})&&e.push(n),e},[]),a.absentsString="<div>"+a.getName(a.absents).join("<br>")+"</div>"):(a.absentsString="",a.absents=[])})}}e.module("90Tech.planning").directive("zlPlanningDay",function(){return{restrict:"E",replace:!0,templateUrl:"/directives/planning-day-block/planning-day.html",controller:n,controllerAs:"dayCtrl",bindToController:{day:"=",events:"=",clickCallback:"&",entities:"=?",dropCallback:"&",absences:"=?",holidays:"="},scope:!0,link:function(n,e){e=e[0];window.addEventListener("dragover",function(e){e.preventDefault()},!1),window.addEventListener("drop",function(e){e.preventDefault()},!1),e.addEventListener("drop",function(e){return e.preventDefault(),e.stopPropagation(),e.stopPropagation&&e.stopPropagation(),this.classList.remove("over"),n.$apply(function(){n.dayCtrl.dropEvent(JSON.parse(e.dataTransfer.getData("Text")),e)}),!1},!1),e.addEventListener("dragenter",function(e){return this.classList.add("over"),!1},!1),e.addEventListener("dragleave",function(e){return this.classList.remove("over"),!1},!1)}}}),n.$inject=["$scope","HolidaysServicePlanning"]}(window.angular,window._,window.moment),function(s,l,r){"use strict";function e(e,n){var i=this;function t(){if(i.threeDays||(i.activateDuplicationButtons=!0),i.days=[],i.allowedDays=i.usableDays,i._absences=[],"week"===i.mode){if(r.forEach(i.allowedDays,function(e){var n=l(i.position);n.weekday(e),i.days.push(n)}),i.days=r.sortBy(i.days,function(e){return l(e).toDate()}),i.absences){let a=0;i.days.forEach(n=>{i._absences[a]=[];for(var[e,t]of Object.entries(i.absences))t.forEach(e=>{(n.isBetween(l(e.start),l(e.end))||l(n).isSame(l(e.start),"day")&&l(n).isSame(l(e.end),"day"))&&i._absences[a].push(s.copy(e))});a++})}}else"day"===i.mode&&i.dayField&&(i.column=i.entitiesName)}function a(e,n){return n?i.dayEvent(s.copy(i.events[e._id]),!0):i.dayEvent(s.copy(i.events[e._id]))}function o(e){return n.isSolidarityDay(e)}i.$onInit=function(){r.extend(i,{triggerDayEvent:a,isSolidarityDay:o}),e.$watchCollection(function(){return[i.events,i.position,i.mode,i.dayStart,i.dayEnd,i.usableDays,i.entitiesName]},t)}}s.module("90Tech.planning").directive("zlPlanningLeftColumn",function(){return{restrict:"E",templateUrl:"/directives/planning-left-column/planning-left-column.html",controller:e,controllerAs:"planningLeftColumn",bindToController:{events:"=",entitiesName:"=",position:"=",mode:"=",dayField:"=",usableDays:"=",isFerie:"=?",absences:"=",dayEvent:"=",threeDays:"<"},scope:!0}}),e.$inject=["$scope","HolidaysServicePlanning"]}(window.angular,window.moment,window._),function(E,S,D){"use strict";function e(e,s,i,l,r,d,c){var p=s.BASE_SIZE,u=s.parallelText,y=s.MAX_PARALLEL,g=this;function v(e){let n="";var t=e.absenceType,a="week"===g.mode?e.user.fullname+" - ":"";switch(e.confirmation.state){case"sending":n=a+"Absence envoyée";break;case"pending":case"partial-accepted":n=a+"Absence en cours de traitement";break;case"accepted":n=a+"Absence acceptée"}return t?n+"\nRaison: "+t:n}function h(e){e=S.contains(e.target.classList,"half-hour")?30:Math.floor(e.offsetX/(p*g.zoom)*60);return e}function n(e){g.tooltip=v(e);for(const n of document.getElementsByClassName(e._id))n.classList.add("absence-hover")}function t(){for(const e of document.getElementsByClassName("absence"))e.classList.remove("absence-hover")}function a(e,n,t){var a=parseInt(n.target.getAttribute("hour")),i=h(n),o=D(E.copy(g.position)).hours(a+parseInt(g.dayStart.h)).minutes(i),t=t.dayOfWeek||t.position;b(o)&&k(t)?s.warningCallback(function(){g.dropCallback({$data:e,$event:n,$hour:a+parseInt(g.dayStart.h),$minutes:i})}):b(o)&&!k(t)?s.absentTechnicianCallback(function(){g.dropCallback({$data:e,$event:n,$hour:a+parseInt(g.dayStart.h),$minutes:i})}):b(o)||!k(t)||c.isSolidarityDay(t)?g.dropCallback({$data:e,$event:n,$hour:a+parseInt(g.dayStart.h),$minutes:i}):s.isFerieCallback(function(){g.dropCallback({$data:e,$event:n,$hour:a+parseInt(g.dayStart.h),$minutes:i})})}function o(e,n,t){var t=t.dayOfWeek||t.position,a=h(n),n=D(E.copy(g.position)).hours(e+parseInt(g.dayStart.h)).minutes(a);b(n)&&k(t)?s.warningCallback(function(){g.clickCallback({$hour:e+parseInt(g.dayStart.h),$minutes:a})}):b(n)&&!k(t)?s.absentTechnicianCallback(function(){g.clickCallback({$hour:e+parseInt(g.dayStart.h),$minutes:a})}):b(n)||!k(t)||c.isSolidarityDay(t)?g.clickCallback({$hour:e+parseInt(g.dayStart.h),$minutes:a}):s.isFerieCallback(function(){g.clickCallback({$hour:e+parseInt(g.dayStart.h),$minutes:a})})}function f(){var o=0,s=(g.preEvent={},g.postEvent={},g.breaks=[],g._events=E.copy(g.events),g.range=g.dayEnd.h-g.dayStart.h,g.SECONDS_BY_DAY=3600*g.range,g.SLIDER_WIDTH=p*g.range,g._events=S.sortBy(g._events,function(e){return e.start.valueOf()}),[[]]),a=[];S.each(g._events,function(e){var n,t={};e.depth=1,e.range=D.range(e.start,e.end),e.range<9e5&&(n=D(e.start).add(15,"minutes"),e.range=D.range(e.start,n)),t.left=(e.start.hours()-g.dayStart.h)*p*g.zoom+e.start.minutes()*p*g.zoom/60+"px",t.width=g.zoom*g.SLIDER_WIDTH*e.range/g.SECONDS_BY_DAY/1e3+"px",t["background-color"]=e["background-color"]||"#778899",200<l.getLuminance(t["background-color"])?t.color="black":t.color="white",e.style=t,i.overlap(s,e,y,a)}),g._events=S.difference(g._events,a),S.each(g._events,function(e){e.id=E.copy(o),e.line===y&&(e.style.left=(e.start.hours()-g.dayStart.h)*p*g.zoom+e.start.minutes()*p*g.zoom/60+"px",e.style.width=g.zoom*g.SLIDER_WIDTH*e.range.valueOf()/g.SECONDS_BY_DAY/1e3+"px",e.style["background-color"]="#000",e.style["font-weight"]="bold",e.style.color="#fff",e.title=e.eventList.length+" "+u,e.tooltip)&&(e.tooltip=e.title),e.style.width=g.zoom*g.SLIDER_WIDTH*e.range.valueOf()/g.SECONDS_BY_DAY/1e3+"px",void 0===e.line&&(e.line=y),e.style.top=Math.round(70*parseInt(e.line)/s.length)+"%",e.style.height=Math.round(70/s.length)+"%",e.percentage="100%",0<e.pre&&(e.style["border-left"]="none",t=D(e.start).subtract(e.pre,"minutes"),D(t).isSame(e.start,"day")||(t=D(e.start).startOf("day")),a=D(e.start),a=D.range(t,a),i=D.range(t,e.range.end),n=a.valueOf()/i.valueOf()*100,e.percentage=100-n+"%",t={percentage:n+"%",style:{left:(D(t).hours()-g.dayStart.h)*p*g.zoom+D(t).minutes()*p*g.zoom/60+2+"px",width:g.zoom*g.SLIDER_WIDTH*a.valueOf()/g.SECONDS_BY_DAY/1e3+"px",top:e.style.top,height:e.style.height,totalWidth:g.zoom*g.SLIDER_WIDTH*i.valueOf()/g.SECONDS_BY_DAY/1e3+"px","text-align":"center",color:"#fff",background:"repeating-linear-gradient(45deg, "+e["background-color"]+", "+e["background-color"]+" 10px, white 10px, white 20px)","border-top":"1px lightgrey solid","border-bottom":"1px lightgrey solid","border-left":"1px lightgrey solid"},tooltip:"Trajet estimé de "+e.pre+" min"},0<n?g.preEvent[e.id]=t:e.pre=0),function(e){if(!e.post)return;e.style["border-right"]="none";let n=D(e.end).add(e.post,"minutes");D(n).isSame(e.end,"day")||(n=D(e.end).endOf("day"));var t=D(e.end),a=D.range(t,n),i=D.range(e.range.start,e.range.end),o=a.valueOf()/i.valueOf()*100;e.postPercentage=100-o+"%";t={percentage:o+"%",style:{left:(D(t).hours()-g.dayStart.h)*p*g.zoom+D(t).minutes()*p*g.zoom/60+2+"px",width:g.zoom*g.SLIDER_WIDTH*a.valueOf()/g.SECONDS_BY_DAY/1e3+"px",top:e.style.top,height:e.style.height,totalWidth:g.zoom*g.SLIDER_WIDTH*i.valueOf()/g.SECONDS_BY_DAY/1e3+"px","text-align":"center",color:"#fff",background:"repeating-linear-gradient(135deg, "+e["background-color"]+", "+e["background-color"]+" 10px, white 10px, white 20px)","border-top":"1px lightgrey solid","border-bottom":"1px lightgrey solid","border-left":"1px lightgrey solid"},tooltip:"Trajet retour de "+e.post+" min"};0<o?g.postEvent[e.id]=t:e.post=0}(e),e.pauses&&(e.style["background-image"]=r.generateGradient(e,"to right"),e.style["background-color"]=void 0);var n,t,a=g.preEvent[e.id],i=g.postEvent[e.id];e.style.totalWidth=w(e.style.width)+w(S.get(a,"style.width"))+w(S.get(i,"style.width"))+1+"px",o++}),g.pauses&&(g.breaks=S.compact(S.map(g.pauses.breaks,function(e){e={name:e.name,start:D().hours(e.start.split(":")[0]).minute(e.start.split(":")[1]).second(0),end:D().hours(e.end.split(":")[0]).minute(e.end.split(":")[1]).second(0),style:{}};if(!e.start.isAfter(g.dayEnd)&&!e.end.isBefore(g.dayStart))return e.start.isBefore(g.dayStart)&&(e.start=D(E.copy(g.dayStart))),e.end.isAfter(g.dayEnd)&&(e.end=D(E.copy(g.dayEnd))),e.style.left=(e.start.hours()-g.dayStart.h)*p*g.zoom+e.start.minutes()*p*g.zoom/60+"px",e.style.width=g.zoom*g.SLIDER_WIDTH*D.range(e.start,e.end).valueOf()/g.SECONDS_BY_DAY/1e3+"px",e})))}function m(e){return parseInt(e)*p+"px"}function b(e){var n;if("week"!==g.mode)return n=D(E.copy(e)),S.any(g._absences,function(e){return e.range.contains(n)})}function k(n){return g.holidays.find(e=>D(e.date).format("L")===D(n).format("L"))}function w(e="0px"){return parseInt(e.replace("px",""))}g.$onInit=function(){S.extend(g,{clickEvent:o,calcWidth:m,dropEvent:a,hoverAbsence:n,leaveAbsence:t}),f(),e.$watchCollection(function(){return[g.events,g.dayStart,g.dayEnd]},f),e.$watchCollection(function(){return[g.absences]},function(e,n){if(Array.isArray(g.absences)&&g.absences.length){var t=D(E.copy(g.position)).startOf("day"),a=D(E.copy(g.position)).endOf("day");g._absences=d.parseAbsences(g.absences,[t,a]).map(function(e){return e.style={left:(D(e.start).hours()-g.dayStart.h)*p*g.zoom+D(e.start).minutes()*p*g.zoom/60+"px",width:g.zoom*g.SLIDER_WIDTH*D.range(e.start,e.end).valueOf()/g.SECONDS_BY_DAY/1e3+"px"},e.range=D.range(e.start,e.end),e.class="planning-absence-"+e.confirmation.state,e.tooltip=v(e),e})}else if(g.absences){var i,o,t=D(E.copy(g.dayOfWeek)).startOf("day"),a=D(E.copy(g.dayOfWeek)).endOf("day");g._absences=[];for([i,o]of Object.entries(g.absences))o.forEach(e=>{(g.dayOfWeek.isBetween(D(e.start),D(e.end))||D(g.dayOfWeek).isSame(D(e.start),"day")&&D(g.dayOfWeek).isSame(D(e.end),"day"))&&g._absences.push(E.copy(e))});g._absences.forEach(e=>{var n=g._absences.indexOf(e);(D(e.start).isBefore(D(g.dayOfWeek).startOf("day"))&&D(e.end).isAfter(D(g.dayOfWeek).endOf("day"))||D(e.end).isSame(D(g.dayOfWeek).endOf("day"))&&D(e.start).isBefore(D(g.dayOfWeek).startOf("hour"))||D(e.start).isSame(D(g.dayOfWeek).startOf("day"))&&D(e.end).isAfter(D(g.dayOfWeek).endOf("day")))&&(e.start=D(g.dayOfWeek).startOf("day"),e.end=D(g.dayOfWeek).endOf("day")),e.style={left:(D(e.start).hours()-g.dayStart.h)*p*g.zoom+D(e.start).minutes()*p*g.zoom/60+"px",width:g.zoom*g.SLIDER_WIDTH*D.range(e.start,e.end).valueOf()/g.SECONDS_BY_DAY/1e3+"px",height:100/g._absences.length+"%",position:"absolute",top:100/g._absences.length*n+"%"},e.range=D.range(e.start,e.end),e.class="planning-absence-"+e.confirmation.state,e.tooltip=v(e),e.index=n})}else g._absences=[]})},g.log=function(e){},g.replace=function(e){if(e)return e.replace(/([a-zA-Z\ ])\w+/,"")},g.preEvent={},g.postEvent={}}E.module("90Tech.planning").directive("zlPlanningLine",function(){return{restrict:"E",templateUrl:"/directives/planning-line/planning-line.html",controller:e,controllerAs:"line",bindToController:{zoom:"=",dayStart:"=",dayEnd:"=",events:"=",clickCallback:"&",dropCallback:"&",pauses:"=?",absences:"=?",position:"=?",mode:"=?",entities:"=?",dayOfWeek:"=",holidays:"="},scope:!0}}),e.$inject=["$scope","planningConfiguration","PositionService","ColorService","PauseService","AbsenceService","HolidaysServicePlanning"]}(window.angular,window._,window.moment),function(e,s,l){"use strict";function n(e){var o=e.BASE_SIZE;return{restrict:"E",templateUrl:"/directives/planning-top-row/planning-top-row.html",controller:["$scope",function(e){var t=this;function n(){var e=t.dayEnd.h-t.dayStart.h+1;t.hours=[],l.times(e,function(e){var n=s(t.position);n.hour(e+parseInt(t.dayStart.h)),n.minute(0),t.hours.push(n)})}function a(e){return parseInt(e)*o+"px"}function i(e,n){var t=parseInt(e)*(o/2);return n||(t-=3*parseInt(e)),"0 "+t+"px 0 -"+t+"px"}t.$onInit=function(){e.$watchGroup([function(){return t.dayStart},function(){return t.dayEnd}],n),l.extend(t,{calcWidth:a,calcMargin:i}),n()}}],controllerAs:"planningTopRow",bindToController:{zoom:"=",dayStart:"=",dayEnd:"=",events:"=",entities:"=",position:"=",mode:"=",callback:"&",holidays:"="},scope:{}}}e.module("90Tech.planning").directive("zlPlanningTopRow",n),n.$inject=["planningConfiguration"]}(window.angular,window.moment,window._),function(D,_,x){"use strict";function e(e,n,t,s,i,l,r,o,d){var c=Math.max(s.BASE_SIZE-8,1),p=s.parallelText,u=s.MAX_PARALLEL,y=90,g=this;function v(e){e=_.contains(e.target.classList,"half-hour")?30:10*Math.floor(e.offsetY/(c*g.zoom)*6);return e}function a(e,n,t){var a=parseInt(n.target.getAttribute("hour")),i=v(n),o=x(D.copy(g.day)).hours(a+parseInt(g.dayStart.h)).minutes(i);E(o)&&S(t)?s.warningCallback(function(){g.dropCallback({$data:e,$event:n,$hour:a,$minutes:i})}):E(o)&&!S(t)?s.absentTechnicianCallback(function(){g.dropCallback({$data:e,$event:n,$hour:a,$minutes:i})}):E(o)||!S(t)||d.isSolidarityDay(t)?g.dropCallback({$data:e,$event:n,$hour:a,$minutes:i}):s.isFerieCallback(function(){g.dropCallback({$data:e,$event:n,$hour:a,$minutes:i})})}function h(){for(const e of document.getElementsByClassName("absence"))e.classList.add("absence-week-advanced-hover")}function f(){for(const e of document.getElementsByClassName("absence"))e.classList.remove("absence-week-advanced-hover")}function m(e,n,t){var a=v(n),n=x(D.copy(g.day)).hours(e+parseInt(g.dayStart.h)).minutes(a);E(n)&&S(t)?s.warningCallback(function(){g.clickCallback({$hour:e+parseInt(g.dayStart.h),$minutes:a})}):E(n)&&!S(t)?s.absentTechnicianCallback(function(){g.clickCallback({$hour:e+parseInt(g.dayStart.h),$minutes:a})}):E(n)||!S(t)||d.isSolidarityDay(t)?g.clickCallback({$hour:e+parseInt(g.dayStart.h),$minutes:a}):s.isFerieCallback(function(){g.clickCallback({$hour:e+parseInt(g.dayStart.h),$minutes:a})})}function b(){var o=0,s=(g.preEvent={},g.breaks=[],g._events=D.copy(g.events),g.range=g.dayEnd.h-g.dayStart.h,g.SECONDS_BY_DAY=3600*g.range,g.SLIDER_WIDTH=c*g.range,g._events=_.sortBy(g._events,function(e){return e.start.valueOf()}),[[]]),a=[];_.each(g._events,function(e){var n,t={};e.depth=1,e.range=x.range(e.start,e.end),e.range<9e5&&(n=x(e.start).add(15,"minutes"),e.range=x.range(e.start,n)),t.left=(e.start.hours()-g.dayStart.h)*c*g.zoom+e.start.minutes()*c*g.zoom/60+"px",t.width=g.zoom*g.SLIDER_WIDTH*e.range/g.SECONDS_BY_DAY/1e3+"px",t["background-color"]=e["background-color"]||"#778899",200<l.getLuminance(t["background-color"])?t.color="black":t.color="white",e.style=t,i.overlap(s,e,u,a)}),g._events=_.difference(g._events,a),_.each(g._events,function(e){e.id=D.copy(o),e.line===u&&(e.style.left=(e.start.hours()-g.dayStart.h)*c*g.zoom+e.start.minutes()*c*g.zoom/60+"px",e.style.width=g.zoom*g.SLIDER_WIDTH*e.range.valueOf()/g.SECONDS_BY_DAY/1e3+"px",e.style["background-color"]="#000",e.style["font-weight"]="bold",e.title=e.eventList.length+" "+p,e.style.color="#fff",e.tooltip)&&(e.tooltip=e.title),e.style.width=g.zoom*g.SLIDER_WIDTH*e.range.valueOf()/g.SECONDS_BY_DAY/1e3+"px",void 0===e.line&&(e.line=u),e.style.top=Math.round(parseInt(e.line)*y/s.length)+"%",e.style.height=Math.round(y/s.length)+"%",e.percentage="100%",e.continuedBefore&&(e.pre=0),0<e.pre&&(e.style["border-left"]="none",t=x(e.start).subtract(e.pre,"minutes"),x(t).isSame(e.start,"day")||(t=x(e.start).startOf("day")),a=x(e.start),a=x.range(t,a),i=x.range(t,e.range.end),n=a.valueOf()/i.valueOf()*100,e.percentage=100-n+"%",t={percentage:n+"%",style:{left:(x(t).hours()-g.dayStart.h)*c*g.zoom+x(t).minutes()*c*g.zoom/60+"px",width:g.zoom*g.SLIDER_WIDTH*a.valueOf()/g.SECONDS_BY_DAY/1e3+"px",top:e.style.top,height:e.style.height,totalWidth:g.zoom*g.SLIDER_WIDTH*i.valueOf()/g.SECONDS_BY_DAY/1e3+"px","text-align":"center",color:"#fff",background:"repeating-linear-gradient(45deg, "+e["background-color"]+", "+e["background-color"]+" 10px, white 10px, white 20px)","border-top":"1px lightgrey solid","border-bottom":"1px lightgrey solid","border-left":"1px lightgrey solid"},tooltip:"Trajet estimé de "+e.pre+" min"},0<n?g.preEvent[e.id]=t:e.pre=0),function(e){if(!e.post)return;let n=x(e.end).add(e.post,"minutes");x(n).isSame(e.end,"day")||(n=x(e.end).endOf("day"));var t=x(e.end),a=x.range(t,n),i=x.range(e.range.start,e.range.end),o=a.valueOf()/i.valueOf()*100;e.postPercentage=100-o+"%";t={percentage:o+"%",style:{left:(x(t).hours()-g.dayStart.h)*c*g.zoom+x(t).minutes()*c*g.zoom/60+2+"px",width:g.zoom*g.SLIDER_WIDTH*a.valueOf()/g.SECONDS_BY_DAY/1e3+"px",top:e.style.top,height:e.style.height,totalWidth:g.zoom*g.SLIDER_WIDTH*i.valueOf()/g.SECONDS_BY_DAY/1e3+"px","text-align":"center",color:"#fff",background:"repeating-linear-gradient(135deg, "+e["background-color"]+", "+e["background-color"]+" 10px, white 10px, white 20px)","border-top":"1px lightgrey solid","border-bottom":"1px lightgrey solid","border-left":"1px lightgrey solid"},tooltip:"Trajet retour de "+e.post+" min"};0<o?g.postEvent[e.id]=t:e.post=0}(e),e.pauses&&(e.style["background-image"]=r.generateGradient(e,"to bottom"),e.style["background-color"]=void 0);var n,t,a=g.preEvent[e.id],i=g.postEvent[e.id];e.style.totalWidth=k(e.style.width)+k(_.get(a,"style.width"))+k(_.get(i,"style.width"))+1+"px",o++}),g.pauses&&(g.breaks=_.compact(_.map(g.pauses.breaks,function(e){e={name:e.name,start:x().hours(e.start.split(":")[0]).minute(e.start.split(":")[1]).second(0),end:x().hours(e.end.split(":")[0]).minute(e.end.split(":")[1]).second(0),style:{}};if(!e.start.isAfter(g.dayEnd)&&!e.end.isBefore(g.dayStart))return e.start.isBefore(g.dayStart)&&(e.start=x(D.copy(g.dayStart))),e.end.isAfter(g.dayEnd)&&(e.end=x(D.copy(g.dayEnd))),e.style.top=(x(e.start).hours()-g.dayStart.h)*c*g.zoom+x(e.start).minutes()*c*g.zoom/60+"px",e.style.height=g.zoom*g.SLIDER_WIDTH*x.range(e.start,e.end).valueOf()/g.SECONDS_BY_DAY/1e3+"px",e}))),g.containerHeight=parseInt(g.zoom)*c*e("range")(g.range)+"px",n.$on("$destroy",()=>{t.$broadcast("context-menu/close")})}function k(e="0px"){return parseInt(e.replace("px",""))}function w(e){return parseInt(e)*c+"px"}function E(e){var n=x(D.copy(e));return _.any(g._absences,function(e){return e.range.contains(n)})}function S(n){return g.holidays.find(e=>x(e.date).format("L")===x(n).format("L"))}g.$onInit=function(){g.range=g.dayEnd.h-g.dayStart.h,g.SECONDS_BY_DAY=3600*g.range,g.SLIDER_WIDTH=c*g.range,n.$watchCollection(function(){return[g.events,g.dayStart,g.dayEnd]},b),n.$watchCollection(function(){return g.absences},function(e,n){var t,a;Array.isArray(g.absences)&&g.absences.length?(t=x(D.copy(g.day)).startOf("day"),a=x(D.copy(g.day)).endOf("day"),g._absences=o.parseAbsences(D.copy(g.absences),[t,a]).map(function(e){var n=(x(e.start).hours()-g.dayStart.h)*c*g.zoom+x(e.start).minutes()*c*g.zoom/60,t=g.zoom*g.SLIDER_WIDTH*x.range(e.start,e.end).valueOf()/g.SECONDS_BY_DAY/1e3;return"0px"===e.style.top?e.style.height=n+t+"px":(e.style.height=t+"px",e.style.top=n+"px"),e.range=x.range(e.start,e.end),e.class="planning-absence-"+e.confirmation.state,e.tooltip=function(e){let n="";var t=e.absenceType;switch(e.confirmation.state){case"sending":n="Absence envoyée";break;case"pending":case"partial-accepted":n="Absence en cours de traitement";break;case"accepted":n="Absence acceptée"}return t?n+"\nRaison:"+t:n}(e),e})):g._absences=[]}),_.extend(g,{clickEvent:m,calcWidth:w,dropEvent:a,hoverAbsence:h,leaveLine:f}),b()},g.log=function(e){},g.replace=function(e){if(e)return e.replace(/([a-zA-Z\ ])\w+/,"")},g.preEvent={},g.postEvent={}}D.module("90Tech.planning").directive("zlPlanningVerticalLine",function(){return{restrict:"E",templateUrl:"/directives/planning-vertical-line/planning-vertical-line.html",controller:e,controllerAs:"line",bindToController:{zoom:"=",dayStart:"=",dayEnd:"=",events:"=",isInRange:"=",pauses:"=?",day:"=",absences:"=?",holidays:"=?",clickCallback:"&",dropCallback:"&"},scope:!0}}),e.$inject=["$filter","$scope","$rootScope","planningConfiguration","PositionService","ColorService","PauseService","AbsenceService","HolidaysServicePlanning"]}(window.angular,window._,window.moment),function(e,p,u){"use strict";function n(e,a,n,i){var t=this,o=(t.$onInit=function(){u.extend(t,{calculateWidth:d,calculateLeft:c}),l(),e.$watchCollection(function(){return[t.events,t.week]},l)},n.parallelText),s=n.MAX_PARALLEL;function l(){t.displayedEvents=u(t.events).sortBy(function(e){return e.continuedBefore?-1:e.continuedAfter?0:1}).value(),t.displayedEvents=r(t.displayedEvents),t.oneDayEvents=r(t.oneDayEvents)}function r(e){var t=[[]],n=[];return u.each(e,function(e){e.style={},e.depth=1,e.range=p.range(e.start,e.end),a.overlap(t,e,s,n,!0)}),e=u.difference(e,n),u.each(e,function(e){var n=t.length;e.style.left=c(e),e.style.width=d(e),e.style["background-color"]=e["background-color"],200<i.getLuminance(e.style["background-color"])?e.style.color="black":e.style.color="white",e.style.top=Math.ceil(100*e.line/n)+"%",e.style.height=Math.round(100/n)+"%",void 0===e.line&&(e.line=s),e.eventList&&1<e.eventList.length&&(e.style["background-color"]="#000",e.style.color="#FFF",e.style["font-weight"]="bold",e.title=e.eventList.length+" "+o,e.tooltip)&&(e.tooltip=e.title)}),e}function d(e){var n;return e.start.day()===e.end.day()?(e.end.diff(e.start,"days")+1)*(100/7)+"%":(n=Math.ceil(e.end.diff(e.start,"hours")/24),e.end.hours()<e.start.hours()&&(n+=1),n*(100/7)+"%")}function c(e){return(e.start.isoWeekday()-1)*(99.9/7)+"%"}}e.module("90Tech.planning").directive("zlPlanningWeekLine",function(){return{restrict:"E",replace:!0,templateUrl:"/directives/planning-week-line/planning-week-line.html",controller:n,controllerAs:"line",bindToController:{events:"=",week:"=",oneDayEvents:"=",weekEventCallback:"&"},scope:!0}}),n.$inject=["$scope","PositionService","planningConfiguration","ColorService"]}(window.angular,window.moment,window._);
//# sourceMappingURL=planning.js.map
