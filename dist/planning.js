"use strict";!function(e){e.module("90Tech.planning",["pikaday","zlContextMenu"])}(window.angular),function(e){e.module("90Tech.planning").filter("day",[function(){return function(e){return void 0===e||null===e||isNaN(e)||parseInt(e)>6?"":["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"][e]}}])}(window.angular),function(e){e.module("90Tech.planning").filter("format",function(){return function(e,n){return e.format(n)}}).filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}})}(window.angular),function(e){function n(){var e=function(e,n){n=parseInt(n);for(var t=0;t<n;t++)e.push(t);return e};return e}e.module("90Tech.planning").filter("range",n)}(window.angular),function(e){e.module("90Tech.planning").filter("strPlanning",["planningConfiguration",function(e){return function(n){return e.strings[n]}}])}(window.angular),function(e,n,t){function a(){function a(n,a){if(!Array.isArray(a))throw new Error("Invalid interval");var o=n.filter(function(e){return t.range(e.start,e.end).overlaps(t.range(a[0],a[1]))}).map(function(n){return n.style={},t(n.start).isSame(t(e.copy(a[0])))&&(n.style.top="0px",n.start=a[0]),t(n.start).isBefore(t(e.copy(a[0])))&&(n.start=a[0],n.style.top="0px"),t(n.end).isAfter(t(e.copy(a[1])))&&(n.end=a[1]),n});return i(o)}function i(a){for(var i=!0;i;){var o=a;i=!1;var r=o.map(function(e,n){return e.index=n,Object.assign({},e,{index:n})});if(!n.any(r,function(e){return n.any(r,function(n){return e.index!==n.index&&t.range(e.start,e.end).overlaps(t.range(n.start,n.end))})}))return o;var l=o.reduce(function(n,a,i,o){var r=o[i+1];return r&&a?(t.range(a.start,a.end).overlaps(t.range(r.start,r.end))&&n.push({start:t.min(t(e.copy(a.start)),t(e.copy(r.start))),end:t.max(t(e.copy(a.end)),t(e.copy(r.end)))}),n):n},[]);a=l,i=!0,r=l=void 0}}var o=this;n.extend(o,{parseAbsences:a})}e.module("90Tech.planning").service("AbsenceService",a)}(window.angular,window._,window.moment),function(e,n,t){function a(){function e(e){e=e||"#ffffff";var n,t,a,i=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;if(i.test(e)){var o=i.exec(e);n=parseInt(o[1]),t=parseInt(o[2]),a=parseInt(o[3])}else{var r=e.substring(1),l=parseInt(r,16);n=l>>16&255,t=l>>8&255,a=l>>0&255}var s=.2126*n+.7152*t+.0722*a;return s}var t=this;n.extend(t,{getLuminance:e})}e.module("90Tech.planning").service("ColorService",a),a.$inject=[]}(window.angular,window._,window.moment),function(e){e.module("90Tech.planning").provider("planningConfiguration",function(){var e=this;e.BASE_SIZE=10,e.MAX_PARALLEL=3,e.strings={nothing_to_show:"Rien à afficher"},e.DAYS=[0,1,2,3,4,5,6],e.parallelText="parallel items",this.setParallelText=function(n){e.parallelText=""+n},this.setBaseSize=function(n){e.BASE_SIZE=n},this.setMaxParallel=function(n){e.MAX_PARALLEL=n},this.setString=function(n,t){e.strings[n]=t},this.setDays=function(n){e.DAYS=n},this.$get=[function(){return{strings:e.strings,BASE_SIZE:e.BASE_SIZE,MAX_PARALLEL:e.MAX_PARALLEL,parallelText:e.parallelText,DAYS:e.DAYS,absentTechnicianCallback:function(e){e()},isFerieCallback:function(e){e()},warningCallback:function(e){e()}}}]})}(window.angular),function(e,n,t){function a(){function e(e){var i=!1;return e&&n.get(a.aliaCompanySettings,"showSolidarityDay",!1)&&!function(){var o=t(e);a.solidarityDays.forEach(function(e){if(e.master&&(a.masterDay=e),o.get("year")>=n.get(a.masterDay,"year")){var r=a.masterDayRange.filter(function(e){return t(e.date).get("year")===t(o).get("year")&&e.rule===a.masterDay.rule});r.length&&(e=r[0])}t(e.start).unix()<=t(o).endOf("day").unix()&&t(e.end).unix()>=t(o).endOf("day").unix()&&(i=!0)})}(),i}var a=this;n.extend(a,{solidarityDays:[],masterDayRange:[],aliaCompanySettings:{showSolidarityDay:!1},isSolidarityDay:e})}e.module("90Tech.planning").service("HolidaysServicePlanning",a)}(window.angular,window._,window.moment),function(e,n,t){function a(e){function a(e,a){function o(a){return n.map(a,function(n){var a=e.start.isAfter(n.start)?e.start:n.start,i=e.end.isBefore(n.end)?e.end:n.end,o=t.range(a,i),r=o.diff("milliseconds"),l=r/p*100,s=c.clone();if(s.subtract(o),!s.length)return{range:o,endPercentage:100,startPercentage:0};var d=(s[0].diff("milliseconds")||p)/p*100;return{range:o,endPercentage:l+d,startPercentage:d}})}var r=e.style["background-color"],l=i(r),s=e.start,d=e.end,c=t.range(s,d),p=c.diff("milliseconds"),u=o(e.pauses),y=n.reduce(u,function(e,n){return e+", "+r+" "+n.startPercentage+"%, "+l+" "+n.startPercentage+"%, "+l+" "+n.endPercentage+"%, "+r+" "+n.endPercentage+"%"},"linear-gradient("+a+", "+r);return y+=", "+r+" 100%)"}function i(e){if(0===e.indexOf("#")&&(e=e.slice(1)),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6!==e.length)throw new Error("Invalid HEX color.");var n=(255-parseInt(e.slice(0,2),16)).toString(16),t=(255-parseInt(e.slice(2,4),16)).toString(16),a=(255-parseInt(e.slice(4,6),16)).toString(16);return"#"+o(n)+o(t)+o(a)}function o(e,n){n=n||2;var t=new Array(n).join("0");return(t+e).slice(-n)}var r=this;n.extend(r,{generateGradient:a})}e.module("90Tech.planning").service("PauseService",a),a.$inject=["ColorService"]}(window.angular,window._,window.moment),function(e,n,t){function a(){function e(e,a,i,o,r){for(var l=a.pre>0?t.range(t(a.start).subtract(a.pre,"minutes"),t(a.end)):a.range,s=0;s<e.length;s++){if(a.depth>i){var d=!1;if(n.each(e[i],function(e){var n=e.pre>0?t.range(t(e.start).subtract(e.pre,"minutes"),t(e.end)):e.range;d=l.overlaps(n),!d&&r&&(d=a.start.day()===e.start.day()||a.start.day()===e.end.day()||a.end.day()===e.start.day()||a.end.day()===e.end.day()),d&&(e.start=t.min(a.start,e.start),e.end=t.max(a.end,e.end),e.range=t.range(e.start,e.end),e.line=i,e.eventList.push(a),e.technician!==a.technician&&(e.technician="",a.technician=""))}),d){o.push(a);break}if(a.depth=i,a.line=i,!a.eventList){var c=n.cloneDeep(a);a.eventList=[c]}e[i].push(a);break}if(!e[s].length){e[s].push(a),a.line=s;break}if(!n.filter(e[s],function(e){var n=e.pre>0?t.range(t(e.start).subtract(e.pre,"minutes"),t(e.end)):e.range;if(d=l.overlaps(n),!d&&r&&(d=a.start.day()===e.start.day()||a.start.day()===e.end.day()||a.end.day()===e.start.day()||a.end.day()===e.end.day()),d)return e.depth+=1,!0}).length){e[s].push(a),a.line=s;break}a.depth+=1,e[s+1]||(e[s+1]=[])}}var a=this;n.extend(a,{overlap:e})}e.module("90Tech.planning").service("PositionService",a),a.$inject=[]}(window.angular,window._,window.moment),function(e,n){e.module("90Tech.planning").directive("zlPlanningDragDrop",function(){return{controller:function(){},scope:{},controllerAs:"dragDropCtrl",bindToController:{zlDrag:"=",zlDrop:"&"},link:function(e,t){function a(t){return d.style.height=c.clientHeight+"px",d.style.zIndex="1000",d.style.position="relative",d.style.left="-10000px",d.style.bottom="-10000px;",d.innerHTML=c.innerHTML,c.children.length>1?(d.children[0].style.float="left",d.style.backgroundColor=c.children[1].style.backgroundColor,d.style.width=c.clientWidth+"px"):(d.style.width=Math.min(c.clientWidth,200)+"px",d.style.backgroundColor=c.children[0].style.backgroundColor),t.dataTransfer.effectAllowed="move",document.body.appendChild(d),t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(d,0,0),n.each(document.querySelectorAll(".planning-event-tooltip"),function(e){e.remove()}),t.dataTransfer.setData("Text",JSON.stringify(e.dragDropCtrl.zlDrag)),this.classList.add("drag"),!1}function i(n){return e.$apply(function(){e.dragDropCtrl.zlDrop({$data:JSON.parse(n.dataTransfer.getData("Text")),$event:n})}),n.target.classList.remove("over"),this.classList.remove("over"),n.stopPropagation(),!1}function o(e){return e.target.classList.add("over"),!1}function r(e){return e.target.classList.remove("over"),!1}var l={threshold:.5},s=!1,d=document.createElement("div"),c=t[0],p=function(e,n){e[0].isIntersecting&&!s?(s=!0,c.attributes["zl-drag"]&&(c.draggable=!0,c.addEventListener("dragstart",a,!1)),c.attributes["zl-drop"]&&(c.addEventListener("drop",i,!1),c.addEventListener("dragenter",o,!1),c.addEventListener("dragleave",r,!1))):!e[0].isIntersecting&&s&&(c.removeEventListener("dragstart",a,!1),c.removeEventListener("drop",i,!1),c.removeEventListener("dragenter",o,!1),c.removeEventListener("dragleave",r,!1),s=!1)},u=new IntersectionObserver(p,l);u.observe(t[0])}}})}(window.angular,_),function(e){function n(e){return{restrict:"A",scope:{scrollLeft:"="},link:function(n,t,a){t.bind("mousewheel",function(e){t[0].scrollLeft-=e.wheelDelta/3}),t.addClass("slider"),n.scrollLeft,e(function(){t[0].scrollLeft=n.scrollLeft-t[0].offsetWidth/2},100)}}}e.module("90Tech.planning").directive("zlHorizontalScroll",n),n.$inject=["$timeout"]}(window.angular),function(e,n,t){function a(a,i,o){function r(){switch(L.solidarityDays.length&&(o.solidarityDays=L.solidarityDays),L.masterDayRange.length&&(o.masterDayRange=L.masterDayRange),o.aliaCompanySettings=L.aliaCompanySettings,L.zoom=parseInt(L.zoom),L.allowedDays=L.usableDays.sort()||i.DAYS,L.daysList=L.allowedDays.map(function(e){var t=n(L.position);return t.weekday(e),t}),(!L.zoom||L.zoom<1)&&(L.zoom=1),L._dayStart=y(L.dayStart?L.dayStart:0),L._dayEnd=y(L.dayEnd?L.dayEnd:24),L.width=L.zoom*(parseInt(L._dayEnd.h)-parseInt(L._dayStart.h)+1)*z+"px",L.sortedEvents=void 0,L.mode){case"week":L._events=t.flatten(t.map(L.events,s)),L._events=c(L._events),L.sortedEvents=t.groupBy(L._events,function(e){return e.start.format("DD/MM/YYYY")}),p(L.sortedEvents);break;case"day":case"week-advanced":L._events=t.flatten(t.map(L.events,s)),L._events=c(L._events),L.sortedEvents=t.groupBy(L._events,function(e){return e[L.dayField]}),"week-advanced"===L.mode&&(L.sortedEvents=t.mapValues(L.sortedEvents,function(e){return t.groupBy(e,function(e){return e.start.weekday()})})),u(L.sortedEvents);break;case"3day":L._events=t.flatten(t.map(L.events,s)),L._events=c(L._events),L.sortedEvents=t.reduce(L.entities,function(e,n){return e[n]=[],e},{});t.keys(L.sortedEvents);L.groupedEvents=t.map(t.groupBy(L._events,function(e){return n(e.start).startOf("day").unix()}),function(a,i){var o={key:i,date:n.unix(i).startOf("day").toDate(),day:n.unix(i).startOf("day").format("dddd DD MMMM"),value:t.groupBy(a,function(e){return e.technician}),absences:e.copy(L.absences)};return t.each(L.entities,function(e){o.value[e]||(o.value[e]=[])}),o});for(var a=n(L.position).hour(L._dayStart.h).minute(L._dayStart.m).second(0),r=n(L.position).hour(L._dayEnd.h).minute(L._dayEnd.m).second(59),l=[{start:e.copy(a),end:e.copy(r)}],v=0;v<2;){r.add(1,"day");var g=r.day()-1;g<0&&(g=6),(t.isEmpty(L.allowedDays)||t.includes(L.allowedDays,g))&&(l.push({start:e.copy(r).hour(L._dayStart.h).minute(L._dayStart.m).second(0),end:e.copy(r).hour(L._dayEnd.h).minute(L._dayEnd.m).second(59)}),v++)}t.each(l,function(a){var i=""+n(a.start).startOf("day").unix(),o=t.find(L.groupedEvents,function(e){return e.key===i});if(!o){var r={key:i,date:n(e.copy(a.start)).startOf("day").toDate(),day:n(e.copy(a.start)).startOf("day").format("dddd DD MMMM"),value:{},absences:e.copy(L.absences)};t.each(t.keys(L.sortedEvents),function(e){r.value[e]=[]}),L.groupedEvents.push(r)}}),L.groupedEvents=t.sortBy(L.groupedEvents,function(e){return e.key});break;case"month":var f=n(L.position).date(1).hours(0).minutes(0).seconds(0);L.month=n(L.position).date(1).hours(0).minutes(0).seconds(0).format("MMMM"),L.decallage=f.isoWeekday()-1,L.decallage<0&&(L.decallage=0),L.oneDayEvents=t(L.events).filter(function(e){return e.start.dayOfYear()===e.end.dayOfYear()&&e.start.month()===n(L.position).month()}).groupBy(function(e){return Math.floor((e.start.date()+L.decallage)/7.01)}).value(),L.multipleDaysEvents=t(L.events).filter(function(e){return e.start.dayOfYear()!==e.end.dayOfYear()}).map(d).flatten().groupBy(function(e){return Math.floor((e.start.date()+L.decallage)/7.01)}).value();var h=n(L.position).endOf("month").isoWeek(),m=n(L.position).startOf("month").isoWeek();1===h&&(h=n(L.position).isoWeeksInYear()+1),h<m&&(h=m+h);for(var b=h-m+1,k=0;k<b;k++)void 0===L.multipleDaysEvents[k]&&(L.multipleDaysEvents[k]=[]);if(L.days=[],f.isoWeekday()-1>0)for(k=0;k<f.isoWeekday()-1;k++)L.days.unshift({});t.times(f.daysInMonth(),function(e){var t=n(f).add(e,"days");L.days.push({date:t,events:[]})});for(var w=L.days.length>35?42:35;L.days.length<w;)L.days.push({})}}function l(e){return L.entitiesName.find(function(n){return n._id===e}).fullname}function s(t){for(var a=!0;a;){var i=t;a=!1,i=e.copy(i);var o=n(i.start).hour(L._dayStart.h).minute(L._dayStart.m).second(0),r=n(i.end).hour(L._dayEnd.h).minute(L._dayEnd.m).second(59);if(i.start.dayOfYear()===i.end.dayOfYear()){if(i.start.isBefore(o)){if(i.end.isBefore(o))return[];i.start=o}if(i.end.isAfter(r)){if(i.start.isAfter(r))return[];i.end=r}return[i]}var l=e.copy(i);l.end=n(i.start).hour(L._dayEnd.h).minute(L._dayEnd.m).second(59),i.start.isBefore(o)&&(l.start=o);var d=n(i.start).add(1,"day").hour(L._dayStart.h).minute(L._dayStart.m),c=n(i.start).hour(L._dayEnd.h).minute(L._dayEnd.m);if(i.end.isBefore(d))return l.start.isAfter(c)?[]:[l];l.continuedAfter=!0;var p=e.copy(i);if(p.start=n(i.start).add(1,"day").hour(L._dayStart.h).minute(L._dayStart.m),p.continuedBefore=!0,!i.start.isAfter(c))return[l].concat(s(p));t=p,a=!0,o=r=l=d=c=p=void 0}}function d(t){if(t.start.isAfter(t.end)){var a=t.start;t.start=t.end,t.end=a}if(t.start.year()<L.position.year()||t.start.month()<L.position.month()){if(t.end.year()<L.position.year()||t.end.month()<L.position.month())return[];t.start=n(L.position).startOf("month")}if(t.end.month()>L.position.month()||t.end.year()!==L.position.year()){if(t.start.month()>L.position.month())return[];t.end=n(L.position).endOf("month")}if(t.start.isoWeek()===t.end.isoWeek())return[t];var i=e.copy(t),o=e.copy(t);return i.continuedAfter=!0,o.continuedBefore=!0,i.end=n(i.start).endOf("week"),o.start.add(1,"week").startOf("week"),[i].concat(d(o))}function c(a){return t.filter(a,function(a){var i,o;switch(L.mode){case"week":case"week-advanced":i=n(L.position).weekday(0).hour(L._dayStart.h).minute(L._dayStart.m).second(0),o=n(L.position).weekday(6).hour(L._dayEnd.h).minute(L._dayEnd.m).second(59);break;case"day":i=n(L.position).startOf("day").hour(L._dayStart.h).minute(L._dayStart.m),o=n(L.position).endOf("day").hour(L._dayEnd.h).minute(L._dayEnd.m);break;case"3day":i=n(L.position).hour(L._dayStart.h).minute(L._dayStart.m).second(0),o=n(L.position).hour(L._dayEnd.h).minute(L._dayEnd.m).second(59);for(var r=[{start:e.copy(i),end:e.copy(o)}],l=0;l<2;){o.add(1,"day");var s=o.day()-1;s<0&&(s=6),(t.isEmpty(L.allowedDays)||t.includes(L.allowedDays,s))&&(r.push({start:e.copy(o).hour(L._dayStart.h).minute(L._dayStart.m).second(0),end:e.copy(o).hour(L._dayEnd.h).minute(L._dayEnd.m).second(59)}),l++)}return t.some(r,function(e){return a.start.isBetween(e.start,e.end)||a.end.isBetween(e.start,e.end)});case"month":i=n(L.position).date(1).hour(L._dayStart.h).minute(L._dayStart.m).second(0),o=n(L.position).weekday(n(L.position).daysInMonth()).hour(L._dayEnd.h).minute(L._dayEnd.m).second(59)}return a.start.isBetween(i,o)||a.end.isBetween(i,o)})}function p(a){a=a||{};var i=n(L.position).weekday(0);t.times(7,function(t){var o=n(e.copy(i)).add(t,"days").format("DD/MM/YYYY");a[o]||(a[o]=[])})}function u(e){e=e||{},t.each(L.entities,function(n){e[n]||(e[n]=[])})}function y(e){return e>=24?{h:23,m:59}:{h:e,m:0}}function v(e){switch(L.mode){case"week":return Object.keys(e).sort(function(e,n){var t=$(e),a=$(n);return t-a});case"week-advanced":case"day":case"3day":return L.entitiesName?L.entitiesName.map(function(e){return e._id}):[]}}function g(e){return L.sortedEvents[e]}function f(e){return L.position.week()===n().week()&&e===n().dayOfYear()}function h(e){if(L.holidays)return L.holidays.find(function(t){return n(t.date).format("L")===n(e).format("L")})}function m(e){return o.isSolidarityDay(e)}function b(a){var i=n(e.copy(a));return t.any(L._absences,function(e){return e.range.contains(i)})}function k(){return n().hour()>parseInt(L._dayStart.h)&&n().hour()<parseInt(L._dayEnd.h)}function w(){var e=60*(n().hour()-parseInt(L._dayStart?L._dayStart.h:0))+n().minutes();return Math.floor(L.zoom*(z*e)/60)}function S(){return L.position.isSame(n(),L.mode)}function E(e){var t,a;switch(L.mode){case"week":var i=e.d.split("/");t=n(new Date(i[2],i[1]-1,i[0],e.h,e.m));break;case"3day":case"day":t=n(L.position).hour(e.h).minute(e.m),a=e.entity;break;case"week-advanced":a=e.entity,t=n(L.position).hour(e.h).minute(e.m).second(0).weekday(e.d)}L.clickCallback({$moment:t,$entity:a})}function D(e,n){e.date&&L.clickCallback({$moment:e.date})}function _(e,n){L.showAbsencesCallback({$absences:e,$day:n})}function x(e){var a=e.moment;if(!a)switch(L.mode){case"week":var o=n($(e.d)).dayOfYear();a=n(L.position).hour(e.h).minute(e.m).second(0).dayOfYear(o);break;case"week-advanced":a=n(L.position).hour(e.h).minute(e.m).second(0).weekday(e.d);break;case"day":a=n(L.position).hour(e.h).minute(e.m);break;case"3day":a=n.unix(e.day).hour(e.h).minute(e.m)}var r=t.includes(["week-advanced","day","3day"],L.mode)?e.entity:void 0;"month"===L.mode&&h(a)?L.isSolidarityDay(a)?L.dropCallback({$moment:a,$data:e.$data,$event:e.$event,$entity:r}):i.isFerieCallback(function(){L.dropCallback({$moment:a,$data:e.$data,$event:e.$event,$entity:r})}):L.dropCallback({$moment:a,$data:e.$data,$event:e.$event,$entity:r})}function $(e){var n=e.split("/");return new Date(n[2],n[1]-1,n[0])}function C(n,t){return t?L.moveAction({$element:e.copy(n)}):L.duplicateAction({$element:e.copy(n)})}var z=i.BASE_SIZE,L=this;L.$onInit=function(){t.extend(L,{isToday:f,currentTimeToPixels:w,isCurrent:S,clickCallbackWrapper:E,showAbsencesCallBackWrapper:_,isInDayRange:k,keys:v,getEvents:g,clickWeekEvent:D,dropEvent:x,isFerie:h,isSolidarityDay:m,hasAbsence:b,getName:l,dayEvent:C}),r()},a.$watchCollection(function(){return[L.events,L.entities,L.position,L.mode,L.dayStart,L.dayEnd,L.zoom,L.usableDays]},r)}function i(){return{restrict:"E",templateUrl:"/directives/planning/planning.html",controller:a,controllerAs:"planning",bindToController:{zoom:"=",events:"=",entities:"=",entitiesName:"=",entitiesPauses:"=?",absences:"=?",position:"=",mode:"=",dayStart:"=",dayEnd:"=",dayField:"=",eventCallback:"&",dayCallback:"&",clickCallback:"&",weekEventCallback:"&",dropCallback:"&",usableDays:"=?",action:"&?",duplicateAction:"&?",moveAction:"&?",holidays:"=",solidarityDays:"=",showAbsencesCallback:"&",aliaCompanySettings:"=",masterDayRange:"="},scope:{}}}e.module("90Tech.planning").directive("zlPlanning",i),a.$inject=["$scope","planningConfiguration","HolidaysServicePlanning"]}(window.angular,window.moment,window._),function(e,n,t){function a(e,a){function i(){s.holidays&&s.day.date&&(s.isFerie=s.holidays.find(function(e){return t(e.date).format("L")===t(s.day.date).format("L")}))}function o(e,n){s.dropCallback({$data:e,$event:n})}function r(e){return a.isSolidarityDay(e)}function l(e){var n=[];return e.forEach(function(e){n.push(s.entities.find(function(n){return n._id===e}).fullname)}),n}var s=this;s.$onInit=function(){n.extend(s,{dropEvent:o,getName:l,isSolidarityDay:r,absents:[]}),s.isDefined=void 0===s.day.events,i(),e.$watchCollection([s.day,s.absences],function(){s.day&&s.day.date&&s.absences&&Object.keys(s.absences).length?(s.absents=Object.keys(s.absences).reduce(function(e,a){var i=s.absences[a],o=n.any(i,function(e){var n=t.range(e.start,e.end);return 0!==t(e.start).diff(e.end,"minutes")&&(12===t(e.start).hours()&&t(e.start).isSame(s.day.date,"day")?!!t(e.start).isBetween(s.day.date,t(s.day.date).endOf("day")):!!s.day.date.within(n)||void 0)});return o&&e.push(a),e},[]),s.absentsString="<div>"+s.getName(s.absents).join("<br>")+"</div>"):(s.absentsString="",s.absents=[])})}}function i(){return{restrict:"E",replace:!0,templateUrl:"/directives/planning-day-block/planning-day.html",controller:a,controllerAs:"dayCtrl",bindToController:{day:"=",events:"=",clickCallback:"&",entities:"=?",dropCallback:"&",absences:"=?",holidays:"="},scope:!0,link:function(e,n){var t=n[0];window.addEventListener("dragover",function(e){e.preventDefault()},!1),window.addEventListener("drop",function(e){e.preventDefault()},!1),t.addEventListener("drop",function(n){return n.preventDefault(),n.stopPropagation(),n.stopPropagation&&n.stopPropagation(),this.classList.remove("over"),e.$apply(function(){e.dayCtrl.dropEvent(JSON.parse(n.dataTransfer.getData("Text")),n)}),!1},!1),t.addEventListener("dragenter",function(e){return this.classList.add("over"),!1},!1),t.addEventListener("dragleave",function(e){return this.classList.remove("over"),!1},!1)}}}e.module("90Tech.planning").directive("zlPlanningDay",i),a.$inject=["$scope","HolidaysServicePlanning"]}(window.angular,window._,window.moment);var _slicedToArray=function(){function e(e,n){var t=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(t.push(r.value),!n||t.length!==n);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(e,n,t){function a(a,i){function o(){s.threeDays||(s.activateDuplicationButtons=!0),s.days=[],s.allowedDays=s.usableDays,s._absences=[],"week"===s.mode?(t.forEach(s.allowedDays,function(e){var t=n(s.position);t.weekday(e),s.days.push(t)}),s.days=t.sortBy(s.days,function(e){return n(e).toDate()}),s.absences&&!function(){var t=0;s.days.forEach(function(a){s._absences[t]=[];var i=!0,o=!1,r=void 0;try{for(var l,d=Object.entries(s.absences)[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var c=_slicedToArray(l.value,2),p=(c[0],c[1]);p.forEach(function(i){(a.isBetween(n(i.start),n(i.end))||n(a).isSame(n(i.start),"day")&&n(a).isSame(n(i.end),"day"))&&s._absences[t].push(e.copy(i))})}}catch(e){o=!0,r=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw r}}t++})}()):"day"===s.mode&&s.dayField&&(s.column=s.entitiesName)}function r(n,t){return t?s.dayEvent(e.copy(s.events[n._id]),!0):s.dayEvent(e.copy(s.events[n._id]))}function l(e){return i.isSolidarityDay(e)}var s=this;s.$onInit=function(){t.extend(s,{triggerDayEvent:r,isSolidarityDay:l}),a.$watchCollection(function(){return[s.events,s.position,s.mode,s.dayStart,s.dayEnd,s.usableDays,s.entitiesName]},o)}}function i(){return{restrict:"E",templateUrl:"/directives/planning-left-column/planning-left-column.html",controller:a,controllerAs:"planningLeftColumn",bindToController:{events:"=",entitiesName:"=",position:"=",mode:"=",dayField:"=",usableDays:"=",isFerie:"=?",absences:"=",dayEvent:"=",threeDays:"<"},scope:!0}}e.module("90Tech.planning").directive("zlPlanningLeftColumn",i),a.$inject=["$scope","HolidaysServicePlanning"]}(window.angular,window.moment,window._);var _slicedToArray=function(){function e(e,n){var t=[],a=!0,i=!1,o=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(t.push(r.value),!n||t.length!==n);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(e,n,t){function a(a,i,o,r,l,s,d){function c(e){var n="",t=e.absenceType,a="week"===x.mode?e.user.fullname+" - ":"";switch(e.confirmation.state){case"sending":n=a+"Absence envoyée";break;case"pending":n=a+"Absence en cours de traitement";break;case"partial-accepted":n=a+"Absence en cours de traitement";break;case"accepted":n=a+"Absence acceptée"}return t?n+"\nRaison: "+t:n}function p(e){var t;return t=n.contains(e.target.classList,"half-hour")?30:Math.floor(e.offsetX/(E*x.zoom)*60)}function u(e){x.tooltip=c(e);var n=!0,t=!1,a=void 0;try{for(var i,o=document.getElementsByClassName(e._id)[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var r=i.value;r.classList.add("absence-hover")}}catch(e){t=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(t)throw a}}}function y(){var e=!0,n=!1,t=void 0;try{for(var a,i=document.getElementsByClassName("absence")[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;o.classList.remove("absence-hover")}}catch(e){n=!0,t=e}finally{try{!e&&i.return&&i.return()}finally{if(n)throw t}}}function v(n,a,o){var r=parseInt(a.target.getAttribute("hour")),l=p(a),s=t(e.copy(x.position)).hours(r+parseInt(x.dayStart.h)).minutes(l),c=o.dayOfWeek?o.dayOfWeek:o.position;b(s)&&k(c)?i.warningCallback(function(){x.dropCallback({$data:n,$event:a,$hour:r+parseInt(x.dayStart.h),$minutes:l})}):b(s)&&!k(c)?i.absentTechnicianCallback(function(){x.dropCallback({$data:n,$event:a,$hour:r+parseInt(x.dayStart.h),$minutes:l})}):!b(s)&&k(c)?d.isSolidarityDay(c)?x.dropCallback({$data:n,$event:a,$hour:r+parseInt(x.dayStart.h),$minutes:l}):i.isFerieCallback(function(){x.dropCallback({$data:n,$event:a,$hour:r+parseInt(x.dayStart.h),$minutes:l})}):x.dropCallback({$data:n,$event:a,$hour:r+parseInt(x.dayStart.h),$minutes:l})}function g(n,a,o){var r=o.dayOfWeek?o.dayOfWeek:o.position,l=p(a),s=t(e.copy(x.position)).hours(n+parseInt(x.dayStart.h)).minutes(l);b(s)&&k(r)?i.warningCallback(function(){x.clickCallback({$hour:n+parseInt(x.dayStart.h),$minutes:l})}):b(s)&&!k(r)?i.absentTechnicianCallback(function(){x.clickCallback({$hour:n+parseInt(x.dayStart.h),$minutes:l})}):!b(s)&&k(r)?d.isSolidarityDay(r)?x.clickCallback({$hour:n+parseInt(x.dayStart.h),$minutes:l}):i.isFerieCallback(function(){x.clickCallback({$hour:n+parseInt(x.dayStart.h),$minutes:l})}):x.clickCallback({$hour:n+parseInt(x.dayStart.h),$minutes:l})}function f(){var a=0;x.preEvent={},x.postEvent={},x.breaks=[],x._events=e.copy(x.events),x.range=x.dayEnd.h-x.dayStart.h,x.SECONDS_BY_DAY=3600*x.range,x.SLIDER_WIDTH=E*x.range,x._events=n.sortBy(x._events,function(e){return e.start.valueOf()});var i=[[]],s=[];n.each(x._events,function(e){var n={};if(e.depth=1,e.range=t.range(e.start,e.end),e.range<9e5){var a=t(e.start).add(15,"minutes");e.range=t.range(e.start,a)}n.left=(e.start.hours()-x.dayStart.h)*E*x.zoom+e.start.minutes()*E*x.zoom/60+"px",n.width=x.zoom*x.SLIDER_WIDTH*e.range/x.SECONDS_BY_DAY/1e3+"px",n["background-color"]=e["background-color"]||"#778899",r.getLuminance(n["background-color"])>200?n.color="black":n.color="white",e.style=n,o.overlap(i,e,_,s)}),x._events=n.difference(x._events,s),n.each(x._events,function(o){if(o.id=e.copy(a),o.line===_&&(o.style.left=(o.start.hours()-x.dayStart.h)*E*x.zoom+o.start.minutes()*E*x.zoom/60+"px",o.style.width=x.zoom*x.SLIDER_WIDTH*o.range.valueOf()/x.SECONDS_BY_DAY/1e3+"px",o.style["background-color"]="#000",o.style["font-weight"]="bold",o.style.color="#fff",o.title=o.eventList.length+" "+D,o.tooltip&&(o.tooltip=o.title)),o.style.width=x.zoom*x.SLIDER_WIDTH*o.range.valueOf()/x.SECONDS_BY_DAY/1e3+"px",void 0===o.line&&(o.line=_),o.style.top=Math.round(70*parseInt(o.line)/i.length)+"%",o.style.height=Math.round(70/i.length)+"%",o.percentage="100%",o.pre>0){o.style["border-left"]="none";var r=t(o.start).subtract(o.pre,"minutes");t(r).isSame(o.start,"day")||(r=t(o.start).startOf("day"));var s=t(o.start),d=t.range(r,s),c=t.range(r,o.range.end),p=d.valueOf()/c.valueOf()*100;o.percentage=100-p+"%";var u={percentage:p+"%",style:{left:(t(r).hours()-x.dayStart.h)*E*x.zoom+t(r).minutes()*E*x.zoom/60+2+"px",width:x.zoom*x.SLIDER_WIDTH*d.valueOf()/x.SECONDS_BY_DAY/1e3+"px",top:o.style.top,height:o.style.height,totalWidth:x.zoom*x.SLIDER_WIDTH*c.valueOf()/x.SECONDS_BY_DAY/1e3+"px","text-align":"center",color:"#fff",background:"repeating-linear-gradient(45deg, "+o["background-color"]+", "+o["background-color"]+" 10px, white 10px, white 20px)","border-top":"1px lightgrey solid","border-bottom":"1px lightgrey solid","border-left":"1px lightgrey solid"},tooltip:"Trajet estimé de "+o.pre+" min"};p>0?x.preEvent[o.id]=u:o.pre=0}w(o),o.pauses&&(o.style["background-image"]=l.generateGradient(o,"to right"),o.style["background-color"]=void 0);var y=x.preEvent[o.id],v=x.postEvent[o.id];o.style.totalWidth=S(o.style.width)+S(n.get(y,"style.width"))+S(n.get(v,"style.width"))+1+"px",a++}),x.pauses&&m()}function h(e){return parseInt(e)*E+"px"}function m(){x.breaks=n.compact(n.map(x.pauses.breaks,function(n){var a={name:n.name,start:t().hours(n.start.split(":")[0]).minute(n.start.split(":")[1]).second(0),end:t().hours(n.end.split(":")[0]).minute(n.end.split(":")[1]).second(0),style:{}};if(!a.start.isAfter(x.dayEnd)&&!a.end.isBefore(x.dayStart))return a.start.isBefore(x.dayStart)&&(a.start=t(e.copy(x.dayStart))),a.end.isAfter(x.dayEnd)&&(a.end=t(e.copy(x.dayEnd))),a.style.left=(a.start.hours()-x.dayStart.h)*E*x.zoom+a.start.minutes()*E*x.zoom/60+"px",a.style.width=x.zoom*x.SLIDER_WIDTH*t.range(a.start,a.end).valueOf()/x.SECONDS_BY_DAY/1e3+"px",a}))}function b(a){if("week"===x.mode)return!1;var i=t(e.copy(a));return n.any(x._absences,function(e){return e.range.contains(i)})}function k(e){return x.holidays.find(function(n){return t(n.date).format("L")===t(e).format("L")})}function w(e){if(!e.post)return null;e.style["border-right"]="none";var n=t(e.end).add(e.post,"minutes");t(n).isSame(e.end,"day")||(n=t(e.end).endOf("day"));var a=t(e.end),i=t.range(a,n),o=t.range(e.range.start,e.range.end),r=i.valueOf()/o.valueOf()*100;e.postPercentage=100-r+"%";var l={percentage:r+"%",style:{left:(t(a).hours()-x.dayStart.h)*E*x.zoom+t(a).minutes()*E*x.zoom/60+2+"px",width:x.zoom*x.SLIDER_WIDTH*i.valueOf()/x.SECONDS_BY_DAY/1e3+"px",top:e.style.top,height:e.style.height,totalWidth:x.zoom*x.SLIDER_WIDTH*o.valueOf()/x.SECONDS_BY_DAY/1e3+"px","text-align":"center",color:"#fff",background:"repeating-linear-gradient(135deg, "+e["background-color"]+", "+e["background-color"]+" 10px, white 10px, white 20px)","border-top":"1px lightgrey solid","border-bottom":"1px lightgrey solid","border-left":"1px lightgrey solid"},tooltip:"Trajet retour de "+e.post+" min"};r>0?x.postEvent[e.id]=l:e.post=0}function S(){var e=arguments.length<=0||void 0===arguments[0]?"0px":arguments[0];return parseInt(e.replace("px",""))}var E=i.BASE_SIZE,D=i.parallelText,_=i.MAX_PARALLEL,x=this;x.$onInit=function(){n.extend(x,{clickEvent:g,calcWidth:h,dropEvent:v,hoverAbsence:u,leaveAbsence:y}),f(),a.$watchCollection(function(){return[x.events,x.dayStart,x.dayEnd]},f),a.$watchCollection(function(){return[x.absences]},function(n,a){if(Array.isArray(x.absences)&&x.absences.length){var i=t(e.copy(x.position)).startOf("day"),o=t(e.copy(x.position)).endOf("day");x._absences=s.parseAbsences(x.absences,[i,o]).map(function(e){return e.style={left:(t(e.start).hours()-x.dayStart.h)*E*x.zoom+t(e.start).minutes()*E*x.zoom/60+"px",width:x.zoom*x.SLIDER_WIDTH*t.range(e.start,e.end).valueOf()/x.SECONDS_BY_DAY/1e3+"px"},e.range=t.range(e.start,e.end),e.class="planning-absence-"+e.confirmation.state,e.tooltip=c(e),e})}else if(x.absences){var i=t(e.copy(x.dayOfWeek)).startOf("day"),o=t(e.copy(x.dayOfWeek)).endOf("day");x._absences=[];var r=!0,l=!1,d=void 0;try{for(var p,u=Object.entries(x.absences)[Symbol.iterator]();!(r=(p=u.next()).done);r=!0){var y=_slicedToArray(p.value,2),v=(y[0],y[1]);v.forEach(function(n){(x.dayOfWeek.isBetween(t(n.start),t(n.end))||t(x.dayOfWeek).isSame(t(n.start),"day")&&t(x.dayOfWeek).isSame(t(n.end),"day"))&&x._absences.push(e.copy(n))})}}catch(e){l=!0,d=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw d}}x._absences.forEach(function(e){var n=x._absences.indexOf(e);(t(e.start).isBefore(t(x.dayOfWeek).startOf("day"))&&t(e.end).isAfter(t(x.dayOfWeek).endOf("day"))||t(e.end).isSame(t(x.dayOfWeek).endOf("day"))&&t(e.start).isBefore(t(x.dayOfWeek).startOf("hour"))||t(e.start).isSame(t(x.dayOfWeek).startOf("day"))&&t(e.end).isAfter(t(x.dayOfWeek).endOf("day")))&&(e.start=t(x.dayOfWeek).startOf("day"),e.end=t(x.dayOfWeek).endOf("day")),e.style={left:(t(e.start).hours()-x.dayStart.h)*E*x.zoom+t(e.start).minutes()*E*x.zoom/60+"px",width:x.zoom*x.SLIDER_WIDTH*t.range(e.start,e.end).valueOf()/x.SECONDS_BY_DAY/1e3+"px",height:100/x._absences.length+"%",position:"absolute",top:100/x._absences.length*n+"%"},e.range=t.range(e.start,e.end),
e.class="planning-absence-"+e.confirmation.state,e.tooltip=c(e),e.index=n})}else x._absences=[]})},x.log=function(e){},x.replace=function(e){if(e)return e.replace(/([a-zA-Z\ ])\w+/,"")},x.preEvent={},x.postEvent={}}function i(){return{restrict:"E",templateUrl:"/directives/planning-line/planning-line.html",controller:a,controllerAs:"line",bindToController:{zoom:"=",dayStart:"=",dayEnd:"=",events:"=",clickCallback:"&",dropCallback:"&",pauses:"=?",absences:"=?",position:"=?",mode:"=?",entities:"=?",dayOfWeek:"=",holidays:"="},scope:!0}}e.module("90Tech.planning").directive("zlPlanningLine",i),a.$inject=["$scope","planningConfiguration","PositionService","ColorService","PauseService","AbsenceService","HolidaysServicePlanning"]}(window.angular,window._,window.moment),function(e,n,t){function a(e){function a(e){function a(){var e=l.dayEnd.h-l.dayStart.h+1;l.hours=[],t.times(e,function(e){var t=n(l.position);t.hour(e+parseInt(l.dayStart.h)),t.minute(0),l.hours.push(t)})}function o(e){return parseInt(e)*i+"px"}function r(e,n){var t=parseInt(e)*(i/2);return n||(t-=3*parseInt(e)),"0 "+t+"px 0 -"+t+"px"}var l=this;l.$onInit=function(){e.$watchGroup([function(){return l.dayStart},function(){return l.dayEnd}],a),t.extend(l,{calcWidth:o,calcMargin:r}),a()}}var i=e.BASE_SIZE;return{restrict:"E",templateUrl:"/directives/planning-top-row/planning-top-row.html",controller:["$scope",a],controllerAs:"planningTopRow",bindToController:{zoom:"=",dayStart:"=",dayEnd:"=",events:"=",entities:"=",position:"=",mode:"=",callback:"&",holidays:"="},scope:{}}}e.module("90Tech.planning").directive("zlPlanningTopRow",a),a.$inject=["planningConfiguration"]}(window.angular,window.moment,window._),function(e,n,t){function a(a,i,o,r,l,s,d,c,p){function u(e){var n="",t=e.absenceType;switch(e.confirmation.state){case"sending":n="Absence envoyée";break;case"pending":n="Absence en cours de traitement";break;case"partial-accepted":n="Absence en cours de traitement";break;case"accepted":n="Absence acceptée"}return t?n+"\nRaison:"+t:n}function y(e){var t;return t=n.contains(e.target.classList,"half-hour")?30:10*Math.floor(e.offsetY/(x*L.zoom)*6)}function v(n,a,i){var o=parseInt(a.target.getAttribute("hour")),l=y(a),s=t(e.copy(L.day)).hours(o+parseInt(L.dayStart.h)).minutes(l),d=i;D(s)&&_(d)?r.warningCallback(function(){L.dropCallback({$data:n,$event:a,$hour:o,$minutes:l})}):D(s)&&!_(d)?r.absentTechnicianCallback(function(){L.dropCallback({$data:n,$event:a,$hour:o,$minutes:l})}):!D(s)&&_(d)?p.isSolidarityDay(d)?L.dropCallback({$data:n,$event:a,$hour:o,$minutes:l}):r.isFerieCallback(function(){L.dropCallback({$data:n,$event:a,$hour:o,$minutes:l})}):L.dropCallback({$data:n,$event:a,$hour:o,$minutes:l})}function g(){var e=!0,n=!1,t=void 0;try{for(var a,i=document.getElementsByClassName("absence")[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;o.classList.add("absence-week-advanced-hover")}}catch(e){n=!0,t=e}finally{try{!e&&i.return&&i.return()}finally{if(n)throw t}}}function f(){var e=!0,n=!1,t=void 0;try{for(var a,i=document.getElementsByClassName("absence")[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;o.classList.remove("absence-week-advanced-hover")}}catch(e){n=!0,t=e}finally{try{!e&&i.return&&i.return()}finally{if(n)throw t}}}function h(n,a,i){var o=y(a),l=t(e.copy(L.day)).hours(n+parseInt(L.dayStart.h)).minutes(o);D(l)&&_(i)?r.warningCallback(function(){L.clickCallback({$hour:n+parseInt(L.dayStart.h),$minutes:o})}):D(l)&&!_(i)?r.absentTechnicianCallback(function(){L.clickCallback({$hour:n+parseInt(L.dayStart.h),$minutes:o})}):!D(l)&&_(i)?p.isSolidarityDay(i)?L.clickCallback({$hour:n+parseInt(L.dayStart.h),$minutes:o}):r.isFerieCallback(function(){L.clickCallback({$hour:n+parseInt(L.dayStart.h),$minutes:o})}):L.clickCallback({$hour:n+parseInt(L.dayStart.h),$minutes:o})}function m(){var a=0;L.preEvent={},L.breaks=[],L._events=e.copy(L.events),L.range=L.dayEnd.h-L.dayStart.h,L.SECONDS_BY_DAY=3600*L.range,L.SLIDER_WIDTH=x*L.range,L._events=n.sortBy(L._events,function(e){return e.start.valueOf()});var r=[[]],c=[];n.each(L._events,function(e){var n={};if(e.depth=1,e.range=t.range(e.start,e.end),e.range<9e5){var a=t(e.start).add(15,"minutes");e.range=t.range(e.start,a)}n.left=(e.start.hours()-L.dayStart.h)*x*L.zoom+e.start.minutes()*x*L.zoom/60+"px",n.width=L.zoom*L.SLIDER_WIDTH*e.range/L.SECONDS_BY_DAY/1e3+"px",n["background-color"]=e["background-color"]||"#778899",s.getLuminance(n["background-color"])>200?n.color="black":n.color="white",e.style=n,l.overlap(r,e,C,c)}),L._events=n.difference(L._events,c),n.each(L._events,function(i){if(i.id=e.copy(a),i.line===C&&(i.style.left=(i.start.hours()-L.dayStart.h)*x*L.zoom+i.start.minutes()*x*L.zoom/60+"px",i.style.width=L.zoom*L.SLIDER_WIDTH*i.range.valueOf()/L.SECONDS_BY_DAY/1e3+"px",i.style["background-color"]="#000",i.style["font-weight"]="bold",i.title=i.eventList.length+" "+$,i.style.color="#fff",i.tooltip&&(i.tooltip=i.title)),i.style.width=L.zoom*L.SLIDER_WIDTH*i.range.valueOf()/L.SECONDS_BY_DAY/1e3+"px",void 0===i.line&&(i.line=C),i.style.top=Math.round(parseInt(i.line)*z/r.length)+"%",i.style.height=Math.round(z/r.length)+"%",i.percentage="100%",i.continuedBefore&&(i.pre=0),i.pre>0){i.style["border-left"]="none";var o=t(i.start).subtract(i.pre,"minutes");t(o).isSame(i.start,"day")||(o=t(i.start).startOf("day"));var l=t(i.start),s=t.range(o,l),c=t.range(o,i.range.end),p=s.valueOf()/c.valueOf()*100;i.percentage=100-p+"%";var u={percentage:p+"%",style:{left:(t(o).hours()-L.dayStart.h)*x*L.zoom+t(o).minutes()*x*L.zoom/60+"px",width:L.zoom*L.SLIDER_WIDTH*s.valueOf()/L.SECONDS_BY_DAY/1e3+"px",top:i.style.top,height:i.style.height,totalWidth:L.zoom*L.SLIDER_WIDTH*c.valueOf()/L.SECONDS_BY_DAY/1e3+"px","text-align":"center",color:"#fff",background:"repeating-linear-gradient(45deg, "+i["background-color"]+", "+i["background-color"]+" 10px, white 10px, white 20px)","border-top":"1px lightgrey solid","border-bottom":"1px lightgrey solid","border-left":"1px lightgrey solid"},tooltip:"Trajet estimé de "+i.pre+" min"};p>0?L.preEvent[i.id]=u:i.pre=0}k(i),i.pauses&&(i.style["background-image"]=d.generateGradient(i,"to bottom"),i.style["background-color"]=void 0);var y=L.preEvent[i.id],v=L.postEvent[i.id];i.style.totalWidth=b(i.style.width)+b(n.get(y,"style.width"))+b(n.get(v,"style.width"))+1+"px",a++}),L.pauses&&S(),E(),i.$on("$destroy",function(){o.$broadcast("context-menu/close")})}function b(){var e=arguments.length<=0||void 0===arguments[0]?"0px":arguments[0];return parseInt(e.replace("px",""))}function k(e){if(!e.post)return null;var n=t(e.end).add(e.post,"minutes");t(n).isSame(e.end,"day")||(n=t(e.end).endOf("day"));var a=t(e.end),i=t.range(a,n),o=t.range(e.range.start,e.range.end),r=i.valueOf()/o.valueOf()*100;e.postPercentage=100-r+"%";var l={percentage:r+"%",style:{left:(t(a).hours()-L.dayStart.h)*x*L.zoom+t(a).minutes()*x*L.zoom/60+2+"px",width:L.zoom*L.SLIDER_WIDTH*i.valueOf()/L.SECONDS_BY_DAY/1e3+"px",top:e.style.top,height:e.style.height,totalWidth:L.zoom*L.SLIDER_WIDTH*o.valueOf()/L.SECONDS_BY_DAY/1e3+"px","text-align":"center",color:"#fff",background:"repeating-linear-gradient(135deg, "+e["background-color"]+", "+e["background-color"]+" 10px, white 10px, white 20px)","border-top":"1px lightgrey solid","border-bottom":"1px lightgrey solid","border-left":"1px lightgrey solid"},tooltip:"Trajet retour de "+e.post+" min"};r>0?L.postEvent[e.id]=l:e.post=0}function w(e){return parseInt(e)*x+"px"}function S(){L.breaks=n.compact(n.map(L.pauses.breaks,function(n){var a={name:n.name,start:t().hours(n.start.split(":")[0]).minute(n.start.split(":")[1]).second(0),end:t().hours(n.end.split(":")[0]).minute(n.end.split(":")[1]).second(0),style:{}};if(!a.start.isAfter(L.dayEnd)&&!a.end.isBefore(L.dayStart))return a.start.isBefore(L.dayStart)&&(a.start=t(e.copy(L.dayStart))),a.end.isAfter(L.dayEnd)&&(a.end=t(e.copy(L.dayEnd))),a.style.top=(t(a.start).hours()-L.dayStart.h)*x*L.zoom+t(a.start).minutes()*x*L.zoom/60+"px",a.style.height=L.zoom*L.SLIDER_WIDTH*t.range(a.start,a.end).valueOf()/L.SECONDS_BY_DAY/1e3+"px",a}))}function E(){L.containerHeight=parseInt(L.zoom)*x*a("range")(L.range)+"px"}function D(a){var i=t(e.copy(a));return n.any(L._absences,function(e){return e.range.contains(i)})}function _(e){return L.holidays.find(function(n){return t(n.date).format("L")===t(e).format("L")})}var x=Math.max(r.BASE_SIZE-8,1),$=r.parallelText,C=r.MAX_PARALLEL,z=90,L=this;L.$onInit=function(){L.range=L.dayEnd.h-L.dayStart.h,L.SECONDS_BY_DAY=3600*L.range,L.SLIDER_WIDTH=x*L.range,i.$watchCollection(function(){return[L.events,L.dayStart,L.dayEnd]},m),i.$watchCollection(function(){return L.absences},function(n,a){if(Array.isArray(L.absences)&&L.absences.length){var i=t(e.copy(L.day)).startOf("day"),o=t(e.copy(L.day)).endOf("day");L._absences=c.parseAbsences(e.copy(L.absences),[i,o]).map(function(e){var n=(t(e.start).hours()-L.dayStart.h)*x*L.zoom+t(e.start).minutes()*x*L.zoom/60,a=L.zoom*L.SLIDER_WIDTH*t.range(e.start,e.end).valueOf()/L.SECONDS_BY_DAY/1e3;return"0px"===e.style.top?e.style.height=n+a+"px":(e.style.height=a+"px",e.style.top=n+"px"),e.range=t.range(e.start,e.end),e.class="planning-absence-"+e.confirmation.state,e.tooltip=u(e),e})}else L._absences=[]}),n.extend(L,{clickEvent:h,calcWidth:w,dropEvent:v,hoverAbsence:g,leaveLine:f}),m()},L.log=function(e){},L.replace=function(e){if(e)return e.replace(/([a-zA-Z\ ])\w+/,"")},L.preEvent={},L.postEvent={}}function i(){return{restrict:"E",templateUrl:"/directives/planning-vertical-line/planning-vertical-line.html",controller:a,controllerAs:"line",bindToController:{zoom:"=",dayStart:"=",dayEnd:"=",events:"=",pauses:"=?",day:"=",absences:"=?",holidays:"=?",clickCallback:"&",dropCallback:"&"},scope:!0}}e.module("90Tech.planning").directive("zlPlanningVerticalLine",i),a.$inject=["$filter","$scope","$rootScope","planningConfiguration","PositionService","ColorService","PauseService","AbsenceService","HolidaysServicePlanning"]}(window.angular,window._,window.moment),function(e,n,t){function a(e,a,i,o){function r(){p.displayedEvents=t(p.events).sortBy(function(e){return e.continuedBefore?-1:e.continuedAfter?0:1}).value(),p.displayedEvents=l(p.displayedEvents),p.oneDayEvents=l(p.oneDayEvents)}function l(e){var i=[[]],o=[];return t.each(e,function(e){e.style={},e.depth=1,e.range=n.range(e.start,e.end),a.overlap(i,e,y,o,!0)}),e=t.difference(e,o),t.each(e,function(e){s(e,i.length)}),e}function s(e,n){e.style.left=c(e),e.style.width=d(e),e.style["background-color"]=e["background-color"],o.getLuminance(e.style["background-color"])>200?e.style.color="black":e.style.color="white",e.style.top=Math.ceil(100*e.line/n)+"%",e.style.height=Math.round(100/n)+"%",void 0===e.line&&(e.line=y),e.eventList&&e.eventList.length>1&&(e.style["background-color"]="#000",e.style.color="#FFF",e.style["font-weight"]="bold",e.title=e.eventList.length+" "+u,e.tooltip&&(e.tooltip=e.title))}function d(e){if(e.start.day()===e.end.day())return(e.end.diff(e.start,"days")+1)*(100/7)+"%";var n=Math.ceil(e.end.diff(e.start,"hours")/24);return e.end.hours()<e.start.hours()&&(n+=1),n*(100/7)+"%"}function c(e){return(e.start.isoWeekday()-1)*(99.9/7)+"%"}var p=this;p.$onInit=function(){t.extend(p,{calculateWidth:d,calculateLeft:c}),r(),e.$watchCollection(function(){return[p.events,p.week]},r)};var u=i.parallelText,y=i.MAX_PARALLEL}function i(){return{restrict:"E",replace:!0,templateUrl:"/directives/planning-week-line/planning-week-line.html",controller:a,controllerAs:"line",bindToController:{events:"=",week:"=",oneDayEvents:"=",weekEventCallback:"&"},scope:!0}}e.module("90Tech.planning").directive("zlPlanningWeekLine",i),a.$inject=["$scope","PositionService","planningConfiguration","ColorService"]}(window.angular,window.moment,window._),angular.module("90Tech.planning").run(["$templateCache",function(e){e.put("/templates/planning-context-menu.html",'<ul class="dropdown-menu context-menu" ng-click=$event.stopPropagation(); style="z-index: 10"><li ng-if="!event.eventList.length && !ev.eventList.length"><a ng-click="planning.action({$element: event || ev})"><i class="mdi mdi-chevron-down"></i> Ouvrir dans un nouvel onglet {{event.eventList.length}}</a></li><li ng-if="!event.eventList.length && !ev.eventList.length"><a ng-click="planning.duplicateAction({$element: event || ev})"><i class="mdi mdi-chevron-down"></i> Dupliquer l\'intervention {{event.eventList.length}}</a></li></ul>'),e.put("/templates/planning-line-context-menu.html",'<ul class="dropdown-menu context-menu" ng-click=$event.stopPropagation(); style="z-index: 10"><li ng-if="!event.eventList.length && !ev.eventList.length"><a ng-click="planning.dayEvent(line._events, false)"><i class="mdi mdi-chevron-down"></i> Dupliquer la journée {{event.eventList.length}}</a></li><li ng-if="!event.eventList.length && !ev.eventList.length"><a ng-click="planning.dayEvent(line._events, true)"><i class="mdi mdi-chevron-down"></i> Déplacer la journée {{event.eventList.length}}</a></li></ul>'),e.put("/directives/planning/planning.html",'<div ng-if="planning.mode ===\'day\' || planning.mode === \'week\'" style="height: 100%;"><zl-planning-left-column mode=planning.mode position=planning.position day-field=planning.dayField entities-name=planning.entitiesName , usable-days=planning.allowedDays day-event=planning.dayEvent move-action=planning.moveAction show-absences-callback="planning.showAbsencesCallBackWrapper({absences: absences, day: day})" events=planning.sortedEvents absences=planning.absences is-ferie=planning.isFerie(planning.position)></zl-planning-left-column><div class style=height:100%><div zl-horizontal-scroll scroll-left=planning.currentTimeToPixels() style=height:100%><div ng-style="{width: planning.width}" class=planning-body><zl-planning-top-row mode=planning.mode zoom=planning.zoom position=planning.position holidays=planning.holidays day-start=planning._dayStart day-end=planning._dayEnd></zl-planning-top-row><div class=hour-cursor ng-style="{left: planning.currentTimeToPixels()+\'px\'}" ng-if="planning.isCurrent() && planning.isInDayRange()"><div class=hour-caret></div></div><div ng-if=planning.isFerie(planning.position)></div><div class=planning-2pc ng-class="{ isFerie: (planning.mode === \'day\' && planning.isFerie(planning.position)), isSolidarityDay: (planning.mode === \'day\' && planning.isSolidarityDay(planning.position))}"></div><zl-planning-line ng-if="planning.mode === \'day\'" zoom=planning.zoom absences=planning.absences[i] position=planning.position day-start=planning._dayStart day-end=planning._dayEnd ng-repeat="i in planning.keys(planning.sortedEvents)" class="day b-b" ng-class="{today: planning.isToday(i)}" events=planning.getEvents(i) pauses=planning.entitiesPauses[i][0] holidays=planning.holidays drop-callback="planning.dropEvent({h: $hour, m: $minutes, d: i, entity: i, $data: $data, $event: $event})" click-callback="planning.clickCallbackWrapper({h: $hour, m: $minutes, d: i, entity: i})"></zl-planning-line><zl-planning-line ng-if="planning.mode === \'week\'" zoom=planning.zoom ng-repeat="day in planning.usableDays" position=planning.position entities=planning.entities day-of-week=planning.daysList[day] mode=planning.mode holidays=planning.holidays day-start=planning._dayStart day-end=planning._dayEnd class="day b-b" ng-class="{today: planning.isToday(planning.keys(planning.sortedEvents)[day])}" events=planning.getEvents(planning.keys(planning.sortedEvents)[day]) drop-callback="planning.dropEvent({h: $hour, m: $minutes, d: planning.keys(planning.sortedEvents)[day], entity: planning.keys(planning.sortedEvents)[day], $data: $data, $event: $event})" click-callback="planning.clickCallbackWrapper({h: $hour, m: $minutes, d: planning.keys(planning.sortedEvents)[day], entity: planning.keys(planning.sortedEvents)[day]})"></zl-planning-line></div></div></div></div><div ng-if="planning.mode === \'3day\'" style="height: 100%;"><zl-planning-left-column mode="\'day\'" three-days=true position=planning.position entities-name=planning.entitiesName day-field=planning.dayField usable-days=planning.allowedDays events=planning.sortedEvents></zl-planning-left-column><div style="height: 100%; display: flex; flex-flow: row nowrap;" zl-horizontal-scroll><div style=height:100%; ng-repeat="day in planning.groupedEvents track by $index"><div style="height:100%; display: inline-block;"><div ng-style="{width: planning.width}" class=planning-body><zl-planning-top-row mode="\'day\'" zoom=planning.zoom position=planning.position day-start=planning._dayStart day-end=planning._dayEnd></zl-planning-top-row><p style="position: absolute; top: 27px; font-size: 1.4em; font-weight: bold; width: 100%; padding-left: 5px;" ng-class="{isFerie: planning.isFerie(day.date), isSolidarityDay: planning.isSolidarityDay(day.date)}">{{day.day}} <span class=holidays ng-if=planning.isFerie(day.date)>férié</span> <span class=solidarityDay ng-if=planning.isSolidarityDay(day.date)>Journée de solidarité</span></p><div class=hour-cursor ng-style="{left: planning.currentTimeToPixels()+\'px\'}" ng-if="planning.isCurrent() && planning.isInDayRange()"><div class=hour-caret></div></div><div class=planning-2pc></div><zl-planning-line zoom=planning.zoom position=day.date absences=day.absences[i] day-start=planning._dayStart day-end=planning._dayEnd ng-repeat="i in planning.keys(day.value) track by $index" class="day b-b" events=day.value[i] pauses=planning.entitiesPauses[i][$parent.$index] holidays=planning.holidays drop-callback="planning.dropEvent({h: $hour, m: $minutes, d: i, entity: i, $data: $data, $event: $event, day: day.key})" click-callback="planning.clickCallbackWrapper({h: $hour, m: $minutes, d: i, entity: i})" is-solidarity-day=planning.isSolidarityDay></zl-planning-line></div></div></div></div></div><div ng-if="planning.mode ===\'week-advanced\'" class=advanced-week><div class=days-list><div class=day-advanced>&nbsp;</div><div class=day-advanced ng-repeat="day in planning.daysList" ng-click=planning.dayCallback({$day:day}) ng-class="{isFerie: planning.isFerie(day), isSolidarityDay: planning.isSolidarityDay(day)}"><span class=day-text>{{day | format:\'dddd\' | capitalize}}<br><small>{{day | format:\'ll\'}}</small> <span class=holidays ng-if=planning.isFerie(day)>férié</span> <span class=solidarityDay ng-if=planning.isSolidarityDay(day)>Journée de solidarité</span></span></div></div><div class=advanced-week-container ng-repeat="name in planning.keys(planning.sortedEvents)"><div class=left-column-advanced><span style=margin:auto>{{planning.getName(name)}}</span></div><div ng-repeat="day in planning.allowedDays" style="overflow: hidden;" class=day-advanced><zl-planning-vertical-line day=planning.daysList[$index] zoom=planning.zoom drop-callback="planning.dropEvent({h: $hour, m: $minutes, d:day, entity: name, $data: $data, $event: $event})" day-start=planning._dayStart day-end=planning._dayEnd events=planning.getEvents(name)[day] pauses=planning.entitiesPauses[name][$index] absences=planning.absences[name] holidays=planning.holidays click-callback="planning.clickCallbackWrapper({h: $hour, m: $minutes, d: day, entity: name})" is-solidarity-day-scoped=planning.isSolidarityDay></zl-planning-vertical-line></div></div></div><div ng-if="planning.mode === \'month\'" style="height: 100%; z-index: 1000;"><div class=month-header><span class=month-text>{{planning.month | capitalize}}</span></div><div class=day-header><div class=day ng-repeat="day in []|range:7"><span class=day-text>{{day | day}}</span></div></div><div class=month-container><zl-planning-day ng-repeat="day in planning.days" day=day events=planning._events absences=planning.absences drop-callback="planning.dropEvent({$data: $data, $event: $event, moment: day.date})" entities=planning.entitiesName ng-dblclick="planning.clickWeekEvent(day, $event)" holidays=planning.holidays></zl-planning-day><zl-planning-week-line ng-repeat="(week, events) in planning.multipleDaysEvents" events=events week=week one-day-events=planning.oneDayEvents[week] style="height: 20%; pointer-events: none"></zl-planning-week-line></div></div>'),e.put("/directives/planning-day-block/planning-day.html",'<div class=day-block ng-class="{\'empty-day\': dayCtrl.isDefined }" ng-click=planning.dayCallback({$day:dayCtrl.day.date})><div style=position:absolute;left:5px;top:5px; ng-if="dayCtrl.day.date.day() === 1">{{dayCtrl.day.date.week()}}</div><div class=day-number>{{ dayCtrl.day.date.date() }}</div><span ng-if=dayCtrl.isFerie class=holidays>férié</span> <span class=solidarityDay ng-if=dayCtrl.isSolidarityDay(day.date)>Journée de solidarité</span><div class=events-container><div ng-style="{\'background-color\': event.color}" class=month-event ng-repeat="event in dayCtrl.day.events |limitTo:5">{{event.title}}</div></div><div class=absents-container tooltip-append-to-body=true ng-if=dayCtrl.absents.length uib-tooltip-html=dayCtrl.absentsString>{{dayCtrl.absents.length}} absent(s)</div></div>'),e.put("/directives/planning-left-column/planning-left-column.html",'<div class="left-column planning-left-column" ng-switch=planningLeftColumn.mode><div class=planning-head></div><div class=left-body><div class=planning-2pc><span class=holidays ng-if="planningLeftColumn.isFerie && !planningLeftColumn.isSolidarityDay(planningLeftColumn.position) && (planningLeftColumn.mode === \'day\' || planningLeftColumn.mode === \'3days\')">Férié</span> <span class=solidarityDay style=margin-top:1px!important; ng-if="planningLeftColumn.isSolidarityDay(planningLeftColumn.position) && (planningLeftColumn.mode === \'day\' || planningLeftColumn.mode === \'3days\')">Journée de solidarité</span></div><div class=days-body ng-switch-when=week><div class="dayName row8 b-b animate" ng-repeat="day in planningLeftColumn.days track by $index" ng-class="{today: (planning.isToday(day.dayOfYear())), isFerie: planning.isFerie(day)}" ng-click=planning.dayCallback({$day:day})><h4>{{day | format:\'dddd\' | capitalize}}<br><small>{{day | format:\'ll\'}}<span class=holidays ng-if=planning.isFerie(day)>férié</span></small></h4><div ng-click=$event.stopPropagation() class=day-absence ng-if=planningLeftColumn._absences[$index].length><div class=absents-container ng-click="planning.showAbsencesCallBackWrapper(planningLeftColumn._absences, $index)">{{ planningLeftColumn._absences[$index].length }} absent(s)</div></div></div></div><div class=days-body ng-switch-when=day><div class="dayName dayNameDuplication row8 b-b animate" ng-if=planningLeftColumn.activateDuplicationButtons uib-popover-template="\'planningDayPopOver.html\'" popover-placement=right ng-repeat="tech in planningLeftColumn.column"><h4 class=techname>{{tech.fullname || \'\'}}</h4></div><div class="dayName row8 b-b animate" ng-if=!planningLeftColumn.activateDuplicationButtons uib-popover-template="\'planningDayPopOver.html\'" popover-placement=right ng-repeat="tech in planningLeftColumn.column"><h4 class=techname>{{tech.fullname || \'\'}}</h4></div></div></div><script type=text/ng-template id=planningDayPopOver.html><button ng-if="planningLeftColumn.activateDuplicationButtons" class="btn btn-primary" style="width: 100%; margin-bottom: 5px;" ng-click=\'planningLeftColumn.triggerDayEvent(tech)\'>Dupliquer la journée</button> <button ng-if="planningLeftColumn.activateDuplicationButtons" class="btn btn-primary" style="width: 100%;" ng-click=\'planningLeftColumn.triggerDayEvent(tech, true)\'>Déplacer la journée</button></script><div style=height:10px></div></div>'),e.put("/directives/planning-line/planning-line.html",'<div ng-style="{height: line.containerHeight}"><div style="position: absolute; height: 100%; width: 100%; z-index: 1" zl-planning-drag-drop zl-drop="line.dropEvent($data, $event, line)"><div class="b-b b-r all-day day-hour" ng-dblclick="line.clickEvent(n, $event, line)" ng-mouseleave=line.leaveAbsence() uib-tooltip={{line.tooltip}} tooltip-append-to-body=true tooltip-placement=top ng-style="{width: line.calcWidth(line.zoom)}" ng-repeat="n in [] | range:line.range" hour={{n}}><span class=half-hour></span></div></div><div ng-repeat="absence in line._absences track by $index" ng-mouseenter=line.hoverAbsence(absence) id={{absence._id}} class="{{absence.class}} absence {{absence._id}}" tooltip-append-to-body=true tooltip-placement=top uib-tooltip={{absence.tooltip}} data-html=true style="height: 100%" ng-style=absence.style></div><div ng-repeat="event in line._events" zl-planning-drag-drop ng-click="planning.eventCallback({\'event\':event})" zl-drag=event ng-style="{ height: event.style.height, top: event.style.top, width: event.style.totalWidth, left: event.pre > 0 ? line.preEvent[event.id].style.left : event.style.left }" style="position: absolute; z-index: 3; display: flex; flex-flow: row nowrap"><div ng-if="event.pre > 0" ng-style="{width: line.preEvent[event.id].style.width, \'background\': line.preEvent[event.id].style[\'background\']}" style="display: inline-block; position: relative; height: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.preEvent[event.id].tooltip}}><div class=title-container><span><i style="height: 100%; font-size: 1.2em;" class="mdi mdi-car"></i></span></div></div><div class=event style="display: inline-block; position: relative; height: 100%;" data-context-menu=/templates/planning-context-menu.html tooltip-append-to-body=true tooltip-placement="{{event.tooltipTemplate? \'auto\': \'top\'}}" ng-attr-uib-tooltip="{{!event.tooltipTemplate ? event.tooltip : undefined}}" ng-attr-uib-tooltip-template="{{\'\' + event.tooltipTemplate}}" tooltip-class=planning-event-tooltip ng-style="{ width: event.style.width, background: event.style[\'background-color\'], \'background-image\': event.style[\'background-image\'], color: event.style.color, \'border-left\': event.pre > 0 ? \'none\': \'\' }"><div class=event-line-container style><div class=event-line ng-style="{\'background-color\': event.color}" ng-if=!event.continuedBefore></div></div><div class=title-container><span>{{event.title}}</span></div></div><div ng-if="event.post > 0" ng-style="{width: line.postEvent[event.id].style.width, \'background\': line.postEvent[event.id].style[\'background\']}" style="display: inline-block; position: relative; height: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.postEvent[event.id].tooltip}}><div class=title-container><span><i style="height: 100%; font-size: 1.2em;" class="mdi mdi-car"></i></span></div></div></div><div ng-repeat="pause in line.breaks track by $index" class=planning-pause-element style="height: 100%;" ng-style=pause.style></div></div>'),e.put("/directives/planning-vertical-line/planning-vertical-line.html",'<div ng-style="{height: line.containerHeight}" data-context-menu=/templates/planning-line-context-menu.html><div ng-if=!line._absences style="position: absolute; height: 100%; width: 100%; z-index: 1" ng-mouseleave=line.leaveLine()><div ng-repeat="n in [] | range: line.range" style="display: flex; z-index: 1"><div style="display: flex; align-items: flex-end;"><span class=hour-text>{{n + 1 + line.dayStart.h}}</span></div><div style="width: 100%;" class="b-b b-r all-day" ng-style="{height: line.calcWidth(line.zoom)}" ng-dblclick="line.clickEvent(n, $event, line.day)" hour="{{n + line.dayStart.h}}" zl-planning-drag-drop zl-drop="line.dropEvent($data, $event, line.day)"></div></div></div><div ng-if=line._absences tooltip-append-to-body=true tooltip-placement=top tooltip-classes=absence-tooltip uib-tooltip={{line._absences[0].tooltip}} style="position: absolute; height: 100%; width: 100%; z-index: 1" ng-mouseleave=line.leaveLine()><div ng-repeat="n in [] | range: line.range" style="display: flex; z-index: 1"><div style="display: flex; align-items: flex-end;"><span class=hour-text>{{n + 1 + line.dayStart.h}}</span></div><div style="width: 100%;" class="b-b b-r all-day" ng-style="{height: line.calcWidth(line.zoom)}" ng-dblclick="line.clickEvent(n, $event, line.day)" hour="{{n + line.dayStart.h}}" zl-planning-drag-drop zl-drop="line.dropEvent($data, $event, line.day)"></div></div></div><div ng-repeat="event in line._events" zl-planning-drag-drop ng-click="planning.eventCallback({\'event\':event})" zl-drag=event ng-style="{ width: event.style.height, right: event.style.top, height: event.pre > 0 ? line.preEvent[event.id].style.totalWidth : event.style.width, top: event.pre > 0 ? line.preEvent[event.id].style.left : event.style.left }" style="position: absolute; z-index: 2;"><div ng-if="event.pre > 0" ng-style="{height: line.preEvent[event.id].style.width, \'background\': line.preEvent[event.id].style[\'background\']}" style="display: flex; position: relative; width: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.preEvent[event.id].tooltip}}><div class=title-container><span><i style="width: 100%; font-size: 1.2em;" class="mdi mdi-car"></i></span></div></div><div class=event style="display: flex; position: relative; width: 100%;" tooltip-append-to-body=true tooltip-placement="{{event.tooltipTemplate? \'auto\': \'top\'}}" ng-attr-uib-tooltip="{{!event.tooltipTemplate ? event.tooltip : undefined}}" ng-attr-uib-tooltip-template="{{\'\' + event.tooltipTemplate}}" tooltip-class=planning-event-tooltip data-context-menu=/templates/planning-context-menu.html ng-style="{ height: event.style.width, overflow: \'hidden\', \'background-image\': event.style[\'background-image\'], background: event.style[\'background-color\'], color: event.style.color, \'border-left\': event.pre > 0 ? \'none\': \'\' }"><div class=event-line-container style><div class=event-line ng-style="{\'background-color\': event.color}"></div></div><div class=title-container><span>{{event.title}}</span></div></div><div ng-if="event.post > 0" ng-style="{height: line.postEvent[event.id].style.width, \'background\': line.postEvent[event.id].style[\'background\']}" style="display: inline-block; position: relative; width: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.postEvent[event.id].tooltip}}><div class=title-container><span><i style="width: 100%; font-size: 1.2em;" class="mdi mdi-car"></i></span></div></div></div><div ng-repeat="pause in line.breaks track by $index" class=planning-pause-element style="width: 95%; left: 5%;" ng-style=pause.style></div><div ng-repeat="absence in line._absences track by $index" id={{absence._id}} class="{{absence.class}} absence {{absence._id}}" style="width: 95%; left: 5%;" ng-style=absence.style></div></div>'),e.put("/directives/planning-top-row/planning-top-row.html",'<div class=planning-top-row><div ng-repeat="hour in planningTopRow.hours" class=day-hour ng-style="{width: planningTopRow.calcWidth(planningTopRow.zoom), margin: planningTopRow.calcMargin(planningTopRow.zoom, $index)}"><h4>{{hour | format:\'HH:mm\'}}</h4></div></div>'),e.put("/directives/planning-week-line/planning-week-line.html","<div class=week-line ng-class=\"'week-' + line.week\" style=padding-top:20px;><div class=single-day-events style=\"height:40%; position:relative;\"><div zl-planning-drag-drop zl-drag=ev ng-repeat=\"ev in line.oneDayEvents\" ng-style=\"{'top': ev.style.top, 'height': ev.style.height, 'background-color': ev.style['background-color'], 'color' : ev.style.color, 'width': ev.style.width, 'left': ev.style.left}\" style=\"position:absolute;border: 1px solid black;pointer-events: auto; overflow: hidden;\" ng-click=\"planning.weekEventCallback({event: ev})\" tooltip-append-to-body=true tooltip-placement=\"{{ev.tooltipTemplate? 'auto': 'top'}}\" ng-attr-uib-tooltip=\"{{!ev.tooltipTemplate ? ev.tooltip : undefined}}\" ng-attr-uib-tooltip-template=\"{{'' + ev.tooltipTemplate}}\" tooltip-class=planning-event-tooltip class=single-day-event><div class=event-line-container><div class=event-line ng-style=\"{'background-color': ev.color}\" ng-if=!ev.continuedBefore></div></div><div class=single-day-event-title data-context-menu=/templates/planning-context-menu.html><span>{{ev.title}}</span></div></div></div><div class=multiple-days-events style=\"height:40%; position: relative;\"><div class=multiple-day-event ng-repeat=\"event in line.displayedEvents\" style=\"position: absolute; border: 1px solid black;pointer-events: auto; overflow: hidden;\" zl-planning-drag-drop zl-drag=event ng-click=\"planning.weekEventCallback({event: event})\" tooltip-append-to-body=true tooltip-placement=\"{{event.tooltipTemplate? 'auto': 'top'}}\" ng-attr-uib-tooltip=\"{{!event.tooltipTemplate ? event.tooltip : undefined}}\" ng-attr-uib-tooltip-template=\"{{'' + event.tooltipTemplate}}\" tooltip-class=planning-event-tooltip ng-style=\"{'top': event.style.top, 'height': event.style.height, 'background-color': event.style['background-color'], 'color' : event.style.color, 'width': event.style.width, 'left': event.style.left}\"><div class=event-line-container><div class=event-line ng-style=\"{'background-color': event.color}\" ng-if=!event.continuedBefore></div></div><div class=multiple-day-event-title data-context-menu=/templates/planning-context-menu.html><span>{{event.title}}</span></div></div></div></div>");
}]);
//# sourceMappingURL=planning.js.map
