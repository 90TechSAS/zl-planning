{"version":3,"sources":["index.js","services/absences.service.js","services/color.service.js","services/configurationProvider.js","services/pause.service.js","services/position.service.js","filters/dayFilter.js","filters/momentFilter.js","filters/range.js","filters/strFilter.js","directives/drag-drop/drag-drop.directive.js","directives/horizontal-scroll/horizontal-scroll.js","directives/planning/planning.js","directives/planning-left-column/planning-left-column.js","directives/planning-day-block/planning-day.js","directives/planning-line/planning-line.js","directives/planning-vertical-line/planning-vertical-line.js","directives/planning-top-row/planning-top-row.js","directives/planning-week-line/planning-week-line.js","template.js"],"names":["angular","module","window","_","moment","AbsenceService","parseAbsences","absences","interval","Array","isArray","Error","parsed","filter","abs","range","start","end","overlaps","map","absence","isBefore","copy","isAfter","mergeRanges","_x","_again","ranges","r","index","Object","assign","any","range1","range2","reduced","reduce","acc","value","arr","next","toDate","push","min","max","undefined","self","this","extend","service","ColorService","getLuminance","c","g","b","rgbRegex","test","exec","parseInt","color","substring","rgb","luma","$inject","provider","BASE_SIZE","MAX_PARALLEL","strings","nothing_to_show","DAYS","parallelText","setParallelText","text","setBaseSize","size","setMaxParallel","number","setString","key","setDays","$get","absentTechnicianCallback","callback","PauseService","generateGradient","event","direction","parsePause","pauses","pause","pauseRange","pauseDuration","diff","percentage","totalDuration","before","totalRange","subtract","length","endPercentage","startPercentage","v","style","pauseColor","invertColor","mapped","hex","indexOf","slice","toString","padZero","str","len","zeros","join","PositionService","overlap","lines","maxParallelEvents","toRemove","doublecheck","pre","i","depth","each","elt","eltRange","day","line","eventList","technician","eventClone","cloneDeep","isNaN","time","format","charAt","toUpperCase","RangeFilter","operation","input","total","planningConfiguration","val","directive","controller","scope","controllerAs","bindToController","zlDrag","zlDrop","link","element","dragImage","document","createElement","el","addEventListener","e","preventDefault","attributes","draggable","height","clientHeight","zIndex","position","left","bottom","innerHTML","children","float","backgroundColor","width","clientWidth","Math","dataTransfer","effectAllowed","body","appendChild","setDragImage","querySelectorAll","remove","setData","JSON","stringify","dragDropCtrl","classList","add","stopPropagation","target","$apply","$data","parse","getData","$event","ScrollHorizontalDirective","$timeout","restrict","scrollLeft","bind","wheelDelta","addClass","offsetWidth","PlanningController","$scope","init","zoom","allowedDays","usableDays","sort","daysList","d","weekday","_dayStart","parseTime","dayStart","_dayEnd","dayEnd","h","sortedEvents","mode","_events","flatten","events","split","groupBy","addMissingDays","dayField","mapValues","eventsByTechnician","addMissingEntities","entities","keys","groupedEvents","startOf","unix","k","result","date","hour","minute","m","second","stop","days","j","isEmpty","includes","found","find","group","obj","sortBy","firstDay","hours","minutes","seconds","month","decallage","isoWeekday","oneDayEvents","dayOfYear","floor","multipleDaysEvents","splitByWeeks","endWeek","endOf","isoWeek","startWeek","isoWeeksInYear","weekInMonth","unshift","times","daysInMonth","n","displayedDaysCount","first_event","startNextDay","endThisDay","continuedAfter","second_event","continuedBefore","concat","st","year","firstEvent","secondEvent","some","isBetween","startingDay","newDate","a","dateA","dateFromString","dateB","getEvents","isToday","week","isInDayRange","currentTimeToPixels","totalMinutes","isCurrent","isSame","clickCallbackWrapper","opts","mom","entity","Date","clickCallback","$moment","$entity","clickWeekEvent","dropEvent","config","doy","dropCallback","dateSplitted","$onInit","$watchCollection","PlanningDirective","templateUrl","entitiesPauses","eventCallback","dayCallback","weekEventCallback","action","PlanningLeftColumnController","forEach","column","PlanningDayController","data","absents","isDefined","array","hasOverlap","within","absentsString","PlanningDayDirective","replace","dayCtrl","PlanningLineController","extractMinutesFromEvent","contains","offsetX","getAttribute","checkAbsence","$hour","$minutes","clickEvent","currentId","preEvent","postEvent","breaks","SECONDS_BY_DAY","SLIDER_WIDTH","valueOf","toremove","difference","id","title","tooltip","top","round","s","totalWidth","text-align","background","border-top","border-bottom","border-left","generatePostEvent","post","safeParse","get","createBreaks","calcWidth","compact","p","name","_absences","postPercentage","arguments","newValue","oldValue","log","string","PlanningLineDirective","$filter","offsetY","AVAILABLE_SPACE","calculateContainerHeight","containerHeight","topRowDirective","PlanningTopRowController","calcMargin","half","$watchGroup","displayedEvents","positioning","setStyle","calculateLeft","calculateWidth","ceil","run","$templateCache","put"],"mappings":"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","file":"planning.js","sourcesContent":["'use strict';\n\n;(function (angular) {\n  'use strict';\n\n  angular.module('90Tech.planning', ['pikaday', 'zlContextMenu']);\n})(window.angular);","'use strict';\n\n;(function (angular, _, moment) {\n  'use strict';\n  angular.module('90Tech.planning').service('AbsenceService', AbsenceService);\n\n  function AbsenceService() {\n    var self = this;\n    _.extend(self, {\n      // Public Attributes\n      // Public Methods\n      parseAbsences: parseAbsences\n    });\n\n    function parseAbsences(absences, interval) {\n      if (!Array.isArray(interval)) {\n        throw new Error('Invalid interval');\n      }\n      var parsed = absences.filter(function (abs) {\n        return moment.range(abs.start, abs.end).overlaps(moment.range(interval[0], interval[1]));\n      }).map(function (absence) {\n        if (moment(absence.start).isBefore(moment(angular.copy(interval[0])))) {\n          absence.start = interval[0];\n        }\n        if (moment(absence.end).isAfter(moment(angular.copy(interval[1])))) {\n          absence.end = interval[1];\n        }\n        return absence;\n      });\n\n      return mergeRanges(parsed);\n    }\n\n    function mergeRanges(_x) {\n      var _again = true;\n\n      _function: while (_again) {\n        var ranges = _x;\n        _again = false;\n\n        var copy = ranges.map(function (r, index) {\n          r.index = index;\n          return Object.assign({}, r, { index: index });\n        });\n        // Check if any ranges overlaps\n        // If none overlap, return array\n        if (!_.any(copy, function (range1) {\n          return _.any(copy, function (range2) {\n            if (range1.index === range2.index) {\n              return false;\n            }\n            return overlaps(range1, range2);\n          });\n        })) {\n          return ranges;\n        }\n        var reduced = ranges.reduce(function (acc, value, index, arr) {\n          var next = arr[index + 1];\n          if (!next || !value) {\n            return acc;\n          }\n          if (overlaps({\n            start: moment(angular.copy(value.start)).toDate(),\n            end: moment(angular.copy(value.end)).toDate()\n          }, {\n            start: moment(angular.copy(next.start)).toDate(),\n            end: moment(angular.copy(next.end)).toDate()\n          })) {\n            acc.push({\n              start: moment.min(moment(angular.copy(value.start)), moment(angular.copy(next.start))),\n              end: moment.max(moment(angular.copy(value.end)), moment(angular.copy(next.end)))\n            });\n          }\n          return acc;\n        }, []);\n\n        _x = reduced;\n        _again = true;\n        copy = reduced = undefined;\n        continue _function;\n      }\n    }\n\n    function overlaps(range1, range2) {\n      return moment.range(range1.start, range1.end).overlaps(moment.range(range2.start, range2.end));\n    }\n  }\n})(window.angular, window._, window.moment);","'use strict';\n\n;(function (angular, _, moment) {\n  'use strict';\n\n  angular.module('90Tech.planning').service('ColorService', ColorService);\n\n  ColorService.$inject = [];\n\n  function ColorService() {\n    var self = this;\n\n    _.extend(self, {\n      getLuminance: getLuminance\n    });\n\n    /**\n     * return the luminance of a color : > 200 is black\n     * @param c Color\n     * @returns {number}\n     */\n    function getLuminance(c) {\n      c = c || '#ffffff';\n      var r, g, b;\n      var rgbRegex = /rgb\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)/;\n      if (rgbRegex.test(c)) {\n        var exec = rgbRegex.exec(c);\n        r = parseInt(exec[1]);\n        g = parseInt(exec[2]);\n        b = parseInt(exec[3]);\n      } else {\n        var color = c.substring(1); // strip #\n        var rgb = parseInt(color, 16); // convert rrggbb to decimal\n        r = rgb >> 16 & 0xff; // extract red\n        g = rgb >> 8 & 0xff; // extract green\n        b = rgb >> 0 & 0xff; // extract blue\n      }\n\n      var luma = 0.2126 * r + 0.7152 * g + 0.0722 * b; // per ITU-R BT.709\n      // luma > 200 : black\n      return luma;\n    }\n  }\n})(window.angular, window._, window.moment);","'use strict';\n\n;(function (angular) {\n  'use strict';\n  angular.module('90Tech.planning').provider('planningConfiguration', function () {\n    var self = this;\n\n    self.BASE_SIZE = 10;\n    self.MAX_PARALLEL = 3;\n    self.strings = {\n      nothing_to_show: 'Rien à afficher'\n    };\n\n    self.DAYS = [0, 1, 2, 3, 4, 5, 6];\n\n    self.parallelText = 'parallel items';\n\n    this.setParallelText = function (text) {\n      self.parallelText = '' + text;\n    };\n\n    this.setBaseSize = function (size) {\n      self.BASE_SIZE = size;\n    };\n    this.setMaxParallel = function (number) {\n      self.MAX_PARALLEL = number;\n    };\n\n    this.setString = function (key, value) {\n      self.strings[key] = value;\n    };\n\n    this.setDays = function (value) {\n      self.DAYS = value;\n    };\n\n    this.$get = [function () {\n      return {\n        strings: self.strings,\n        BASE_SIZE: self.BASE_SIZE,\n        MAX_PARALLEL: self.MAX_PARALLEL,\n        parallelText: self.parallelText,\n        DAYS: self.DAYS,\n        absentTechnicianCallback: function absentTechnicianCallback(callback) {\n          callback();\n        }\n      };\n    }];\n  });\n})(window.angular);","'use strict';\n\n;(function (angular, _, moment) {\n  'use strict';\n  angular.module('90Tech.planning').service('PauseService', PauseService);\n\n  PauseService.$inject = ['ColorService'];\n\n  function PauseService(ColorService) {\n    var self = this;\n\n    _.extend(self, {\n      // Public Attributes\n      // Public Methods\n      generateGradient: generateGradient\n    });\n\n    function generateGradient(event, direction) {\n      var color = event.style['background-color'];\n      var pauseColor = invertColor(color);\n      var start = event.start;\n      var end = event.end;\n      var totalRange = moment.range(start, end);\n      var totalDuration = totalRange.diff('milliseconds');\n\n      function parsePause(pauses) {\n        return _.map(pauses, function (pause) {\n          var start = event.start.isAfter(pause.start) ? event.start : pause.start;\n          var end = event.end.isBefore(pause.end) ? event.end : pause.end;\n          var pauseRange = moment.range(start, end);\n          var pauseDuration = pauseRange.diff('milliseconds');\n          var percentage = pauseDuration / totalDuration * 100;\n          var before = totalRange.subtract(pauseRange);\n          if (!before.length) {\n            return { range: pauseRange, endPercentage: 100, startPercentage: 0 };\n          }\n          var v = (before[0].diff('milliseconds') || totalDuration) / totalDuration * 100;\n          return { range: pauseRange, endPercentage: percentage + v, startPercentage: v };\n        });\n      }\n\n      var mapped = parsePause(event.pauses);\n\n      var reduced = _.reduce(mapped, function (acc, range) {\n        return acc + ', ' + color + ' ' + range.startPercentage + '%, ' + pauseColor + ' ' + range.startPercentage + '%, ' + pauseColor + ' ' + range.endPercentage + '%, ' + color + ' ' + range.endPercentage + '%';\n      }, 'linear-gradient(' + direction + ', ' + color);\n\n      reduced += ', ' + color + ' 100%)';\n      return reduced;\n    }\n\n    function invertColor(hex) {\n      if (hex.indexOf('#') === 0) {\n        hex = hex.slice(1);\n      }\n      // convert 3-digit hex to 6-digits.\n      if (hex.length === 3) {\n        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n      }\n      if (hex.length !== 6) {\n        throw new Error('Invalid HEX color.');\n      }\n      // invert color components\n      var r = (255 - parseInt(hex.slice(0, 2), 16)).toString(16),\n          g = (255 - parseInt(hex.slice(2, 4), 16)).toString(16),\n          b = (255 - parseInt(hex.slice(4, 6), 16)).toString(16);\n      // pad each with zeros and return\n      return '#' + padZero(r) + padZero(g) + padZero(b);\n    }\n\n    function padZero(str, len) {\n      len = len || 2;\n      var zeros = new Array(len).join('0');\n      return (zeros + str).slice(-len);\n    }\n  }\n})(window.angular, window._, window.moment);","'use strict';\n\n;(function (angular, _, moment) {\n  'use strict';\n\n  angular.module('90Tech.planning').service('PositionService', PositionService);\n\n  PositionService.$inject = [];\n\n  function PositionService() {\n    var self = this;\n\n    _.extend(self, {\n      // Public Methods\n      overlap: overlap\n    });\n\n    /**\n     * Check if event overlap any events in line, merge if parallel items is over maxParallelEvents, and push event in toRemove\n     * @param lines Arrays, containing events example : [[event, event][event,event][event]]\n     * @param event Event\n     * @param maxParallelEvents Int, maximum parallelEvents\n     * @param toRemove Array containing event which have been integrated/merged with another event\n     * @param doublecheck Boolean If true, check if day isn't same between two events (useful for monthly view where hours doesn't overlap on same day)\n     */\n    function overlap(lines, event, maxParallelEvents, toRemove, doublecheck) {\n      var range = event.pre > 0 ? moment.range(moment(event.start).subtract(event.pre, 'minutes'), moment(event.end)) : event.range;\n      for (var i = 0; i < lines.length; i++) {\n        if (event.depth > maxParallelEvents) {\n          var overlap = false;\n          _.each(lines[maxParallelEvents], function (elt) {\n\n            var eltRange = elt.pre > 0 ? moment.range(moment(elt.start).subtract(elt.pre, 'minutes'), moment(elt.end)) : elt.range;\n\n            overlap = range.overlaps(eltRange);\n            if (!overlap && doublecheck) {\n              overlap = event.start.day() === elt.start.day() || event.start.day() === elt.end.day() || event.end.day() === elt.start.day() || event.end.day() === elt.end.day();\n            }\n            if (overlap) {\n              elt.start = moment.min(event.start, elt.start); // set start to minimum of 2 overlapping event\n              elt.end = moment.max(event.end, elt.end); // set end to maximum of 2 overlapping event\n              elt.range = moment.range(elt.start, elt.end); // Update range\n              elt.line = maxParallelEvents;\n              elt.eventList.push(event);\n              if (elt.technician !== event.technician) {\n                // Technician isn't the same, hide it\n                elt.technician = '';\n                event.technician = '';\n              }\n            }\n          });\n          if (overlap) {\n            toRemove.push(event);\n            break;\n          }\n          event.depth = maxParallelEvents;\n          event.line = maxParallelEvents;\n          if (!event.eventList) {\n            var eventClone = _.cloneDeep(event);\n            event.eventList = [eventClone];\n          }\n          lines[maxParallelEvents].push(event);\n          break;\n        }\n        if (!lines[i].length) {\n          lines[i].push(event);\n          event.line = i;\n          break;\n        }\n        if (_.filter(lines[i], function (elt) {\n          // if any event in lines[i] overlap\n          var eltRange = elt.pre > 0 ? moment.range(moment(elt.start).subtract(elt.pre, 'minutes'), moment(elt.end)) : elt.range;\n          overlap = range.overlaps(eltRange);\n          if (!overlap && doublecheck) {\n            overlap = event.start.day() === elt.start.day() || event.start.day() === elt.end.day() || event.end.day() === elt.start.day() || event.end.day() === elt.end.day();\n          }\n          if (overlap) {\n            elt.depth += 1;\n            return true;\n          }\n        }).length) {\n          event.depth += 1;\n          if (!lines[i + 1]) {\n            // if next line is doesn't exist, add one\n            lines[i + 1] = [];\n          }\n        } else {\n          lines[i].push(event);\n          event.line = i;\n          break;\n        }\n      }\n    }\n  }\n})(window.angular, window._, window.moment);","'use strict';\n\n;(function (angular) {\n  'use strict';\n  angular.module('90Tech.planning').filter('day', [function () {\n    return function (day) {\n      if (day === undefined || day === null || isNaN(day) || parseInt(day) > 6) return '';\n      return ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'][day];\n    };\n  }]);\n})(window.angular);","'use strict';\n\n;(function (angular) {\n  'use strict';\n\n  angular.module('90Tech.planning').filter('format', function () {\n    return function (time, format) {\n      return time.format(format);\n    };\n  }).filter('capitalize', function () {\n    return function (str) {\n      if (!str) return '';\n      return str.charAt(0).toUpperCase() + str.slice(1);\n    };\n  });\n})(window.angular);","/**\n * WebApp Agenda\n * http://docs.pluginit.fr/agenda\n *\n * Copyright 2014 PluginIT\n * Non permissive commercial License.\n */\n\n'use strict';\n\n;(function (angular) {\n  'use strict';\n\n  angular.module('90Tech.planning').filter('range', RangeFilter);\n\n  /**\n   * Class Range for emulate a \"for\" loop\n   * @class RangeFilter\n   * @constructor\n   */\n  function RangeFilter() {\n    /**\n     * Return decimal values arrays at wished size\n     * @param input\n     * @param total\n     * @returns {*}\n     */\n    var operation = function operation(input, total) {\n      // We parse just in case\n      total = parseInt(total);\n\n      // We're adding at empty array the current value for the loop\n      for (var i = 0; i < total; i++) {\n        input.push(i);\n      }\n\n      // We return the array finally\n      return input;\n    };\n\n    /**\n     * Return callback to execute RangeFilter\n     */\n    return operation;\n  }\n})(window.angular);","'use strict';\n\n;(function (angular) {\n  'use strict';\n  angular.module('90Tech.planning').filter('strPlanning', ['planningConfiguration', function (planningConfiguration) {\n    return function (val) {\n      return planningConfiguration.strings[val];\n    };\n  }]);\n})(window.angular);","'use strict';\n\n;(function (angular) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlPlanningDragDrop', function () {\n    return {\n      controller: function controller() {},\n      scope: {},\n      controllerAs: 'dragDropCtrl',\n      bindToController: {\n        zlDrag: '=',\n        zlDrop: '&'\n      },\n      link: function link(scope, element) {\n        var dragImage = document.createElement('div');\n        var el = element[0];\n        window.addEventListener('dragover', function (e) {\n          e.preventDefault();\n        }, false);\n        window.addEventListener('drop', function (e) {\n          e.preventDefault();\n        }, false);\n\n        if (el.attributes['zl-drag']) {\n          el.draggable = true;\n\n          el.addEventListener('dragstart', function (e) {\n            dragImage.style.height = el.clientHeight + 'px';\n            dragImage.style.zIndex = '1000';\n            dragImage.style.position = 'relative';\n            dragImage.style.left = '-10000px';\n            dragImage.style.bottom = '-10000px;';\n            dragImage.innerHTML = el.innerHTML;\n            if (el.children.length > 1) {\n              dragImage.children[0].style.float = 'left';\n              dragImage.style.backgroundColor = el.children[1].style.backgroundColor;\n              dragImage.style.width = el.clientWidth + 'px';\n            } else {\n              dragImage.style.width = Math.min(el.clientWidth, 200) + 'px';\n              dragImage.style.backgroundColor = el.children[0].style.backgroundColor;\n            }\n            e.dataTransfer.effectAllowed = 'move';\n\n            document.body.appendChild(dragImage);\n\n            if (e.dataTransfer.setDragImage) {\n              e.dataTransfer.setDragImage(dragImage, 0, 0);\n            }\n            // Remove tooltips on drag\n            _.each(document.querySelectorAll('.planning-event-tooltip'), function (elt) {\n              elt.remove();\n            });\n            e.dataTransfer.setData('Text', JSON.stringify(scope.dragDropCtrl.zlDrag));\n            this.classList.add('drag');\n            return false;\n          }, false);\n\n          el.addEventListener('dragend', function (e) {\n            dragImage.remove();\n            this.classList.remove('drag');\n            return false;\n          }, false);\n        }\n        if (el.attributes['zl-drop']) {\n          el.addEventListener('drop', function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if (e.stopPropagation) e.stopPropagation();\n            e.target.classList.remove('over');\n            this.classList.remove('over');\n            scope.$apply(function () {\n              scope.dragDropCtrl.zlDrop({ $data: JSON.parse(e.dataTransfer.getData('Text')), $event: e });\n            });\n            return false;\n          }, false);\n\n          el.addEventListener('dragenter', function (e) {\n            e.target.classList.add('over');\n            return false;\n          }, false);\n\n          el.addEventListener('dragleave', function (e) {\n            e.target.classList.remove('over');\n            return false;\n          }, false);\n        }\n      }\n    };\n  });\n})(window.angular);","/**\n * @author Toolito <toolito@90tech.fr>\n * @copyright 2015 Zenlabs SAS. All rights reserved.\n *\n * TODO Export in separate module ?\n */\n'use strict';\n\n;(function (angular) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlHorizontalScroll', ScrollHorizontalDirective);\n\n  ScrollHorizontalDirective.$inject = ['$timeout'];\n\n  function ScrollHorizontalDirective($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        scrollLeft: '='\n      },\n      link: function link(scope, element, attributes) {\n        // eslint-disable-line\n        element.bind('mousewheel', function (e) {\n          element[0].scrollLeft -= e.wheelDelta / 3;\n        });\n        element.addClass('slider');\n\n        if (scope.scrollLeft) {}\n\n        $timeout(function () {\n          // Needs a delay since the offsetWidth we obtain first is off by ~300px\n          element[0].scrollLeft = scope.scrollLeft - element[0].offsetWidth / 2;\n        }, 100);\n      }\n    };\n  }\n})(window.angular);","'use strict';\n\n;(function (angular, moment, _) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlPlanning', PlanningDirective);\n\n  PlanningController.$inject = ['$scope', 'planningConfiguration'];\n\n  function PlanningController($scope, planningConfiguration) {\n    var BASE_SIZE = planningConfiguration.BASE_SIZE;\n\n    var self = this;\n\n    self.$onInit = function () {\n      _.extend(self, {\n        //  sortedEvents       : sortedEvents,\n        isToday: isToday,\n        currentTimeToPixels: currentTimeToPixels,\n        isCurrent: isCurrent,\n        clickCallbackWrapper: clickCallbackWrapper,\n        isInDayRange: isInDayRange,\n        keys: keys,\n        getEvents: getEvents,\n        clickWeekEvent: clickWeekEvent,\n        dropEvent: dropEvent\n      });\n\n      init();\n    };\n\n    function init() {\n      self.zoom = parseInt(self.zoom);\n      self.allowedDays = self.usableDays.sort() || planningConfiguration.DAYS;\n      self.daysList = self.allowedDays.map(function (i) {\n        var d = moment(self.position);\n        d.weekday(i);\n        return d;\n      });\n\n      if (!self.zoom || self.zoom < 1) {\n        self.zoom = 1;\n      }\n\n      self._dayStart = self.dayStart ? parseTime(self.dayStart) : parseTime(0);\n      self._dayEnd = self.dayEnd ? parseTime(self.dayEnd) : parseTime(24);\n      self.width = self.zoom * (parseInt(self._dayEnd.h) - parseInt(self._dayStart.h) + 1) * BASE_SIZE + 'px';\n      self.sortedEvents = undefined;\n      switch (self.mode) {\n        case 'week':\n          self._events = _.flatten(_.map(self.events, split));\n          self._events = filter(self._events);\n\n          self.sortedEvents = _.groupBy(self._events, function (e) {\n            return e.start.format('DD/MM/YYYY');\n          });\n          addMissingDays(self.sortedEvents);\n          break;\n        case 'day':\n        case 'week-advanced':\n          self._events = _.flatten(_.map(self.events, split));\n          self._events = filter(self._events);\n          self.sortedEvents = _.groupBy(self._events, function (e) {\n            return e[self.dayField];\n          });\n          /* If we are in advanced week mode, we have a double grouping: first by technician, then by day of week */\n          if (self.mode === 'week-advanced') {\n            self.sortedEvents = _.mapValues(self.sortedEvents, function (eventsByTechnician) {\n              return _.groupBy(eventsByTechnician, function (e) {\n                return e.start.weekday();\n              });\n            });\n          }\n          addMissingEntities(self.sortedEvents);\n          break;\n        case '3day':\n          self._events = _.flatten(_.map(self.events, split));\n          self._events = filter(self._events);\n          self.sortedEvents = _.reduce(self.entities, function (acc, v) {\n            acc[v] = [];\n            return acc;\n          }, {});\n\n          var keys = _.keys(self.sortedEvents);\n          self.groupedEvents = _.map(_.groupBy(self._events, function (e) {\n            return moment(e.start).startOf('day').unix();\n          }), function (v, k) {\n            var result = {\n              key: k,\n              date: moment.unix(k).startOf('day').toDate(),\n              day: moment.unix(k).startOf('day').format('dddd DD MMMM'),\n              value: _.groupBy(v, function (e) {\n                return e.technician;\n              }),\n              absences: angular.copy(self.absences)\n            };\n            _.each(self.entities, function (e) {\n              if (!result.value[e]) {\n                result.value[e] = [];\n              }\n            });\n            return result;\n          });\n\n          var start = moment(self.position).hour(self._dayStart.h).minute(self._dayStart.m).second(0);\n          var stop = moment(self.position).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59);\n          var days = [{ start: angular.copy(start), end: angular.copy(stop) }];\n\n          var j = 0;\n          while (j < 2) {\n            stop.add(1, 'day');\n            var d = stop.day() - 1;\n            if (d < 0) {\n              d = 6;\n            }\n            if (_.isEmpty(self.allowedDays) || _.includes(self.allowedDays, d)) {\n              days.push({ start: angular.copy(stop).hour(self._dayStart.h).minute(self._dayStart.m).second(0), end: angular.copy(stop).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59) });\n              j++;\n            }\n          }\n\n          _.each(days, function (d) {\n            var date = \"\" + moment(d.start).startOf('day').unix();\n\n            var found = _.find(self.groupedEvents, function (group) {\n              return group.key === date;\n            });\n\n            if (!found) {\n              var obj = {\n                key: date,\n                date: moment(angular.copy(d.start)).startOf('day').toDate(),\n                day: moment(angular.copy(d.start)).startOf('day').format('dddd DD MMMM'),\n                value: {},\n                absences: angular.copy(self.absences)\n              };\n              _.each(_.keys(self.sortedEvents), function (k) {\n                obj.value[k] = [];\n              });\n              self.groupedEvents.push(obj);\n            }\n          });\n          self.groupedEvents = _.sortBy(self.groupedEvents, function (e) {\n            return e.key;\n          });\n          break;\n        case 'month':\n          var firstDay = moment(self.position).date(1).hours(0).minutes(0).seconds(0);\n          self.month = moment(self.position).date(1).hours(0).minutes(0).seconds(0).format('MMMM');\n          self.decallage = firstDay.isoWeekday() - 1; //\n\n          if (self.decallage < 0) {\n            self.decallage = 0;\n          }\n          self.oneDayEvents = _(self.events).filter(function (event) {\n            return event.start.dayOfYear() === event.end.dayOfYear() && event.start.month() === moment(self.position).month();\n          }).groupBy(function (event) {\n            return Math.floor((event.start.date() + self.decallage) / 7.01);\n          }) // 7.01 -> Fix issue when start day = 7 (sunday)\n          .value();\n          self.multipleDaysEvents = _(self.events).filter(function (event) {\n            return event.start.dayOfYear() !== event.end.dayOfYear();\n          }).map(splitByWeeks).flatten().groupBy(function (event) {\n            return Math.floor((event.start.date() + self.decallage) / 7.01); // 7.01 -> Fix issue when start day = 7 (sunday)\n          }).value();\n\n          var endWeek = moment(self.position).endOf('month').isoWeek();\n          var startWeek = moment(self.position).startOf('month').isoWeek();\n          // When switching years, last week of month can be 1\n          if (endWeek === 1) {\n            endWeek = moment(self.position).isoWeeksInYear() + 1;\n          }\n          var weekInMonth = endWeek - startWeek + 1;\n          for (var i = 0; i < weekInMonth; i++) {\n            if (self.multipleDaysEvents[i] === undefined) {\n              self.multipleDaysEvents[i] = [];\n            }\n          }\n          self.days = [];\n          // Add day from previous month\n          if (firstDay.isoWeekday() - 1 > 0) {\n            for (i = 0; i < firstDay.isoWeekday() - 1; i++) {\n              self.days.unshift({});\n            }\n          }\n          _.times(firstDay.daysInMonth(), function (n) {\n            var day = moment(firstDay).add(n, 'days');\n            self.days.push({ date: day, events: [] });\n          });\n\n          var displayedDaysCount = self.days.length > 35 ? 42 : 35;\n          while (self.days.length < displayedDaysCount) {\n            self.days.push({});\n          }\n          break;\n      }\n    }\n\n    function split(_x) {\n      var _again = true;\n\n      _function: while (_again) {\n        var event = _x;\n        _again = false;\n\n        // Event starts and ends the same day\n        event = angular.copy(event);\n\n        var start = moment(event.start).hour(self._dayStart.h).minute(self._dayStart.m).second(0);\n        var stop = moment(event.end).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59);\n        if (event.start.dayOfYear() === event.end.dayOfYear()) {\n          // reset the boundaries if they exceed the one fixed.\n          // And trim events that are entirely out of the boundaries\n          if (event.start.isBefore(start)) {\n            if (event.end.isBefore(start)) {\n              return [];\n            }\n            event.start = start;\n          }\n          if (event.end.isAfter(stop)) {\n            if (event.start.isAfter(stop)) {\n              return [];\n            }\n            event.end = stop;\n          }\n          return [event];\n        }\n        // Event is on several days.\n        // Build a first event that ends at the end of the first day\n        var first_event = angular.copy(event);\n        first_event.end = moment(event.start).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59);\n        if (event.start.isBefore(start)) {\n          first_event.start = start;\n        }\n\n        var startNextDay = moment(event.start).add(1, 'day').hour(self._dayStart.h).minute(self._dayStart.m);\n        var endThisDay = moment(event.start).hour(self._dayEnd.h).minute(self._dayEnd.m);\n        if (event.end.isBefore(startNextDay)) {\n          if (first_event.start.isAfter(endThisDay)) {\n            return [];\n          }\n          // Event finishes before start hour next day. No need to create another one\n          return [first_event];\n        }\n        first_event.continuedAfter = true;\n\n        // Build a second event that starts at the beginning of the following days.\n        // This event may end several days later. Recursion will handle it\n        var second_event = angular.copy(event);\n        second_event.start = moment(event.start).add(1, 'day').hour(self._dayStart.h).minute(self._dayStart.m);\n        second_event.continuedBefore = true;\n\n        if (event.start.isAfter(endThisDay)) {\n          // If the first event starts after curfew, don't add it\n          _x = second_event;\n          _again = true;\n          start = stop = first_event = startNextDay = endThisDay = second_event = undefined;\n          continue _function;\n        }\n\n        return [first_event].concat(split(second_event));\n      }\n    }\n\n    function splitByWeeks(event) {\n      if (event.start.isAfter(event.end)) {\n        var st = event.start;\n        event.start = event.end;\n        event.end = st;\n      }\n\n      if (event.start.year() < self.position.year() || event.start.month() < self.position.month()) {\n        // Event starts before our current month\n        if (event.end.year() < self.position.year() || event.end.month() < self.position.month()) {\n          // Event also ends before. Return nothing\n          return [];\n        }\n        // Set the beginning at the start of the month\n        event.start = moment(self.position).startOf('month');\n      }\n      if (event.end.month() > self.position.month() || event.end.year() !== self.position.year()) {\n        // Event ends after current month\n        if (event.start.month() > self.position.month()) {\n          return [];\n        }\n        event.end = moment(self.position).endOf('month');\n      }\n      // console.info(_.cloneDeep(event))\n      if (event.start.isoWeek() === event.end.isoWeek()) {\n        // If our event is on one week, we're all set\n        return [event];\n      }\n\n      // Split\n      var firstEvent = angular.copy(event);\n      var secondEvent = angular.copy(event);\n      // make it end on the same week\n      firstEvent.continuedAfter = true;\n      secondEvent.continuedBefore = true;\n      firstEvent.end = moment(firstEvent.start).endOf('week');\n      secondEvent.start.add(1, 'week').startOf('week');\n      // Recursion will handle potential split needed by second event\n      return [firstEvent].concat(splitByWeeks(secondEvent));\n    }\n\n    function filter(events) {\n      // remove event not in range (month, week, day)\n      return _.filter(events, function (e) {\n        var start, stop;\n        switch (self.mode) {\n          case 'week':\n          case 'week-advanced':\n            start = moment(self.position).weekday(0).hour(self._dayStart.h).minute(self._dayStart.m).second(0);\n            stop = moment(self.position).weekday(6).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59);\n            break;\n          case 'day':\n            start = moment(self.position).hour(self._dayStart.h).minute(self._dayStart.m).second(0);\n            stop = moment(self.position).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59);\n            break;\n          case '3day':\n            start = moment(self.position).hour(self._dayStart.h).minute(self._dayStart.m).second(0);\n            stop = moment(self.position).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59);\n            var days = [{ start: angular.copy(start), end: angular.copy(stop) }];\n\n            var i = 0;\n            while (i < 2) {\n              stop.add(1, 'day');\n              var d = stop.day() - 1;\n              if (d < 0) {\n                d = 6;\n              }\n              if (_.isEmpty(self.allowedDays) || _.includes(self.allowedDays, d)) {\n                days.push({ start: angular.copy(stop).hour(self._dayStart.h).minute(self._dayStart.m).second(0), end: angular.copy(stop).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59) });\n                i++;\n              }\n            }\n            return _.some(days, function (d) {\n              return e.start.isBetween(d.start, d.end) || e.end.isBetween(d.start, d.end);\n            });\n          case 'month':\n            start = moment(self.position).date(1).hour(self._dayStart.h).minute(self._dayStart.m).second(0);\n            stop = moment(self.position).weekday(moment(self.position).daysInMonth()).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59);\n            break;\n        }\n        return e.start.isBetween(start, stop) || e.end.isBetween(start, stop);\n      });\n    }\n\n    function addMissingDays(sortedEvents) {\n      sortedEvents = sortedEvents || {};\n      var startingDay = moment(self.position).weekday(0);\n      _.times(7, function (i) {\n        var newDate = moment(angular.copy(startingDay)).add(i, 'days').format('DD/MM/YYYY');\n        if (!sortedEvents[newDate]) {\n          sortedEvents[newDate] = [];\n        }\n      });\n    }\n\n    function addMissingEntities(sortedEvents) {\n      sortedEvents = sortedEvents || {};\n      _.each(self.entities, function (e) {\n        if (!sortedEvents[e]) {\n          sortedEvents[e] = [];\n        }\n      });\n    }\n\n    function parseTime(h) {\n      if (h >= 24) {\n        return { h: 23, m: 59 };\n      }\n      return { h: h, m: 0 };\n    }\n\n    function keys(sortedEvents) {\n      switch (self.mode) {\n        case 'week':\n          return Object.keys(sortedEvents).sort(function (a, b) {\n            var dateA = dateFromString(a);\n            var dateB = dateFromString(b);\n            return dateA - dateB;\n          });\n        case 'week-advanced':\n        case 'day':\n        case '3day':\n          return Object.keys(sortedEvents).sort();\n      }\n    }\n\n    function getEvents(key) {\n      return self.sortedEvents[key];\n    }\n\n    $scope.$watchCollection(function () {\n      return [self.events, self.entities, self.position, self.mode, self.dayStart, self.dayEnd, self.zoom, self.usableDays];\n    }, init);\n\n    function isToday(n) {\n      return self.position.week() === moment().week() && n === moment().dayOfYear();\n    }\n\n    function isInDayRange() {\n      return moment().hour() > parseInt(self._dayStart.h) && moment().hour() < parseInt(self._dayEnd.h);\n    }\n\n    function currentTimeToPixels() {\n      var totalMinutes = (moment().hour() - parseInt(self._dayStart ? self._dayStart.h : 0)) * 60 + moment().minutes();\n      return Math.floor(self.zoom * (BASE_SIZE * totalMinutes) / 60);\n    }\n\n    function isCurrent() {\n      return self.position.isSame(moment(), self.mode);\n    }\n\n    function clickCallbackWrapper(opts) {\n      var mom;\n      var entity;\n      switch (self.mode) {\n        case 'week':\n          var split = opts.d.split('/');\n          /**\n           * split[2] === year\n           * split[1] === month, we need to subtract 1 because momentJS months starts at 0\n           * split[0] === dayOfMonth\n           */\n          mom = moment(new Date(split[2], split[1] - 1, split[0], opts.h, opts.m));\n          break;\n        case '3day':\n        case 'day':\n          mom = moment(self.position).hour(opts.h).minute(opts.m);\n          entity = opts.entity;\n          break;\n        case 'week-advanced':\n          entity = opts.entity;\n          mom = moment(self.position).hour(opts.h).minute(opts.m).second(0).weekday(opts.d);\n          break;\n      }\n      self.clickCallback({ $moment: mom, $entity: entity });\n    }\n\n    function clickWeekEvent(day, $event) {\n      if (day.date) {\n        self.clickCallback({ $moment: day.date });\n      }\n    }\n\n    function dropEvent(config) {\n      var mom = config.moment;\n      if (!mom) {\n        switch (self.mode) {\n          case 'week':\n            var doy = moment(dateFromString(config.d)).dayOfYear();\n            mom = moment(self.position).hour(config.h).minute(config.m).second(0).dayOfYear(doy);\n            break;\n          case 'week-advanced':\n            mom = moment(self.position).hour(config.h).minute(config.m).second(0).weekday(config.d);\n            break;\n          case 'day':\n            mom = moment(self.position).hour(config.h).minute(config.m);\n            break;\n          case '3day':\n            mom = moment.unix(config.day).hour(config.h).minute(config.m);\n        }\n      }\n      var entity = _.includes(['week-advanced', 'day', '3day'], self.mode) ? config.entity : undefined;\n      self.dropCallback({ $moment: mom, $data: config.$data, $event: config.$event, $entity: entity });\n    }\n\n    function calculateAdvancedWeekContainerHeight() {\n      return parseInt(self.zoom) * Math.max(planningConfiguration.BASE_SIZE - 8, 1) + 'px';\n    }\n\n    function dateFromString(date) {\n      var dateSplitted = date.split('/');\n      return new Date(dateSplitted[2], dateSplitted[1] - 1, dateSplitted[0]);\n    }\n  }\n\n  function PlanningDirective() {\n    return {\n      restrict: 'E',\n      templateUrl: '/directives/planning/planning.html',\n      controller: PlanningController,\n      controllerAs: 'planning',\n      bindToController: {\n        zoom: '=',\n        events: '=',\n        entities: '=',\n        entitiesPauses: '=?',\n        absences: '=?',\n        position: '=',\n        mode: '=',\n        dayStart: '=',\n        dayEnd: '=',\n        dayField: '=',\n        eventCallback: '&',\n        dayCallback: '&',\n        clickCallback: '&',\n        weekEventCallback: '&',\n        dropCallback: '&',\n        usableDays: '=?',\n        action: '&?'\n      },\n      scope: {}\n    };\n  }\n})(window.angular, window.moment, window._);","'use strict';\n\n;(function (angular, moment, _) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlPlanningLeftColumn', PlanningDirective);\n\n  PlanningLeftColumnController.$inject = ['$scope'];\n\n  function PlanningLeftColumnController($scope) {\n    var self = this;\n\n    self.$onInit = function () {\n      $scope.$watchCollection(function () {\n        return [self.events, self.position, self.mode, self.dayStart, self.dayEnd, self.usableDays];\n      }, init);\n    };\n\n    function init() {\n      self.days = [];\n      self.allowedDays = self.usableDays;\n      if (self.mode === 'week') {\n        _.forEach(self.allowedDays, function (d) {\n          var day = moment(self.position);\n          day.weekday(d);\n          self.days.push(day);\n        });\n        self.days = _.sortBy(self.days, function (d) {\n          return moment(d).toDate();\n        });\n      } else if (self.mode === 'day' && self.dayField) {\n        self.column = Object.keys(self.events).sort();\n      }\n    }\n  }\n\n  function PlanningDirective() {\n    return {\n      restrict: 'E',\n      templateUrl: '/directives/planning-left-column/planning-left-column.html',\n      controller: PlanningLeftColumnController,\n      controllerAs: 'planningLeftColumn',\n      bindToController: {\n        events: '=',\n        position: '=',\n        mode: '=',\n        dayField: '=',\n        usableDays: '='\n      },\n      scope: true\n    };\n  }\n})(window.angular, window.moment, window._);","'use strict';\n\n;(function (angular, _, moment) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlPlanningDay', PlanningDayDirective);\n\n  PlanningDayController.$inject = [\n  // Angular\n  '$scope'\n  // Libs\n  // Managers\n  // Services\n  // Const\n  // Resolved\n  ];\n  function PlanningDayController(\n  // Angular\n  $scope\n  // Libs\n  // Managers\n  // Services\n  // Const\n  // Resolved\n  ) {\n    var self = this;\n\n    self.$onInit = function () {\n      _.extend(self, {\n        dropEvent: dropEvent,\n        absents: []\n      });\n\n      self.isDefined = self.day.events === undefined;\n      init();\n      $scope.$watchCollection([self.day, self.absences], function () {\n        if (self.day && self.day.date && self.absences && Object.keys(self.absences).length) {\n          self.absents = Object.keys(self.absences).reduce(function (acc, key) {\n            var array = self.absences[key];\n            var hasOverlap = _.any(array, function (absence) {\n              var range = moment.range(absence.start, absence.end);\n              return self.day.date.within(range);\n            });\n            if (hasOverlap) {\n              acc.push(key);\n            }\n            return acc;\n          }, []);\n          self.absentsString = '<div>' + self.absents.join('<br>') + '</div>';\n        } else {\n          self.absentsString = '';\n          self.absents = [];\n        }\n      });\n    };\n\n    function init() {}\n\n    function dropEvent(data, event) {\n      self.dropCallback({ $data: data, $event: event });\n    }\n  }\n\n  /**\n   *\n   */\n  function PlanningDayDirective() {\n    return {\n      restrict: 'E',\n      replace: true,\n      templateUrl: '/directives/planning-day-block/planning-day.html',\n      controller: PlanningDayController,\n      controllerAs: 'dayCtrl',\n      bindToController: {\n        day: '=',\n        events: '=',\n        clickCallback: '&',\n        dropCallback: '&',\n        absences: '=?'\n      },\n      scope: true,\n      link: function link(scope, element) {\n        var el = element[0];\n        window.addEventListener('dragover', function (e) {\n          e.preventDefault();\n        }, false);\n        window.addEventListener('drop', function (e) {\n          e.preventDefault();\n        }, false);\n        el.addEventListener('drop', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          if (e.stopPropagation) e.stopPropagation();\n          this.classList.remove('over');\n          scope.$apply(function () {\n            scope.dayCtrl.dropEvent(JSON.parse(e.dataTransfer.getData('Text')), e);\n          });\n          return false;\n        }, false);\n\n        el.addEventListener('dragenter', function (e) {\n          this.classList.add('over');\n          return false;\n        }, false);\n\n        el.addEventListener('dragleave', function (e) {\n          this.classList.remove('over');\n          return false;\n        }, false);\n      }\n    };\n  }\n})(window.angular, window._, window.moment);","'use strict';\n\n;(function (angular, _, moment) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlPlanningLine', PlanningLineDirective);\n\n  PlanningLineController.$inject = ['$scope', 'planningConfiguration', 'PositionService', 'ColorService', 'PauseService', 'AbsenceService'];\n\n  /**\n   *\n   */\n  function PlanningLineController($scope, planningConfiguration, PositionService, ColorService, PauseService, AbsenceService) {\n\n    var BASE_SIZE = planningConfiguration.BASE_SIZE;\n    var parallelText = planningConfiguration.parallelText;\n    var MAX_PARALLEL = planningConfiguration.MAX_PARALLEL;\n\n    var self = this;\n\n    self.$onInit = function () {\n      _.extend(self, {\n        clickEvent: clickEvent,\n        calcWidth: calcWidth,\n        dropEvent: dropEvent\n      });\n      init();\n      $scope.$watchCollection(function () {\n        return [self.events, self.dayStart, self.dayEnd];\n      }, init);\n\n      $scope.$watchCollection(function () {\n        return [self.absences];\n      }, function (newValue, oldValue) {\n        if (Array.isArray(self.absences) && self.absences.length) {\n          var start = moment(angular.copy(self.position)).startOf('day');\n          var end = moment(angular.copy(self.position)).endOf('day');\n          self._absences = AbsenceService.parseAbsences(self.absences, [start, end]).map(function (abs) {\n            abs.style = {\n              left: (moment(abs.start).hours() - self.dayStart.h) * BASE_SIZE * self.zoom + moment(abs.start).minutes() * BASE_SIZE * self.zoom / 60 + 'px',\n              width: self.zoom * self.SLIDER_WIDTH * moment.range(abs.start, abs.end).valueOf() / self.SECONDS_BY_DAY / 1000 + 'px'\n            };\n            abs.range = moment.range(abs.start, abs.end);\n            return abs;\n          });\n        } else {\n          self._absences = [];\n        }\n      });\n    };\n\n    self.log = function (a) {};\n\n    self.replace = function (string) {\n      if (!string) return;\n      return string.replace(/([a-zA-Z\\ ])\\w+/, '');\n    };\n\n    self.preEvent = {};\n    self.postEvent = {};\n\n    function extractMinutesFromEvent($event) {\n      var minutes;\n      if (_.contains($event.target.classList, 'half-hour')) {\n        // If the user has clicked right on the half-hour line, offsetX is 0\n        minutes = 30;\n      } else {\n        minutes = Math.floor($event.offsetX / (BASE_SIZE * self.zoom) * 60);\n      }\n      return minutes;\n    }\n\n    function dropEvent(data, event) {\n      var hour = parseInt(event.target.getAttribute('hour'));\n      var minutes = extractMinutesFromEvent(event);\n      var date = moment(angular.copy(self.position)).hours(hour + parseInt(self.dayStart.h)).minutes(minutes);\n      if (!checkAbsence(date)) {\n        self.dropCallback({ $data: data, $event: event, $hour: hour + parseInt(self.dayStart.h), $minutes: minutes });\n      } else {\n        planningConfiguration.absentTechnicianCallback(function () {\n          self.dropCallback({ $data: data, $event: event, $hour: hour + parseInt(self.dayStart.h), $minutes: minutes });\n        });\n      }\n    }\n\n    function clickEvent(hour, $event) {\n      var minutes = extractMinutesFromEvent($event);\n      var date = moment(angular.copy(self.position)).hours(hour + parseInt(self.dayStart.h)).minutes(minutes);\n      if (!checkAbsence(date)) {\n        self.clickCallback({ $hour: hour + parseInt(self.dayStart.h), $minutes: minutes });\n      } else {\n        planningConfiguration.absentTechnicianCallback(function () {\n          self.clickCallback({ $hour: hour + parseInt(self.dayStart.h), $minutes: minutes });\n        });\n      }\n    }\n\n    function init() {\n      var currentId = 0;\n      //     self.SLIDER_WIDTH   = 24 * BASE_SIZE\n      self.preEvent = {};\n      self.postEvent = {};\n      self.breaks = [];\n\n      self._events = angular.copy(self.events);\n\n      self.range = self.dayEnd.h - self.dayStart.h;\n      self.SECONDS_BY_DAY = 3600 * self.range;\n      self.SLIDER_WIDTH = BASE_SIZE * self.range;\n\n      // Pre-sort events by start Date\n      self._events = _.sortBy(self._events, function (e) {\n        return e.start.valueOf();\n      });\n\n      var lines = [[]];\n      var toremove = [];\n      _.each(self._events, function (event) {\n        var style = {};\n        event.depth = 1;\n        event.range = moment.range(event.start, event.end);\n        if (event.range < 900000) {\n          var end = moment(event.start).add(15, 'minutes');\n          event.range = moment.range(event.start, end);\n        }\n        style.left = (event.start.hours() - self.dayStart.h) * BASE_SIZE * self.zoom + event.start.minutes() * BASE_SIZE * self.zoom / 60 + 'px';\n        //   style.left                = event.start.hours() * 150 + event.start.minutes() * 150 / 60 + 'px'\n        style.width = self.zoom * self.SLIDER_WIDTH * event.range / self.SECONDS_BY_DAY / 1000 + 'px';\n        style['background-color'] = event['background-color'] || '#778899';\n        if (ColorService.getLuminance(style['background-color']) > 200) {\n          style.color = 'black';\n        } else {\n          style.color = 'white';\n        }\n        event.style = style;\n        PositionService.overlap(lines, event, MAX_PARALLEL, toremove);\n      });\n      self._events = _.difference(self._events, toremove);\n      _.each(self._events, function (event) {\n        event.id = angular.copy(currentId);\n        if (event.line === MAX_PARALLEL) {\n          event.style.left = (event.start.hours() - self.dayStart.h) * BASE_SIZE * self.zoom + event.start.minutes() * BASE_SIZE * self.zoom / 60 + 'px';\n          event.style.width = self.zoom * self.SLIDER_WIDTH * event.range.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px';\n          event.style['background-color'] = '#000';\n          event.style['font-weight'] = 'bold';\n          event.style.color = '#fff';\n          event.title = event.eventList.length + ' ' + parallelText;\n          if (event.tooltip) event.tooltip = event.title;\n        }\n        event.style.width = self.zoom * self.SLIDER_WIDTH * event.range.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px';\n        if (event.line === undefined) event.line = MAX_PARALLEL;\n        event.style.top = Math.round(parseInt(event.line) * 70 / lines.length) + '%';\n        event.style.height = Math.round(70 / lines.length) + '%';\n        event.percentage = '100%';\n        if (event.pre > 0) {\n          event.style['border-left'] = 'none';\n          var s = moment(event.start).subtract(event.pre, 'minutes');\n          if (!moment(s).isSame(event.start, 'day')) {\n            s = moment(event.start).startOf('day');\n          }\n          var e = moment(event.start);\n          var r = moment.range(s, e);\n          var totalRange = moment.range(s, event.range.end);\n          var percentage = r.valueOf() / totalRange.valueOf() * 100;\n          event.percentage = 100 - percentage + '%';\n          var obj = {\n            percentage: percentage + '%',\n            style: {\n              left: (moment(s).hours() - self.dayStart.h) * BASE_SIZE * self.zoom + moment(s).minutes() * BASE_SIZE * self.zoom / 60 + 2 + 'px',\n              width: self.zoom * self.SLIDER_WIDTH * r.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px',\n              top: event.style.top,\n              height: event.style.height,\n              totalWidth: self.zoom * self.SLIDER_WIDTH * totalRange.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px',\n              'text-align': 'center',\n              color: '#fff',\n              'background': 'repeating-linear-gradient(45deg, ' + event['background-color'] + ', ' + event['background-color'] + ' 10px, white 10px, white 20px)',\n              'border-top': '1px lightgrey solid',\n              'border-bottom': '1px lightgrey solid',\n              'border-left': '1px lightgrey solid'\n            },\n            tooltip: 'Trajet estimé de ' + event.pre + ' min'\n          };\n          if (percentage > 0) {\n            self.preEvent[event.id] = obj;\n          } else {\n            event.pre = 0;\n          }\n        }\n        generatePostEvent(event);\n        if (event.pauses) {\n          event.style['background-image'] = PauseService.generateGradient(event, 'to right');\n          event.style['background-color'] = undefined;\n        }\n        var pre = self.preEvent[event.id];\n        var post = self.postEvent[event.id];\n        event.style.totalWidth = safeParse(event.style.width) + safeParse(_.get(pre, 'style.width')) + safeParse(_.get(post, 'style.width')) + 1 + 'px';\n        currentId++;\n      });\n      if (self.pauses) {\n        createBreaks();\n      }\n    }\n\n    function calcWidth(zoom) {\n      return parseInt(zoom) * BASE_SIZE + 'px';\n    }\n\n    function createBreaks() {\n      self.breaks = _.compact(_.map(self.pauses.breaks, function (p) {\n        var pause = {\n          name: p.name,\n          start: moment().hours(p.start.split(':')[0]).minute(p.start.split(':')[1]).second(0),\n          end: moment().hours(p.end.split(':')[0]).minute(p.end.split(':')[1]).second(0),\n          style: {}\n        };\n\n        if (pause.start.isAfter(self.dayEnd) || pause.end.isBefore(self.dayStart)) {\n          return;\n        }\n        if (pause.start.isBefore(self.dayStart)) {\n          pause.start = moment(angular.copy(self.dayStart));\n        }\n\n        if (pause.end.isAfter(self.dayEnd)) {\n          pause.end = moment(angular.copy(self.dayEnd));\n        }\n        pause.style.left = (pause.start.hours() - self.dayStart.h) * BASE_SIZE * self.zoom + pause.start.minutes() * BASE_SIZE * self.zoom / 60 + 'px';\n        pause.style.width = self.zoom * self.SLIDER_WIDTH * moment.range(pause.start, pause.end).valueOf() / self.SECONDS_BY_DAY / 1000 + 'px';\n\n        return pause;\n      }));\n    }\n\n    function checkAbsence(date) {\n      var d = moment(angular.copy(date));\n      return _.any(self._absences, function (abs) {\n        return abs.range.contains(d);\n      });\n    }\n\n    function generatePostEvent(event) {\n      if (!event.post) {\n        return null;\n      }\n      event.style['border-right'] = 'none';\n      var end = moment(event.end).add(event.post, 'minutes');\n      if (!moment(end).isSame(event.end, 'day')) {\n        end = moment(event.end).endOf('day');\n      }\n      var start = moment(event.end);\n      var range = moment.range(start, end);\n      var totalRange = moment.range(event.range.start, event.range.end);\n      var percentage = range.valueOf() / totalRange.valueOf() * 100;\n      event.postPercentage = 100 - percentage + '%';\n      var obj = {\n        percentage: percentage + '%',\n        style: {\n          left: (moment(start).hours() - self.dayStart.h) * BASE_SIZE * self.zoom + moment(start).minutes() * BASE_SIZE * self.zoom / 60 + 2 + 'px',\n          width: self.zoom * self.SLIDER_WIDTH * range.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px',\n          top: event.style.top,\n          height: event.style.height,\n          totalWidth: self.zoom * self.SLIDER_WIDTH * totalRange.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px',\n          'text-align': 'center',\n          color: '#fff',\n          'background': 'repeating-linear-gradient(135deg, ' + event['background-color'] + ', ' + event['background-color'] + ' 10px, white 10px, white 20px)',\n          'border-top': '1px lightgrey solid',\n          'border-bottom': '1px lightgrey solid',\n          'border-left': '1px lightgrey solid'\n        },\n        tooltip: 'Trajet retour de ' + event.post + ' min'\n      };\n      if (percentage > 0) {\n        self.postEvent[event.id] = obj;\n      } else {\n        event.post = 0;\n      }\n    }\n\n    function safeParse() {\n      var width = arguments.length <= 0 || arguments[0] === undefined ? '0px' : arguments[0];\n\n      return parseInt(width.replace('px', ''));\n    }\n  }\n\n  function PlanningLineDirective() {\n    return {\n      restrict: 'E',\n      templateUrl: '/directives/planning-line/planning-line.html',\n      controller: PlanningLineController,\n      controllerAs: 'line',\n      bindToController: {\n        zoom: '=',\n        dayStart: '=',\n        dayEnd: '=',\n        events: '=',\n        clickCallback: '&',\n        dropCallback: '&',\n        pauses: '=?',\n        absences: '=?',\n        position: '=?'\n      },\n      scope: true\n    };\n  }\n})(window.angular, window._, window.moment);","'use strict';\n\n;(function (angular, _, moment) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlPlanningVerticalLine', PlanningLineDirective);\n\n  PlanningLineController.$inject = ['$filter', '$scope', 'planningConfiguration', 'PositionService', 'ColorService', 'PauseService', 'AbsenceService'];\n\n  /**\n   *\n   */\n  function PlanningLineController($filter, $scope, planningConfiguration, PositionService, ColorService, PauseService, AbsenceService) {\n\n    /** BASE_SIZE is the span of an hour. It gets multiplied by zoom (default 10) to get the size in pixel\n     * in vertical mode, we need to reduce it since we have much less space\n     */\n    var BASE_SIZE = Math.max(planningConfiguration.BASE_SIZE - 8, 1);\n    var parallelText = planningConfiguration.parallelText;\n    var MAX_PARALLEL = planningConfiguration.MAX_PARALLEL;\n    var AVAILABLE_SPACE = 90; // Total horizontal space taken by the events\n\n    var self = this;\n\n    self.$onInit = function () {\n      $scope.$watchCollection(function () {\n        return [self.events, self.dayStart, self.dayEnd];\n      }, init);\n\n      $scope.$watchCollection(function () {\n        return self.absences;\n      }, function (oldValue, newValue) {\n        if (Array.isArray(self.absences) && self.absences.length) {\n          var start = moment(angular.copy(self.day)).startOf('day');\n          var end = moment(angular.copy(self.day)).endOf('day');\n          self._absences = AbsenceService.parseAbsences(angular.copy(self.absences), [start, end]).map(function (abs) {\n            abs.style = {\n              top: (moment(abs.start).hours() - self.dayStart.h) * BASE_SIZE * self.zoom + moment(abs.start).minutes() * BASE_SIZE * self.zoom / 60 + 'px',\n              height: self.zoom * self.SLIDER_WIDTH * moment.range(abs.start, abs.end).valueOf() / self.SECONDS_BY_DAY / 1000 + 'px'\n            };\n\n            abs.range = moment.range(abs.start, abs.end);\n            return abs;\n          });\n        } else {\n          self._absences = [];\n        }\n      });\n\n      _.extend(self, {\n        clickEvent: clickEvent,\n        calcWidth: calcWidth,\n        dropEvent: dropEvent\n      });\n\n      init();\n    };\n\n    self.log = function (a) {};\n\n    self.replace = function (string) {\n      if (!string) return;\n      return string.replace(/([a-zA-Z\\ ])\\w+/, '');\n    };\n\n    self.preEvent = {};\n    self.postEvent = {};\n\n    function extractMinutesFromEvent($event) {\n      var minutes;\n      if (_.contains($event.target.classList, 'half-hour')) {\n        // If the user has clicked right on the half-hour line, offsetX is 0\n        minutes = 30;\n      } else {\n        minutes = Math.floor($event.offsetY / (BASE_SIZE * self.zoom) * 6) * 10;\n      }\n      return minutes;\n    }\n\n    function dropEvent(data, event) {\n      var hour = parseInt(event.target.getAttribute('hour'));\n      var minutes = extractMinutesFromEvent(event);\n      var date = moment(angular.copy(self.day)).hours(hour + parseInt(self.dayStart.h)).minutes(minutes);\n      if (!checkAbsence(date)) {\n        self.dropCallback({ $data: data, $event: event, $hour: hour, $minutes: minutes });\n      } else {\n        planningConfiguration.absentTechnicianCallback(function () {\n          self.dropCallback({ $data: data, $event: event, $hour: hour, $minutes: minutes });\n        });\n      }\n    }\n\n    function clickEvent(hour, $event) {\n      var minutes = extractMinutesFromEvent($event);\n      var date = moment(angular.copy(self.day)).hours(hour + parseInt(self.dayStart.h)).minutes(minutes);\n      if (!checkAbsence(date)) {\n        self.clickCallback({ $hour: hour + parseInt(self.dayStart.h), $minutes: minutes });\n      } else {\n        planningConfiguration.absentTechnicianCallback(function () {\n          self.clickCallback({ $hour: hour + parseInt(self.dayStart.h), $minutes: minutes });\n        });\n      }\n    }\n\n    function init() {\n      var currentId = 0;\n      //     self.SLIDER_WIDTH   = 24 * BASE_SIZE\n      self.preEvent = {};\n      self.breaks = [];\n\n      self._events = angular.copy(self.events);\n      self.range = self.dayEnd.h - self.dayStart.h;\n      self.SECONDS_BY_DAY = 3600 * self.range;\n      self.SLIDER_WIDTH = BASE_SIZE * self.range;\n\n      // Pre-sort events by start Date\n      self._events = _.sortBy(self._events, function (e) {\n        return e.start.valueOf();\n      });\n\n      var lines = [[]];\n      var toremove = [];\n      _.each(self._events, function (event) {\n        var style = {};\n        event.depth = 1;\n        event.range = moment.range(event.start, event.end);\n        if (event.range < 900000) {\n          var end = moment(event.start).add(15, 'minutes');\n          event.range = moment.range(event.start, end);\n        }\n        style.left = (event.start.hours() - self.dayStart.h) * BASE_SIZE * self.zoom + event.start.minutes() * BASE_SIZE * self.zoom / 60 + 'px';\n        //   style.left                = event.start.hours() * 150 + event.start.minutes() * 150 / 60 + 'px'\n        style.width = self.zoom * self.SLIDER_WIDTH * event.range / self.SECONDS_BY_DAY / 1000 + 'px';\n        style['background-color'] = event['background-color'] || '#778899';\n        if (ColorService.getLuminance(style['background-color']) > 200) {\n          style.color = 'black';\n        } else {\n          style.color = 'white';\n        }\n        event.style = style;\n        PositionService.overlap(lines, event, MAX_PARALLEL, toremove);\n      });\n      self._events = _.difference(self._events, toremove);\n      _.each(self._events, function (event) {\n        event.id = angular.copy(currentId);\n        if (event.line === MAX_PARALLEL) {\n          event.style.left = (event.start.hours() - self.dayStart.h) * BASE_SIZE * self.zoom + event.start.minutes() * BASE_SIZE * self.zoom / 60 + 'px';\n          event.style.width = self.zoom * self.SLIDER_WIDTH * event.range.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px';\n          event.style['background-color'] = '#000';\n          event.style['font-weight'] = 'bold';\n          event.title = event.eventList.length + ' ' + parallelText;\n          event.style.color = '#fff';\n          if (event.tooltip) event.tooltip = event.title;\n        }\n        event.style.width = self.zoom * self.SLIDER_WIDTH * event.range.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px';\n        if (event.line === undefined) event.line = MAX_PARALLEL;\n        event.style.top = Math.round(parseInt(event.line) * AVAILABLE_SPACE / lines.length) + '%';\n        event.style.height = Math.round(AVAILABLE_SPACE / lines.length) + '%';\n        event.percentage = '100%';\n        if (event.continuedBefore) event.pre = 0;\n        if (event.pre > 0) {\n          event.style['border-left'] = 'none';\n          var s = moment(event.start).subtract(event.pre, 'minutes');\n          if (!moment(s).isSame(event.start, 'day')) {\n            s = moment(event.start).startOf('day');\n          }\n          var e = moment(event.start);\n          var r = moment.range(s, e);\n          var totalRange = moment.range(s, event.range.end);\n          var percentage = r.valueOf() / totalRange.valueOf() * 100;\n          event.percentage = 100 - percentage + '%';\n          var obj = {\n            percentage: percentage + '%',\n            style: {\n              left: (moment(s).hours() - self.dayStart.h) * BASE_SIZE * self.zoom + moment(s).minutes() * BASE_SIZE * self.zoom / 60 + 'px',\n              width: self.zoom * self.SLIDER_WIDTH * r.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px',\n              top: event.style.top,\n              height: event.style.height,\n              totalWidth: self.zoom * self.SLIDER_WIDTH * totalRange.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px',\n              'text-align': 'center',\n              color: '#fff',\n              'background': 'repeating-linear-gradient(45deg, ' + event['background-color'] + ', ' + event['background-color'] + ' 10px, white 10px, white 20px)',\n              'border-top': '1px lightgrey solid',\n              'border-bottom': '1px lightgrey solid',\n              'border-left': '1px lightgrey solid'\n            },\n            tooltip: 'Trajet estimé de ' + event.pre + ' min'\n          };\n          if (percentage > 0) {\n            self.preEvent[event.id] = obj;\n          } else {\n            event.pre = 0;\n          }\n        }\n        generatePostEvent(event);\n        if (event.pauses) {\n          event.style['background-image'] = PauseService.generateGradient(event, 'to bottom');\n          event.style['background-color'] = undefined;\n        }\n        var pre = self.preEvent[event.id];\n        var post = self.postEvent[event.id];\n        event.style.totalWidth = safeParse(event.style.width) + safeParse(_.get(pre, 'style.width')) + safeParse(_.get(post, 'style.width')) + 1 + 'px';\n        currentId++;\n      });\n      if (self.pauses) {\n        createBreaks();\n      }\n      calculateContainerHeight();\n    }\n\n    function safeParse() {\n      var width = arguments.length <= 0 || arguments[0] === undefined ? '0px' : arguments[0];\n\n      return parseInt(width.replace('px', ''));\n    }\n\n    function generatePostEvent(event) {\n      if (!event.post) {\n        return null;\n      }\n      var end = moment(event.end).add(event.post, 'minutes');\n      if (!moment(end).isSame(event.end, 'day')) {\n        end = moment(event.end).endOf('day');\n      }\n      var start = moment(event.end);\n      var range = moment.range(start, end);\n      var totalRange = moment.range(event.range.start, event.range.end);\n      var percentage = range.valueOf() / totalRange.valueOf() * 100;\n      event.postPercentage = 100 - percentage + '%';\n      var obj = {\n        percentage: percentage + '%',\n        style: {\n          left: (moment(start).hours() - self.dayStart.h) * BASE_SIZE * self.zoom + moment(start).minutes() * BASE_SIZE * self.zoom / 60 + 2 + 'px',\n          width: self.zoom * self.SLIDER_WIDTH * range.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px',\n          top: event.style.top,\n          height: event.style.height,\n          totalWidth: self.zoom * self.SLIDER_WIDTH * totalRange.valueOf() / self.SECONDS_BY_DAY / 1000 + 'px',\n          'text-align': 'center',\n          color: '#fff',\n          'background': 'repeating-linear-gradient(135deg, ' + event['background-color'] + ', ' + event['background-color'] + ' 10px, white 10px, white 20px)',\n          'border-top': '1px lightgrey solid',\n          'border-bottom': '1px lightgrey solid',\n          'border-left': '1px lightgrey solid'\n        },\n        tooltip: 'Trajet retour de ' + event.post + ' min'\n      };\n      if (percentage > 0) {\n        self.postEvent[event.id] = obj;\n      } else {\n        event.post = 0;\n      }\n    }\n\n    function calcWidth(zoom) {\n      return parseInt(zoom) * BASE_SIZE + 'px';\n    }\n\n    function createBreaks() {\n      self.breaks = _.compact(_.map(self.pauses.breaks, function (p) {\n        var pause = {\n          name: p.name,\n          start: moment().hours(p.start.split(':')[0]).minute(p.start.split(':')[1]).second(0),\n          end: moment().hours(p.end.split(':')[0]).minute(p.end.split(':')[1]).second(0),\n          style: {}\n        };\n\n        if (pause.start.isAfter(self.dayEnd) || pause.end.isBefore(self.dayStart)) {\n          return;\n        }\n        if (pause.start.isBefore(self.dayStart)) {\n          pause.start = moment(angular.copy(self.dayStart));\n        }\n\n        if (pause.end.isAfter(self.dayEnd)) {\n          pause.end = moment(angular.copy(self.dayEnd));\n        }\n\n        pause.style.top = (moment(pause.start).hours() - self.dayStart.h) * BASE_SIZE * self.zoom + moment(pause.start).minutes() * BASE_SIZE * self.zoom / 60 + 'px';\n        pause.style.height = self.zoom * self.SLIDER_WIDTH * moment.range(pause.start, pause.end).valueOf() / self.SECONDS_BY_DAY / 1000 + 'px';\n\n        return pause;\n      }));\n    }\n\n    function calculateContainerHeight() {\n      self.containerHeight = parseInt(self.zoom) * BASE_SIZE * $filter('range')(self.range) + 'px';\n    }\n\n    function checkAbsence(date) {\n      var d = moment(angular.copy(date));\n      return _.any(self._absences, function (abs) {\n        return abs.range.contains(d);\n      });\n    }\n  }\n\n  function PlanningLineDirective() {\n    return {\n      restrict: 'E',\n      templateUrl: '/directives/planning-vertical-line/planning-vertical-line.html',\n      controller: PlanningLineController,\n      controllerAs: 'line',\n      bindToController: {\n        zoom: '=',\n        dayStart: '=',\n        dayEnd: '=',\n        events: '=',\n        pauses: '=?',\n        day: '=',\n        absences: '=?',\n        clickCallback: '&',\n        dropCallback: '&'\n      },\n      scope: true\n    };\n  }\n})(window.angular, window._, window.moment);","'use strict';\n\n;(function (angular, moment, _) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlPlanningTopRow', topRowDirective);\n\n  topRowDirective.$inject = ['planningConfiguration'];\n\n  function topRowDirective(planningConfiguration) {\n    var BASE_SIZE = planningConfiguration.BASE_SIZE;\n\n    return {\n      restrict: 'E',\n      templateUrl: '/directives/planning-top-row/planning-top-row.html',\n      controller: ['$scope', PlanningTopRowController],\n      controllerAs: 'planningTopRow',\n      bindToController: {\n        zoom: '=',\n        dayStart: '=',\n        dayEnd: '=',\n        events: '=',\n        entities: '=',\n        position: '=',\n        mode: '=',\n        callback: '&'\n      },\n      scope: {}\n    };\n\n    function PlanningTopRowController($scope) {\n      var self = this;\n\n      self.$onInit = function () {\n        $scope.$watchGroup([function () {\n          return self.dayStart;\n        }, function () {\n          return self.dayEnd;\n        }], init);\n\n        _.extend(self, {\n          calcWidth: calcWidth,\n          calcMargin: calcMargin\n        });\n\n        init();\n      };\n\n      function init() {\n        var range = self.dayEnd.h - self.dayStart.h + 1;\n        self.hours = [];\n        _.times(range, function (i) {\n          var d = moment(self.position);\n          d.hour(i + parseInt(self.dayStart.h));\n          d.minute(0);\n          self.hours.push(d);\n        });\n      }\n\n      function calcWidth(zoom) {\n        return parseInt(zoom) * BASE_SIZE + 'px';\n      }\n\n      function calcMargin(zoom, index) {\n        var half = parseInt(zoom) * (BASE_SIZE / 2);\n        if (!index) half = half - 3 * parseInt(zoom);\n        return '0 ' + half + 'px 0 -' + half + 'px';\n      }\n    }\n  }\n})(window.angular, window.moment, window._);","'use strict';\n\n;(function (angular, moment, _) {\n  'use strict';\n\n  angular.module('90Tech.planning').directive('zlPlanningWeekLine', PlanningLineDirective);\n\n  PlanningLineController.$inject = ['$scope', 'PositionService', 'planningConfiguration', 'ColorService'];\n\n  /**\n   *\n   */\n  function PlanningLineController($scope, PositionService, planningConfiguration, ColorService) {\n    var self = this;\n\n    self.$onInit = function () {\n      _.extend(self, {\n        calculateWidth: calculateWidth,\n        calculateLeft: calculateLeft\n      });\n\n      init();\n\n      $scope.$watchCollection(function () {\n        return [self.events, self.week];\n      }, init);\n    };\n\n    var parallelText = planningConfiguration.parallelText;\n    var MAX_PARALLEL = planningConfiguration.MAX_PARALLEL;\n\n    function init() {\n      self.displayedEvents = _(self.events).sortBy(function (event) {\n        return event.continuedBefore ? -1 : event.continuedAfter ? 0 : 1; // Order event list\n      }).value();\n\n      self.displayedEvents = positioning(self.displayedEvents);\n      self.oneDayEvents = positioning(self.oneDayEvents);\n    }\n\n    function positioning(eventList) {\n      var lines = [[]];\n      var toRemove = [];\n      _.each(eventList, function (event) {\n        event.style = {};\n        event.depth = 1;\n        event.range = moment.range(event.start, event.end);\n        PositionService.overlap(lines, event, MAX_PARALLEL, toRemove, true);\n      });\n      eventList = _.difference(eventList, toRemove);\n      _.each(eventList, function (event) {\n        setStyle(event, lines.length);\n      });\n      return eventList;\n    }\n\n    function setStyle(event, height) {\n      event.style.left = calculateLeft(event);\n      event.style.width = calculateWidth(event);\n      event.style['background-color'] = event['background-color'];\n      if (ColorService.getLuminance(event.style['background-color']) > 200) {\n        event.style.color = 'black';\n      } else {\n        event.style.color = 'white';\n      }\n\n      event.style.top = Math.ceil(event.line * 100 / height) + '%';\n      event.style.height = Math.round(100 / height) + '%';\n      if (event.line === undefined) event.line = MAX_PARALLEL;\n      if (event.eventList && event.eventList.length > 1) {\n        event.style['background-color'] = '#000';\n        event.style['color'] = '#FFF';\n        event.style['font-weight'] = 'bold';\n        event.title = event.eventList.length + ' ' + parallelText;\n        if (event.tooltip) event.tooltip = event.title;\n      }\n    }\n\n    function calculateWidth(event) {\n      if (event.start.day() === event.end.day()) {\n        return (event.end.diff(event.start, 'days') + 1) * (100 / 7) + '%';\n      } else {\n        var diff = Math.ceil(event.end.diff(event.start, 'hours') / 24);\n        if (event.end.hours() < event.start.hours()) {\n          diff += 1;\n        }\n        return diff * (100 / 7) + '%';\n      }\n    }\n\n    function calculateLeft(event) {\n      return (event.start.isoWeekday() - 1) * (99.9 / 7) + '%';\n    }\n  }\n\n  function PlanningLineDirective() {\n    return {\n      restrict: 'E',\n      replace: true,\n      templateUrl: '/directives/planning-week-line/planning-week-line.html',\n      controller: PlanningLineController,\n      controllerAs: 'line',\n      bindToController: {\n        events: '=',\n        week: '=',\n        oneDayEvents: '=',\n        weekEventCallback: '&'\n      },\n      scope: true\n    };\n  }\n})(window.angular, window.moment, window._);","angular.module('90Tech.planning').run(['$templateCache', function($templateCache) {$templateCache.put('/templates/planning-context-menu.html','<ul class=\"dropdown-menu context-menu\" ng-click=$event.stopPropagation(); style=\"z-index: 10\"><li ng-if=\"!event.eventList.length && !ev.eventList.length\"><a ng-click=\"planning.action({$element: event || ev})\"><i class=\"mdi mdi-chevron-down\"></i> Ouvrir dans un nouvel onglet {{event.eventList.length}}</a></li></ul>');\n$templateCache.put('/directives/planning-day-block/planning-day.html','<div class=day-block ng-class=\"{\\'empty-day\\': dayCtrl.isDefined }\" ng-click=planning.dayCallback({$day:dayCtrl.day.date})><div style=position:absolute;left:5px;top:5px; ng-if=\"dayCtrl.day.date.day() === 1\">{{dayCtrl.day.date.week()}}</div><div class=day-number>{{ dayCtrl.day.date.date() }}</div><div class=events-container><div ng-style=\"{\\'background-color\\': event.color}\" class=month-event ng-repeat=\"event in dayCtrl.day.events |limitTo:5\">{{event.title}}</div></div><div class=absents-container tooltip-append-to-body=true ng-if=dayCtrl.absents.length uib-tooltip-html=dayCtrl.absentsString>{{dayCtrl.absents.length}} absent(s)</div></div>');\n$templateCache.put('/directives/planning/planning.html','<div ng-if=\"planning.mode ===\\'day\\' || planning.mode === \\'week\\'\" style=\"height: 100%;\"><zl-planning-left-column mode=planning.mode position=planning.position day-field=planning.dayField usable-days=planning.allowedDays events=planning.sortedEvents></zl-planning-left-column><div class style=height:100%><div zl-horizontal-scroll scroll-left=planning.currentTimeToPixels() style=height:100%><div ng-style=\"{width: planning.width}\" class=planning-body><zl-planning-top-row mode=planning.mode zoom=planning.zoom position=planning.position day-start=planning._dayStart day-end=planning._dayEnd></zl-planning-top-row><div class=hour-cursor ng-style=\"{left: planning.currentTimeToPixels()+\\'px\\'}\" ng-if=\"planning.isCurrent() && planning.isInDayRange()\"><div class=hour-caret></div></div><div class=planning-2pc></div><zl-planning-line ng-if=\"planning.mode === \\'day\\'\" zoom=planning.zoom absences=planning.absences[i] position=planning.position day-start=planning._dayStart day-end=planning._dayEnd ng-repeat=\"i in planning.keys(planning.sortedEvents)\" class=\"day b-b\" ng-class=\"{today: planning.isToday(i)}\" events=planning.getEvents(i) pauses=planning.entitiesPauses[i] drop-callback=\"planning.dropEvent({h: $hour, m: $minutes, d: i, entity: i, $data: $data, $event: $event})\" click-callback=\"planning.clickCallbackWrapper({h: $hour, m: $minutes, d: i, entity: i})\"></zl-planning-line><zl-planning-line ng-if=\"planning.mode === \\'week\\'\" zoom=planning.zoom ng-repeat=\"day in planning.usableDays\" day-start=planning._dayStart day-end=planning._dayEnd class=\"day b-b\" ng-class=\"{today: planning.isToday(planning.keys(planning.sortedEvents)[day])}\" events=planning.getEvents(planning.keys(planning.sortedEvents)[day]) drop-callback=\"planning.dropEvent({h: $hour, m: $minutes, d: planning.keys(planning.sortedEvents)[day], entity: planning.keys(planning.sortedEvents)[day], $data: $data, $event: $event})\" click-callback=\"planning.clickCallbackWrapper({h: $hour, m: $minutes, d: planning.keys(planning.sortedEvents)[day], entity: planning.keys(planning.sortedEvents)[day]})\"></zl-planning-line></div></div></div></div><div ng-if=\"planning.mode === \\'3day\\'\" style=\"height: 100%;\"><zl-planning-left-column mode=\"\\'day\\'\" position=planning.position day-field=planning.dayField usable-days=planning.allowedDays events=planning.sortedEvents></zl-planning-left-column><div style=\"height: 100%; display: flex; flex-flow: row nowrap;\" zl-horizontal-scroll><div style=height:100%; ng-repeat=\"day in planning.groupedEvents track by $index\"><div style=\"height:100%; display: inline-block;\"><div ng-style=\"{width: planning.width}\" class=planning-body><zl-planning-top-row mode=\"\\'day\\'\" zoom=planning.zoom position=planning.position day-start=planning._dayStart day-end=planning._dayEnd></zl-planning-top-row><p style=\"position: absolute; top: 25px; font-size: 1.5em; font-weight: bold; text-align: center;\">{{day.day}}</p><div class=hour-cursor ng-style=\"{left: planning.currentTimeToPixels()+\\'px\\'}\" ng-if=\"planning.isCurrent() && planning.isInDayRange()\"><div class=hour-caret></div></div><div class=planning-2pc></div><zl-planning-line zoom=planning.zoom position=day.date absences=day.absences[i] day-start=planning._dayStart day-end=planning._dayEnd ng-repeat=\"i in planning.keys(day.value) track by $index\" class=\"day b-b\" events=day.value[i] pauses=planning.entitiesPauses[i] drop-callback=\"planning.dropEvent({h: $hour, m: $minutes, d: i, entity: i, $data: $data, $event: $event, day: day.key})\" click-callback=\"planning.clickCallbackWrapper({h: $hour, m: $minutes, d: i, entity: i})\"></zl-planning-line></div></div></div></div></div><div ng-if=\"planning.mode ===\\'week-advanced\\'\" class=advanced-week><div class=days-list><div class=day-advanced>&nbsp;</div><div class=day-advanced ng-repeat=\"day in planning.daysList\" ng-click=planning.dayCallback({$day:day})><span class=day-text>{{day | format:\\'dddd\\' | capitalize}}<br><small>{{day | format:\\'ll\\'}}</small></span></div></div><div class=advanced-week-container ng-repeat=\"name in planning.keys(planning.sortedEvents)\"><div class=left-column-advanced><span style=margin:auto>{{name}}</span></div><div ng-repeat=\"day in planning.allowedDays\" class=day-advanced><zl-planning-vertical-line day=planning.daysList[$index] zoom=planning.zoom drop-callback=\"planning.dropEvent({h: $hour, m: $minutes, d:day, entity: name, $data: $data, $event: $event})\" day-start=planning._dayStart day-end=planning._dayEnd events=planning.getEvents(name)[day] pauses=planning.entitiesPauses[name] absences=planning.absences[name] click-callback=\"planning.clickCallbackWrapper({h: $hour, m: $minutes, d: day, entity: name})\"></zl-planning-vertical-line></div></div></div><div ng-if=\"planning.mode === \\'month\\'\" style=\"height: 100%; z-index: 1000;\"><div class=month-header><span class=month-text>{{planning.month | capitalize}}</span></div><div class=day-header><div class=day ng-repeat=\"day in []|range:7\"><span class=day-text>{{day | day}}</span></div></div><div class=month-container><zl-planning-day ng-repeat=\"day in planning.days\" day=day events=planning._events absences=planning.absences drop-callback=\"planning.dropEvent({$data: $data, $event: $event, moment: day.date})\" ng-dblclick=\"planning.clickWeekEvent(day, $event)\"></zl-planning-day><zl-planning-week-line ng-repeat=\"(week, events) in planning.multipleDaysEvents\" events=events week=week one-day-events=planning.oneDayEvents[week] style=\"height: 20%; pointer-events: none\"></zl-planning-week-line></div></div>');\n$templateCache.put('/directives/planning-line/planning-line.html','<div style=\"z-index: 1;\" zl-planning-drag-drop zl-drop=\"line.dropEvent($data, $event)\"><div class=\"b-b b-r all-day day-hour\" ng-style=\"{width: line.calcWidth(line.zoom)}\" ng-repeat=\"n in [] | range:line.range\" ng-dblclick=\"line.clickEvent(n, $event)\" hour={{n}}><span class=half-hour></span></div></div><div ng-repeat=\"event in line._events\" zl-planning-drag-drop ng-click=\"planning.eventCallback({\\'event\\':event})\" zl-drag=event ng-style=\"{ height: event.style.height, top: event.style.top, width: event.style.totalWidth, left: event.pre > 0 ? line.preEvent[event.id].style.left : event.style.left }\" style=\"position: absolute; z-index: 1; display: flex; flex-flow: row nowrap\"><div ng-if=\"event.pre > 0\" ng-style=\"{width: line.preEvent[event.id].style.width, \\'background\\': line.preEvent[event.id].style[\\'background\\']}\" style=\"display: inline-block; position: relative; height: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;\" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.preEvent[event.id].tooltip}}><div class=title-container><span><i style=\"height: 100%; font-size: 1.2em;\" class=\"mdi mdi-car\"></i></span></div></div><div class=event style=\"display: inline-block; position: relative; height: 100%;\" data-context-menu=/templates/planning-context-menu.html tooltip-append-to-body=true tooltip-placement=\"{{event.tooltipTemplate? \\'auto\\': \\'top\\'}}\" ng-attr-uib-tooltip=\"{{!event.tooltipTemplate ? event.tooltip : undefined}}\" ng-attr-uib-tooltip-template=\"{{\\'\\' + event.tooltipTemplate}}\" tooltip-class=planning-event-tooltip ng-style=\"{ width: event.style.width, background: event.style[\\'background-color\\'], \\'background-image\\': event.style[\\'background-image\\'], color: event.style.color, \\'border-left\\': event.pre > 0 ? \\'none\\': \\'\\' }\"><div class=event-line-container style><div class=event-line ng-style=\"{\\'background-color\\': event.color}\" ng-if=!event.continuedBefore></div></div><div class=title-container><span>{{event.title}}</span></div></div><div ng-if=\"event.post > 0\" ng-style=\"{width: line.postEvent[event.id].style.width, \\'background\\': line.postEvent[event.id].style[\\'background\\']}\" style=\"display: inline-block; position: relative; height: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;\" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.postEvent[event.id].tooltip}}><div class=title-container><span><i style=\"height: 100%; font-size: 1.2em;\" class=\"mdi mdi-car\"></i></span></div></div></div><div ng-repeat=\"pause in line.breaks track by $index\" class=planning-pause-element style=\"height: 100%;\" ng-style=pause.style></div><div ng-repeat=\"absence in line._absences track by $index\" class=planning-absences uib-tooltip=Absent tooltip-append-to-body=true style=\"height: 100%;\" ng-style=absence.style></div>');\n$templateCache.put('/directives/planning-vertical-line/planning-vertical-line.html','<div ng-style=\"{height: line.containerHeight}\"><div style=\"position: absolute; height: 100%; width: 100%; z-index: 1;\" zl-planning-drag-drop zl-drop=\"line.dropEvent($data, $event)\"><div class=\"b-b b-r all-day\" ng-style=\"{height: line.calcWidth(line.zoom)}\" ng-repeat=\"n in [] | range: line.range\" ng-dblclick=\"line.clickEvent(n, $event)\" hour=\"{{n + line.dayStart.h}}\"><span class=hour-text>{{n + 1 + line.dayStart.h}}</span></div></div><div ng-repeat=\"event in line._events\" zl-planning-drag-drop ng-click=\"planning.eventCallback({\\'event\\':event})\" zl-drag=event ng-style=\"{ width: event.style.height, right: event.style.top, height: event.pre > 0 ? line.preEvent[event.id].style.totalWidth : event.style.width, top: event.pre > 0 ? line.preEvent[event.id].style.left : event.style.left }\" style=\"position: absolute; z-index: 1;\"><div ng-if=\"event.pre > 0\" ng-style=\"{height: line.preEvent[event.id].style.width, \\'background\\': line.preEvent[event.id].style[\\'background\\']}\" style=\"display: inline-block; position: relative; width: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;\" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.preEvent[event.id].tooltip}}><div class=title-container><span><i style=\"width: 100%; font-size: 1.2em;\" class=\"mdi mdi-car\"></i></span></div></div><div class=event style=\"display: inline-block; position: relative; width: 100%;\" tooltip-append-to-body=true tooltip-placement=\"{{event.tooltipTemplate? \\'auto\\': \\'top\\'}}\" ng-attr-uib-tooltip=\"{{!event.tooltipTemplate ? event.tooltip : undefined}}\" ng-attr-uib-tooltip-template=\"{{\\'\\' + event.tooltipTemplate}}\" tooltip-class=planning-event-tooltip data-context-menu=/templates/planning-context-menu.html ng-style=\"{ height: event.style.width, \\'background-image\\': event.style[\\'background-image\\'], background: event.style[\\'background-color\\'], color: event.style.color, \\'border-left\\': event.pre > 0 ? \\'none\\': \\'\\' }\"><div class=event-line-container style><div class=event-line ng-style=\"{\\'background-color\\': event.color}\"></div></div><div class=title-container><span>{{event.title}}</span></div></div><div ng-if=\"event.post > 0\" ng-style=\"{height: line.postEvent[event.id].style.width, \\'background\\': line.postEvent[event.id].style[\\'background\\']}\" style=\"display: inline-block; position: relative; width: 100%; text-align: center; color: white; border: 1px lightgrey solid; border-right: none;\" class=pre-event tooltip-append-to-body=true uib-tooltip={{line.postEvent[event.id].tooltip}}><div class=title-container><span><i style=\"width: 100%; font-size: 1.2em;\" class=\"mdi mdi-car\"></i></span></div></div></div><div ng-repeat=\"pause in line.breaks track by $index\" class=planning-pause-element style=\"width: 95%; left: 5%;\" ng-style=pause.style></div><div ng-repeat=\"absence in line._absences track by $index\" class=planning-absences uib-tooltip=Absent tooltip-append-to-body=true style=\"width: 95%; left: 5%;\" ng-style=absence.style></div></div>');\n$templateCache.put('/directives/planning-left-column/planning-left-column.html','<div class=left-column ng-switch=planningLeftColumn.mode><div class=planning-head></div><div class=left-body><div class=planning-2pc></div><div class=days-body ng-switch-when=week><div class=\"dayName row8 b-b animate\" ng-repeat=\"day in planningLeftColumn.days\" ng-class=\"{today: planning.isToday(day.dayOfYear())}\" ng-click=planning.dayCallback({$day:day})><h4>{{day | format:\\'dddd\\' | capitalize}}<br><small>{{day | format:\\'ll\\'}}</small></h4></div></div><div class=days-body ng-switch-when=day><div class=\"dayName row8 b-b animate\" ng-repeat=\"col in planningLeftColumn.column\"><h4>{{col}}</h4></div></div></div><div style=height:10px></div></div>');\n$templateCache.put('/directives/planning-week-line/planning-week-line.html','<div class=week-line ng-class=\"\\'week-\\' + line.week\" style=padding-top:20px;><div class=single-day-events style=\"height:40%; position:relative;\"><div zl-planning-drag-drop zl-drag=ev ng-repeat=\"ev in line.oneDayEvents\" ng-style=\"{\\'top\\': ev.style.top, \\'height\\': ev.style.height, \\'background-color\\': ev.style[\\'background-color\\'], \\'color\\' : ev.style.color, \\'width\\': ev.style.width, \\'left\\': ev.style.left}\" style=\"position:absolute;border: 1px solid black;pointer-events: auto; overflow: hidden;\" ng-click=\"planning.weekEventCallback({event: ev})\" tooltip-append-to-body=true tooltip-placement=\"{{ev.tooltipTemplate? \\'auto\\': \\'top\\'}}\" ng-attr-uib-tooltip=\"{{!ev.tooltipTemplate ? ev.tooltip : undefined}}\" ng-attr-uib-tooltip-template=\"{{\\'\\' + ev.tooltipTemplate}}\" tooltip-class=planning-event-tooltip class=single-day-event><div class=event-line-container><div class=event-line ng-style=\"{\\'background-color\\': ev.color}\" ng-if=!ev.continuedBefore></div></div><div class=single-day-event-title data-context-menu=/templates/planning-context-menu.html><span>{{ev.title}}</span></div></div></div><div class=multiple-days-events style=\"height:40%; position: relative;\"><div class=multiple-day-event ng-repeat=\"event in line.displayedEvents\" style=\"position: absolute; border: 1px solid black;pointer-events: auto; overflow: hidden;\" zl-planning-drag-drop zl-drag=event ng-click=\"planning.weekEventCallback({event: event})\" tooltip-append-to-body=true tooltip-placement=\"{{event.tooltipTemplate? \\'auto\\': \\'top\\'}}\" ng-attr-uib-tooltip=\"{{!event.tooltipTemplate ? event.tooltip : undefined}}\" ng-attr-uib-tooltip-template=\"{{\\'\\' + event.tooltipTemplate}}\" tooltip-class=planning-event-tooltip ng-style=\"{\\'top\\': event.style.top, \\'height\\': event.style.height, \\'background-color\\': event.style[\\'background-color\\'], \\'color\\' : event.style.color, \\'width\\': event.style.width, \\'left\\': event.style.left}\"><div class=event-line-container><div class=event-line ng-style=\"{\\'background-color\\': event.color}\" ng-if=!event.continuedBefore></div></div><div class=multiple-day-event-title data-context-menu=/templates/planning-context-menu.html><span>{{event.title}}</span></div></div></div></div>');\n$templateCache.put('/directives/planning-top-row/planning-top-row.html','<div class=planning-top-row><div ng-repeat=\"hour in planningTopRow.hours\" class=day-hour ng-style=\"{width: planningTopRow.calcWidth(planningTopRow.zoom), margin: planningTopRow.calcMargin(planningTopRow.zoom, $index)}\"><h4>{{hour | format:\\'HH:mm\\'}}</h4></div></div>');}]);"]}