!function(){"use strict";angular.module("90Tech.planning",["pikaday"])}(),function(){"use strict";function ScrollHorizontalDirective($timeout){return{restrict:"A",scope:{scrollLeft:"="},link:function(scope,element,attributes){element.bind("mousewheel",function(e){element[0].scrollLeft-=e.wheelDelta/3}),element.addClass("slider"),scope.scrollLeft,$timeout(function(){element[0].scrollLeft=scope.scrollLeft-element[0].offsetWidth/2},100)}}}angular.module("90Tech.planning").directive("zlHorizontalScroll",ScrollHorizontalDirective),ScrollHorizontalDirective.$inject=["$timeout"]}(),function(){"use strict";function PlanningLeftColumnController($scope){function init(){self.days=[],"week"===self.mode?_.times(7,function(i){var d=moment(self.position);d.weekday(i),self.days.push(d)}):"day"===self.mode&&self.dayField&&(self.column=_.keys(self.events))}var self=this;$scope.$watchCollection(function(){return[self.position,self.mode,self.dayStart,self.dayEnd]},init)}function PlanningDirective(){return{restrict:"E",templateUrl:"planning/directives/planning-left-column/planning-left-column.html",controller:PlanningLeftColumnController,controllerAs:"planningLeftColumn",bindToController:{events:"=",entities:"=",position:"=",mode:"=",dayField:"=",callback:"&"},scope:!0}}angular.module("90Tech.planning").directive("zlPlanningLeftColumn",PlanningDirective),PlanningLeftColumnController.$inject=["$scope"]}(),function(){"use strict";function PlanningLineController(){function init(){self.events=_.sortBy(self.events,function(e){return e.start.valueOf()});var lines=[[]];_.each(self.events,function(event){var style={};event.depth=1,event.range=moment.range(event.start,event.end),style.left=150*event.start.hours()+150*event.start.minutes()/60+"px",style.width=SLIDER_WIDTH*event.range/SECONDS_BY_DAY/1e3+"px",style["background-color"]=event["background-color"]||"#778899",event.style=style;line:for(var i=0;i<lines.length;i++){if(!lines[i].length){lines[i].push(event),event.line=i;break line}{if(!_.filter(lines[i],function(elt){return event.range.overlaps(elt.range)?(elt.depth+=1,!0):void 0}).length){lines[i].push(event),event.line=i;break line}event.depth+=1,lines[i+1]||(lines[i+1]=[])}}}),_.each(self.events,function(event,i){event.style.top=Math.round(100*event.line/lines.length)+"%",event.style.height=Math.round(100/lines.length)+"%"})}var self=this;init()}function PlanningLineDirective(){return{restrict:"E",templateUrl:"planning/directives/planning-line/planning-line.html",controller:PlanningLineController,controllerAs:"line",bindToController:{events:"="},scope:!0}}angular.module("90Tech.planning").directive("zlPlanningLine",PlanningLineDirective);var SECONDS_BY_DAY=86400,SLIDER_WIDTH=3600}(),function(){"use strict";function topRowDirective(){function PlanningTopRowController(){function init(){_.times(24,function(i){var d=moment(self.position);d.hour(i),d.minute(0),hours.push(d)})}var self=this,hours=[];_.extend(self,{hours:hours}),init()}return{restrict:"E",templateUrl:"planning/directives/planning-top-row/planning-top-row.html",controller:PlanningTopRowController,controllerAs:"planningTopRow",bindToController:{events:"=",entities:"=",position:"=",mode:"=",callback:"&"},scope:{}}}angular.module("90Tech.planning").directive("zlPlanningTopRow",topRowDirective)}(),function(){"use strict";function PlanningController($scope){function split(event){var start=moment(event.start).hour(self._dayStart.h).minute(self._dayStart.m).second(0),stop=moment(event.end).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59);if(event.start.dayOfYear()===event.end.dayOfYear()){if(event.start.isBefore(start)){if(event.end.isBefore(start))return[];event.start=start}if(event.end.isAfter(stop)){if(event.start.isAfter(stop))return[];event.end=stop}return[event]}var first_event=angular.copy(event);first_event.end=moment(event.start).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59),event.start.isBefore(start)&&(first_event.start=start);var startNextDay=moment(event.start).add(1,"day").hour(self._dayStart.h).minute(self._dayStart.m),endThisDay=moment(event.start).hour(self._dayEnd.h).minute(self._dayEnd.m);if(event.end.isBefore(startNextDay))return first_event.start.isAfter(endThisDay)?[]:[first_event];first_event.continuedAfter=!0;var second_event=angular.copy(event);return second_event.start=moment(event.start).add(1,"day").hour(self._dayStart.h).minute(self._dayStart.m),second_event.continuedBefore=!0,event.start.isAfter(endThisDay)?split(second_event):[first_event].concat(split(second_event))}function filter(events){return _.filter(events,function(e){var start,stop;return"week"===self.mode?(start=moment(self.position).weekday(0).hour(self._dayStart.h).minute(self._dayStart.m).second(0),stop=moment(self.position).weekday(7).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59)):"day"===self.mode&&(start=moment(self.position).hour(self._dayStart.h).minute(self._dayStart.m).second(0),stop=moment(self.position).hour(self._dayEnd.h).minute(self._dayEnd.m).second(59)),e.start.isBetween(start,stop)})}function addMissingDays(sortedEvents){if(sortedEvents){var startingDay=moment(self.position).weekday(0).dayOfYear();_.times(7,function(i){sortedEvents[startingDay+i]||(sortedEvents[startingDay+i]=[])})}}function parseTime(h){return{h:h.split(":")[0],m:h.split(":")[1]}}function init(){self._dayStart=parseTime(self.dayStart?self.dayStart:"00:00"),self._dayEnd=parseTime(self.dayEnd?self.dayEnd:"23:59"),self.sortedEvents=void 0,self._events=_.flatten(_.map(self.events,split)),self._events=filter(self._events),"week"===self.mode?(self.sortedEvents=_.groupBy(self._events,function(e){return e.start.dayOfYear()}),addMissingDays(self.sortedEvents)):"day"===self.mode&&(self.sortedEvents=_.groupBy(self._events,function(e){return e[self.dayField]}))}function isToday(n){return self.position.week()===moment().week()&&n==moment().dayOfYear()}function currentTimeToPixels(){var totalMinutes=60*moment().hour()+moment().minutes();return Math.floor(150*totalMinutes/60)}function isCurrentWeek(){return self.position.week()===moment().week()}var self=this;$scope.$watchCollection(function(){return[self.position,self.mode,self.dayStart,self.dayEnd]},init),_.extend(self,{isToday:isToday,currentTimeToPixels:currentTimeToPixels,isCurrentWeek:isCurrentWeek})}function PlanningDirective(){return{restrict:"E",templateUrl:"planning/directives/planning/planning.html",controller:PlanningController,controllerAs:"planning",bindToController:{events:"=",entities:"=",position:"=",mode:"=",dayStart:"=",dayEnd:"=",dayField:"=",callback:"&"},scope:{}}}angular.module("90Tech.planning").directive("zlPlanning",PlanningDirective),PlanningController.$inject=["$scope"]}(),function(){"use strict";angular.module("90Tech.planning").filter("format",function(){return function(time,format){return time.format(format)}}).filter("capitalize",function(){return function(str){return str.charAt(0).toUpperCase()+str.slice(1)}})}(),function(){"use strict";function RangeFilter(){var operation=function(input,total){total=parseInt(total);for(var i=0;total>i;i++)input.push(i);return input};return operation}angular.module("90Tech.planning").filter("range",RangeFilter)}();